{"version":3,"file":"DefaultLayout_xC5OqFKB.mjs","sources":["../../../src/middlewares/AuthMiddleware.tsx","../../../src/layouts/DefaultLayout.astro"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\ninterface AuthMiddlewareProps {\n  children: React.ReactNode;\n  currentPath?: string;\n}\n\n/**\n * Middleware de autenticación para proteger rutas\n * VERSION SIMPLIFICADA: En desarrollo, todos los usuarios tienen acceso completo\n * Las verificaciones de roles se han desactivado temporalmente\n */\nconst AuthMiddleware: React.FC<AuthMiddlewareProps> = ({ children }) => {\n  const [authorized, setAuthorized] = useState(true); // Siempre autorizado en modo desarrollo\n\n  useEffect(() => {\n    // Versión simplificada para desarrollo\n    try {\n      // Si no hay token, crear uno temporal para desarrollo\n      if (!localStorage.getItem('token')) {\n        localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6NDEwMjQ0NDgwMH0.x');\n        console.log('Token JWT de desarrollo generado automáticamente');\n      }\n      \n      // En desarrollo siempre estamos autorizados\n      setAuthorized(true);\n    } catch (error) {\n      console.error('Error en AuthMiddleware:', error);\n      // En desarrollo, permitir acceso incluso si hay errores\n      setAuthorized(true);\n    }\n    \n    /* El código de verificación se deja comentado para implementarlo más adelante\n    // Obtener la ruta actual\n    const currentPath = window.location.pathname;\n    console.log('Verificando acceso a ruta:', currentPath);\n    \n    // Si no está autenticado, redirigir al login\n    if (!isAuthenticated()) {\n      console.log('Usuario no autenticado, redirigiendo al login');\n      window.location.href = `/login?redirect=${encodeURIComponent(currentPath)}`;\n      return;\n    }\n\n    // Verificar si tiene acceso a la ruta actual\n    const user = getCurrentUser();\n    // Asegurar que el rol del usuario sea de tipo UserRole\n    const userRole = (user?.role as UserRole) || 'usuario';\n    \n    const hasAccess = hasAccessToRoute(currentPath, userRole);\n    console.log('¿Usuario tiene acceso a la ruta?', hasAccess, 'con rol:', userRole);\n    \n    if (!hasAccess) {\n      console.log('Usuario no autorizado para esta ruta, redirigiendo');\n      // Redirigir a página de error o página principal según su rol\n      window.location.href = '/unauthorized';\n      return;\n    }\n\n    // Si todo está correcto, autorizar\n    setAuthorized(true);\n    setLoading(false);\n    */\n  }, []);\n\n  // En modo desarrollo, siempre retornamos los hijos (authorized es siempre true)\n  return <>{children}</>;\n  \n  /* La siguiente lógica se implementará cuando se active la validación de roles\n  return (\n    <>\n      {!authorized ? (\n        <div className=\"p-6 bg-red-50 border border-red-200 rounded-lg text-center\">\n          <h3 className=\"text-xl font-bold text-red-700 mb-2\">Acceso no autorizado</h3>\n          <p className=\"text-red-600 mb-4\">No tienes permiso para acceder a esta página.</p>\n          <button \n            className=\"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md\"\n            onClick={() => {\n              localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6NDEwMjQ0NDgwMH0.x');\n              window.location.reload();\n            }}\n          >\n            Iniciar sesión\n          </button>\n        </div>\n      ) : (\n        children\n      )}\n    </>\n  );\n  */\n};\n\nexport default AuthMiddleware;\n","---\n// Importar componentes de layout\nimport Navbar from '../components/layout/Navbar.astro';\nimport Sidebar from '../components/layout/Sidebar.astro';\nimport Footer from '../components/layout/Footer.astro';\nimport AuthMiddleware from '../middlewares/AuthMiddleware';\n\n// Importar estilos globales\nimport '../styles/global.css';\nimport '../styles/lemon-squeezy.css';\n\n// Props que pueden ser pasados al layout\ninterface Props {\n  title?: string;\n  userRole?: string;\n}\n\n// Valores por defecto\nconst { \n  title = \"Masclet Imperi\",\n  userRole = \"usuario\"\n} = Astro.props;\n\n// Path actual\nconst currentPath = Astro.url.pathname;\n\n// Obtener el rol del usuario (a futuro desde el token almacenado)\nconst role = Astro.cookies.get('userRole')?.value || userRole;\n---\n\n<!DOCTYPE html>\n<!-- Script para actualizar la cookie de rol de usuario -->\n<html lang=\"es\" class=\"light\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <meta name=\"description\" content=\"Masclet Imperi - Sistema de Gestión Ganadera\" />\n    <link rel=\"icon\" type=\"image/svg+xml\" href=\"/favicon.svg\" />\n    <title>{title} | Masclet Imperi</title>\n  </head>\n  <body class=\"min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 dark:text-gray-100\">\n  <!-- Script para actualizar la cookie de rol de usuario -->\n  <script src=\"/src/scripts/updateUserRole.js\"></script>\n    <AuthMiddleware client:load currentPath={currentPath}>\n      <Navbar title={title} userRole={role} currentPath={currentPath} />\n      \n      <div class=\"flex flex-1 relative overflow-hidden\">\n        <!-- Marca de agua con el logo -->\n        <div class=\"absolute inset-0 pointer-events-none z-0 flex items-center justify-center opacity-[0.02] dark:opacity-[0.01]\">\n          <img src=\"/images/logo_masclet.jpg\" alt=\"Marca de agua Masclet Imperi\" class=\"w-full max-w-4xl object-contain\" />\n        </div>\n        \n        <Sidebar userRole={role} currentPath={currentPath} />\n        \n        <!-- Contenido principal con padding adaptativo y margen para la barra lateral -->\n        <main class=\"flex-1 p-3 sm:p-4 md:p-6 relative z-10 overflow-auto md:ml-64\">\n          <!-- Contenedor con ancho máximo para mejorar legibilidad en pantallas grandes -->\n          <div class=\"max-w-7xl mx-auto\">\n            <slot />\n          </div>\n        </main>\n      </div>\n      \n      <Footer />\n    </AuthMiddleware>\n\n    <!-- Botón flotante para mostrar el sidebar en móvil -->\n    <button id=\"mobile-sidebar-toggle\" class=\"md:hidden fixed bottom-6 right-6 bg-primary text-white p-3 rounded-full shadow-lg z-30\">\n      <span class=\"text-xl\">☰</span>\n    </button>\n\n    <script is:inline>\n      // Script para el tema oscuro/claro\n      const theme = (() => {\n        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {\n          return localStorage.getItem('theme');\n        }\n        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n          return 'dark';\n        }\n        return 'light';\n      })();\n          \n      if (theme === 'dark') {\n        document.documentElement.classList.add('dark');\n      } else {\n        document.documentElement.classList.remove('dark');\n      }\n\n      // Script para el sidebar móvil\n      document.addEventListener('DOMContentLoaded', () => {\n        const sidebarToggle = document.getElementById('mobile-sidebar-toggle');\n        const sidebar = document.querySelector('.masclet-sidebar');\n        \n        if (sidebarToggle && sidebar) {\n          sidebarToggle.addEventListener('click', () => {\n            sidebar.classList.toggle('mobile-sidebar-active');\n            \n            // Cambiar el ícono según el estado\n            const toggleIcon = sidebarToggle.querySelector('span');\n            if (toggleIcon) {\n              toggleIcon.textContent = sidebar.classList.contains('mobile-sidebar-active') ? '✕' : '☰';\n            }\n          });\n          \n          // Cerrar sidebar al hacer clic fuera de él\n          document.addEventListener('click', (e) => {\n            if (sidebar.classList.contains('mobile-sidebar-active') && \n                !sidebar.contains(e.target) && \n                e.target !== sidebarToggle) {\n              sidebar.classList.remove('mobile-sidebar-active');\n              \n              // Restaurar ícono\n              const toggleIcon = sidebarToggle.querySelector('span');\n              if (toggleIcon) toggleIcon.textContent = '☰';\n            }\n          });\n        }\n      });\n    </script>\n\n    <script>\n      // Script para manejar la autenticación del lado del cliente\n      import { isAuthenticated, getCurrentUser } from '../services/authService';\n      \n      document.addEventListener('DOMContentLoaded', () => {\n        // Si estamos en una página protegida (no login) y no hay autenticación\n        if (window.location.pathname !== '/login' && !isAuthenticated()) {\n          // Redirigir al login con la URL actual como parámetro redirect\n          window.location.href = `/login?redirect=${encodeURIComponent(window.location.pathname)}`;\n        }\n      });\n    </script>\n  </body>\n</html>\n\n<style is:global>\n  /* Estilos globales para la aplicación */\n  \n  /* Scrollbar personalizada */\n  ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n  \n  ::-webkit-scrollbar-track {\n    background: #f1f1f1;\n    border-radius: 4px;\n  }\n  \n  ::-webkit-scrollbar-thumb {\n    background: #888;\n    border-radius: 4px;\n  }\n  \n  ::-webkit-scrollbar-thumb:hover {\n    background: #555;\n  }\n  \n  /* Clases de utilidad */\n  .text-shadow {\n    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);\n  }\n  \n  /* Estilos para sidebar móvil */\n  .masclet-sidebar {\n    transition: transform 0.3s ease-in-out;\n  }\n  \n  @media (max-width: 768px) {\n    .masclet-sidebar {\n      position: fixed;\n      top: 0;\n      left: 0;\n      height: 100vh;\n      transform: translateX(-100%);\n      z-index: 50;\n    }\n    \n    .mobile-sidebar-active {\n      transform: translateX(0);\n      box-shadow: 0 0 15px rgba(0,0,0,0.2);\n    }\n  }\n  \n  /* Estilo para optimizar uso en campo con guantes */\n  @media (max-width: 640px) {\n    button, \n    a, \n    [role=\"button\"],\n    input[type=\"checkbox\"],\n    input[type=\"radio\"] {\n      min-height: 44px; /* Tamaño mínimo recomendado para controles táctiles */\n    }\n    \n    select, \n    input[type=\"text\"],\n    input[type=\"email\"],\n    input[type=\"password\"],\n    input[type=\"number\"] {\n      font-size: 16px; /* Evita zoom automático en iOS */\n      min-height: 44px;\n    }\n  }\n  \n  /* Modo de alto contraste para uso en exteriores */\n  @media (max-width: 640px) {\n    .high-contrast-mode {\n      --contrast-bg: #000000;\n      --contrast-text: #ffffff;\n      --contrast-primary: #ffcc00;\n    }\n    \n    .high-contrast-mode body {\n      background-color: var(--contrast-bg);\n      color: var(--contrast-text);\n    }\n    \n    .high-contrast-mode a,\n    .high-contrast-mode button {\n      color: var(--contrast-primary);\n    }\n  }\n</style>"],"names":["$$createAstro","$$createComponent","Astro","$$render","$$renderHead","$$renderComponent","$$result","Navbar","Sidebar","$$renderSlot","Footer"],"mappings":";;;;;;;;AAYA,MAAM,cAAgD,GAAA,CAAC,EAAE,QAAA,EAAe,KAAA;AACtE,EAAA,MAAM,CAAC,UAAA,EAAY,aAAa,CAAA,GAAI,SAAS,IAAI,CAAA;AAEjD,EAAA,SAAA,CAAU,MAAM;AAEd,IAAI,IAAA;AAEF,MAAA,IAAI,CAAC,YAAA,CAAa,OAAQ,CAAA,OAAO,CAAG,EAAA;AAClC,QAAa,YAAA,CAAA,OAAA,CAAQ,SAAS,oFAAoF,CAAA;AAClH,QAAA,OAAA,CAAQ,IAAI,kDAAkD,CAAA;AAAA;AAIhE,MAAA,aAAA,CAAc,IAAI,CAAA;AAAA,aACX,KAAO,EAAA;AACd,MAAQ,OAAA,CAAA,KAAA,CAAM,4BAA4B,KAAK,CAAA;AAE/C,MAAA,aAAA,CAAc,IAAI,CAAA;AAAA;AACpB,GAiCF,EAAG,EAAE,CAAA;AAGL,EAAA,uCAAU,QAAS,EAAA,CAAA;AAyBrB,CAAA;;;;;;AC3FA,MAAA,UAAAA,WAAA,EAAA;AAAA,MAAA,eAAA,GAAAC,eAAA,CAAA,CAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,MAAAC,MAAA,GAAA,QAAA,CAAA,WAAA,CAAA,OAAA,EAAA,SAAA,OAAA,CAAA;AAAA,EAAAA,OAAA,IAAA,GAAA,eAAA;AAkBA,EAAM,MAAA;IACJ,KAAQ,GAAA,gBAAA;IACR,QAAW,GAAA;AACb,GAAA,GAAIA,MAAM,CAAA,KAAA;AAGV,EAAM,MAAA,WAAA,GAAcA,OAAM,GAAI,CAAA,QAAA;AAG9B,EAAA,MAAM,OAAOA,MAAM,CAAA,OAAA,CAAQ,GAAI,CAAA,UAAU,GAAG,KAAS,IAAA,QAAA;AA3BrD,EAAA,OAAAC,cAAA,CAAA,EAAA,KAAA,EAAA,GAAA,UAsCiB,CAAA,CAAA,kVAAA,EAAA,2BAAA,EAtCjB,gKAgEM,EAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA1BM,gCAAA,CAAA,CAAA,CAAA,CAAA,EAAA,KAAA,EAtCZC,UAAA,CAAA,CAAA,EAAAC,eAAA,CAAA,QAAA,EAAA,gBAAA,EAAA,cAAA,EAAA,EA2CoB,aAAA,EAAA,IAAA,EAAY,aAAa,EAAA,WAAA,EA3C7C,8BAAA,MAAA,EAAA,uBAAA,EAAA,gFAAA,EAAA,yBAAA,EAAA,SAAA,EAAA,EAAA,EAAA,SAAA,EAAA,CAAAC,SAAAA,KAAAH,cAAA,CAAA,CAAA,EAAAE,eAAA,CAAAC,SAAA,EAAA,QAAA,EAAAC,QAAA,EAAA,EA4Cc,SAAO,KAAO,EAAA,UAAA,EAAU,IAAM,EAAA,aAAA,EAAa,WAAA,EAAlD,CAAA,CAAA,yUAAA,EA5CPF,eAAAC,CAAAA,SAAAA,EAAA,SAAA,EAAAE,SAAA,EAAA,EAoDiB,UAAA,EAAU,IAAM,EAAA,aAAA,EAAa,aAArC,CAAA,CApDT,oRAAA,EAAAC,UAAA,CAAAH,SAAA,EAAA,OAAA,CAAA,SAAA,CA0Da,CAAA,CA1Db,uBAAA,EAAAD,eAAA,CAAAC,SAAA,EAAA,QAAA,EAAAI,QAAA,EAAA,EA+DO,CAAA,KACD,CAAA,CAAA;AAhEN,CAAA,EAAA,mFAAA,MAAA;;;;"}