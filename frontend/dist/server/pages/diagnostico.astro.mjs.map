{"version":3,"file":"diagnostico.astro.mjs","sources":["../../../src/components/debug/LoginDebugger.tsx","../../../src/pages/diagnostico.astro"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { jwtDecode } from 'jwt-decode';\n\n/**\n * Componente para depurar el proceso de login\n * Muestra información detallada sobre el token y usuario actual\n */\nexport const LoginDebugger = () => {\n  const [tokenInfo, setTokenInfo] = useState<any>(null);\n  const [userInfo, setUserInfo] = useState<any>(null);\n  const [showDebugger, setShowDebugger] = useState<boolean>(true);\n\n  useEffect(() => {\n    try {\n      // Obtener token\n      const token = localStorage.getItem('token');\n      if (token) {\n        try {\n          const decoded = jwtDecode<any>(token);\n          setTokenInfo(decoded);\n        } catch (error) {\n          console.error('Error al decodificar token:', error);\n        }\n      }\n\n      // Obtener usuario\n      const userJson = localStorage.getItem('user');\n      if (userJson) {\n        try {\n          const user = JSON.parse(userJson);\n          setUserInfo(user);\n        } catch (error) {\n          console.error('Error al parsear usuario:', error);\n        }\n      }\n    } catch (error) {\n      console.error('Error general:', error);\n    }\n  }, []);\n\n  const toggleDebugger = () => {\n    setShowDebugger(!showDebugger);\n  };\n\n  if (!tokenInfo && !userInfo) {\n    return <div className=\"bg-gray-100 p-3 rounded-lg mb-4\">No hay información de sesión</div>;\n  }\n\n  return (\n    <div className=\"bg-gray-100 p-3 rounded-lg mb-4 text-xs\">\n      <div className=\"flex justify-between items-center mb-2\">\n        <h3 className=\"font-bold\">Depurador de Login</h3>\n        <button \n          onClick={toggleDebugger}\n          className=\"text-blue-500 hover:text-blue-700\"\n        >\n          {showDebugger ? 'Ocultar' : 'Mostrar'}\n        </button>\n      </div>\n\n      {showDebugger && (\n        <div>\n          <div className=\"mb-3\">\n            <h4 className=\"font-semibold\">Token JWT:</h4>\n            <pre className=\"bg-white p-2 rounded overflow-auto max-h-32\">\n              {JSON.stringify(tokenInfo, null, 2)}\n            </pre>\n            \n            <div className=\"mt-2\">\n              <div><strong>Sub:</strong> {tokenInfo?.sub}</div>\n              <div><strong>Username:</strong> {tokenInfo?.username}</div>\n              <div><strong>Role:</strong> {tokenInfo?.role}</div>\n              <div><strong>Exp:</strong> {tokenInfo?.exp ? new Date(tokenInfo.exp * 1000).toLocaleString() : 'N/A'}</div>\n            </div>\n          </div>\n\n          <div>\n            <h4 className=\"font-semibold\">Usuario en localStorage:</h4>\n            <pre className=\"bg-white p-2 rounded overflow-auto max-h-32\">\n              {JSON.stringify(userInfo, null, 2)}\n            </pre>\n\n            <div className=\"mt-2\">\n              <div><strong>Username:</strong> {userInfo?.username}</div>\n              <div><strong>Rol:</strong> {userInfo?.role}</div>\n              <div><strong>Email:</strong> {userInfo?.email}</div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LoginDebugger;\n","---\n// Importar el layout principal\nimport MainLayout from '../components/layout/MainLayout.astro';\nimport LoginDebugger from '../components/debug/LoginDebugger';\n---\n\n<MainLayout title=\"Diagnóstico de Roles\">\n  <div class=\"container mx-auto px-4 py-8\">\n    <h1 class=\"text-3xl font-bold mb-6\">Diagnóstico de Sistema de Roles</h1>\n    \n    <div class=\"bg-white shadow-md rounded-lg p-6 mb-8\">\n      <h2 class=\"text-xl font-semibold mb-4\">Información de la sesión actual</h2>\n      \n      <LoginDebugger client:load />\n      \n      <div class=\"mt-6\">\n        <h3 class=\"font-semibold mb-2\">Instrucciones:</h3>\n        <ol class=\"list-decimal pl-5 space-y-2\">\n          <li>Revisa la información de arriba para ver si tu rol detectado coincide con tu usuario</li>\n          <li>Si el rol no coincide, cierra sesión y vuelve a entrar</li>\n          <li>Si sigue sin funcionar, prueba a borrar el localStorage: \n            <button id=\"clearStorage\" class=\"bg-red-500 hover:bg-red-700 text-white px-3 py-1 rounded ml-2 text-sm\">\n              Borrar datos de sesión\n            </button>\n          </li>\n        </ol>\n      </div>\n    </div>\n    \n    <div class=\"bg-white shadow-md rounded-lg p-6\">\n      <h2 class=\"text-xl font-semibold mb-4\">Prueba de rutas de acceso</h2>\n      \n      <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <a href=\"/\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Dashboard</div>\n          <div class=\"text-sm text-gray-500\">Acceso: Todos los roles</div>\n        </a>\n        \n        <a href=\"/animals\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Animales</div>\n          <div class=\"text-sm text-gray-500\">Acceso: Todos los roles</div>\n        </a>\n        \n        <a href=\"/explotaciones-react\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Explotaciones</div>\n          <div class=\"text-sm text-gray-500\">Acceso: Todos los roles</div>\n        </a>\n        \n        <a href=\"/users\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Usuarios</div>\n          <div class=\"text-sm text-gray-500\">Acceso: administrador, Ramon</div>\n        </a>\n        \n        <a href=\"/imports\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Importación</div>\n          <div class=\"text-sm text-gray-500\">Acceso: Solo administrador</div>\n        </a>\n        \n        <a href=\"/backup\" class=\"block p-4 border rounded hover:bg-gray-50 transition\">\n          <div class=\"font-medium\">Backup</div>\n          <div class=\"text-sm text-gray-500\">Acceso: Solo administrador</div>\n        </a>\n      </div>\n    </div>\n  </div>\n</MainLayout>\n\n<script>\n  // Script para borrar el localStorage\n  document.addEventListener('DOMContentLoaded', () => {\n    const clearButton = document.getElementById('clearStorage');\n    if (clearButton) {\n      clearButton.addEventListener('click', () => {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        alert('Datos de sesión eliminados. Por favor, vuelve a iniciar sesión.');\n        window.location.href = '/login';\n      });\n    }\n  });\n</script>\n"],"names":["$$createComponent","$$render","$$renderComponent","MainLayout","$$result","$$maybeRenderHead"],"mappings":"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"}