{"version":3,"file":"login-test.astro.mjs","sources":["../../../src/pages/login-test.astro"],"sourcesContent":["---\nimport DefaultLayout from '../layouts/DefaultLayout.astro';\n---\n\n<DefaultLayout title=\"Test Login - Masclet Imperi\">\n  <div class=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n    <div class=\"max-w-md w-full space-y-8\">\n      <div>\n        <h2 class=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\n          Iniciar sesión (Prueba de roles)\n        </h2>\n        <p class=\"mt-2 text-center text-sm text-gray-600\">\n          Selecciona el rol para probar los permisos\n        </p>\n      </div>\n      <div class=\"mt-8 bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10\">\n        <form id=\"loginForm\" class=\"space-y-6\">\n          <div>\n            <label for=\"username\" class=\"block text-sm font-medium text-gray-700\">\n              Usuario\n            </label>\n            <div class=\"mt-1\">\n              <input id=\"username\" name=\"username\" type=\"text\" required class=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" value=\"admin\">\n            </div>\n          </div>\n\n          <div>\n            <label for=\"password\" class=\"block text-sm font-medium text-gray-700\">\n              Contraseña\n            </label>\n            <div class=\"mt-1\">\n              <input id=\"password\" name=\"password\" type=\"password\" required class=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\" value=\"admin123\">\n            </div>\n          </div>\n\n          <div>\n            <label for=\"role\" class=\"block text-sm font-medium text-gray-700\">\n              Rol para pruebas\n            </label>\n            <div class=\"mt-1\">\n              <select id=\"role\" name=\"role\" class=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\">\n                <option value=\"administrador\">Administrador</option>\n                <option value=\"gerente\">Ramon</option>\n                <option value=\"editor\">Editor</option>\n                <option value=\"usuario\">Usuario (solo lectura)</option>\n              </select>\n            </div>\n          </div>\n\n          <div>\n            <button type=\"submit\" class=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\">\n              Iniciar sesión como rol seleccionado\n            </button>\n          </div>\n        </form>\n        \n        <div id=\"loginStatus\" class=\"mt-4 text-sm hidden\"></div>\n        \n        <div class=\"mt-6\">\n          <div class=\"relative\">\n            <div class=\"absolute inset-0 flex items-center\">\n              <div class=\"w-full border-t border-gray-300\"></div>\n            </div>\n            <div class=\"relative flex justify-center text-sm\">\n              <span class=\"px-2 bg-white text-gray-500\">\n                Modo de prueba - Masclet Imperi\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</DefaultLayout>\n\n<script>\n  // Importar el servicio de API\n  import { login } from '../services/apiService';\n  \n  document.addEventListener('DOMContentLoaded', () => {\n    // Verificar si ya hay un token válido\n    const token = localStorage.getItem('token');\n    if (token) {\n      // Limpiar el token existente si estamos en la página de prueba\n      localStorage.removeItem('token');\n      localStorage.removeItem('user_role');\n    }\n    \n    const loginForm = document.getElementById('loginForm');\n    const loginStatus = document.getElementById('loginStatus');\n    \n    loginForm?.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      \n      const username = (document.getElementById('username') as HTMLInputElement)?.value;\n      const password = (document.getElementById('password') as HTMLInputElement)?.value;\n      const role = (document.getElementById('role') as HTMLSelectElement)?.value;\n      \n      if (!username || !password) {\n        showStatus('Por favor, complete todos los campos', 'error');\n        return;\n      }\n      \n      showStatus('Iniciando sesión...', 'info');\n      \n      try {\n        // Usar el servicio de API para iniciar sesión\n        const data = await login(username, password);\n        \n        // Guardar el rol seleccionado para pruebas\n        localStorage.setItem('user_role', role);\n        \n        showStatus(`Inicio de sesión exitoso como: ${role}. Redirigiendo...`, 'success');\n        \n        // Redirigir a la página principal después de 1 segundo\n        setTimeout(() => {\n          window.location.href = '/';\n        }, 1000);\n      } catch (error) {\n        console.error('Error al iniciar sesión:', error);\n        showStatus(`Error al iniciar sesión: ${error.message || 'Error desconocido'}`, 'error');\n      }\n    });\n    \n    // Función para mostrar mensajes de estado\n    function showStatus(message: string, type: 'success' | 'error' | 'info') {\n      if (!loginStatus) return;\n      \n      loginStatus.textContent = message;\n      loginStatus.classList.remove('hidden', 'text-green-500', 'text-red-500', 'text-blue-500');\n      \n      switch (type) {\n        case 'success':\n          loginStatus.classList.add('text-green-500');\n          break;\n        case 'error':\n          loginStatus.classList.add('text-red-500');\n          break;\n        case 'info':\n          loginStatus.classList.add('text-blue-500');\n          break;\n      }\n    }\n  });\n</script>\n"],"names":["$$createComponent","$$render","$$renderComponent","DefaultLayout","$$result","$$maybeRenderHead"],"mappings":";;;;;AAAA,MAAA,WAAA,GAAAA,eAAA,CAAA,OAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,OAAAC,iBAAAC,eAAA,CAAA,QAAA,EAAA,eAAA,EAAAC,eAAA,EAAA,EAIe,OAJf,EAAA,6BAAA,EAAA,EAAA,EAAA,WAAA,OAAAC,SAAAA,KAAAH,cAAA,CAAA,CAAA,EAAAI,eAAA,CAAA,CAAA,CAAA;;;;;;;;;;;;;;AAAA,kDAAA,CAAA,EAyEE,CAAA,CAAA,CAAA,CAAA;AAzEF,CAAA,EAAA,8EAAA,MAAA,CAAA;;;;;;;;;;;;;;;;"}