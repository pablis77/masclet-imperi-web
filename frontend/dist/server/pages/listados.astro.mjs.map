{"version":3,"file":"listados.astro.mjs","sources":["../../../src/pages/listados/index.astro"],"sourcesContent":["---\nimport MainLayout from '../../components/layout/MainLayout.astro';\nimport { getCurrentLanguage, t } from '../../i18n/config';\n\n// Obtener el idioma actual\nconst currentLang = getCurrentLanguage();\n\n// Traducciones\nconst translations = {\n  es: {\n    title: \"Listados Personalizados\",\n    description: \"Crea y gestiona listados personalizados de animales para vacunación y otros propósitos.\",\n    empty: \"No hay listados personalizados disponibles.\",\n    create: \"Crear Nuevo Listado\",\n    loading: \"Cargando listados...\",\n    error: \"Error al cargar los listados.\",\n    category: \"Categoría\",\n    animals: \"Animales\",\n    actions: \"Acciones\",\n    view: \"Ver\",\n    edit: \"Editar\",\n    delete: \"Eliminar\",\n    confirmDelete: \"¿Estás seguro de que quieres eliminar este listado?\",\n    \"export\": \"Exportar\",\n    table: {\n      name: \"Nombre\",\n      category: \"Categoría\",\n      animals: \"Animales\",\n      createdAt: \"Creado el\",\n      actions: \"Acciones\"\n    }\n  },\n  ca: {\n    title: \"Llistats Personalitzats\",\n    description: \"Crea i gestiona llistats personalitzats d'animals per a vacunació i altres propòsits.\",\n    empty: \"No hi ha llistats personalitzats disponibles.\",\n    create: \"Crear Nou Llistat\",\n    loading: \"Carregant llistats...\",\n    error: \"Error al carregar els llistats.\",\n    category: \"Categoria\",\n    animals: \"Animals\",\n    actions: \"Accions\",\n    view: \"Veure\",\n    edit: \"Editar\",\n    delete: \"Eliminar\",\n    confirmDelete: \"Estàs segur que vols eliminar aquest llistat?\",\n    \"export\": \"Exportar\",\n    table: {\n      name: \"Nom\",\n      category: \"Categoria\",\n      animals: \"Animals\",\n      createdAt: \"Creat el\",\n      actions: \"Accions\"\n    }\n  }\n};\n\n// Función para traducir (simplificada)\nfunction t(key) {\n  return translations[currentLang][key] || key;\n}\n\n// Función para traducir claves anidadas (simplificada)\nfunction tNested(parent, key) {\n  if (translations[currentLang] && translations[currentLang][parent] && translations[currentLang][parent][key]) {\n    return translations[currentLang][parent][key];\n  }\n  return key;\n}\n---\n\n<MainLayout title={t('listings.title', currentLang)}>\n  <div class=\"px-4 py-2 sm:px-6 lg:px-8\">\n    <div class=\"sm:flex sm:items-center mb-2\">\n      <div class=\"sm:flex-auto\">\n        <h1 class=\"text-xl font-semibold text-gray-900 dark:text-white\" data-i18n-key=\"listings.title\">{t('listings.title', currentLang)}</h1>\n        <p class=\"mt-1 text-sm text-gray-700 dark:text-gray-300\" data-i18n-key=\"listings.description\">\n          {t('listings.description', currentLang)}\n        </p>\n      </div>\n      <div class=\"sm:flex-none\">\n        <a \n          href=\"/listados/nuevo\" \n          class=\"inline-flex items-center justify-center rounded-md border border-transparent bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 sm:w-auto\"\n          data-i18n-key=\"listings.create\"\n        >\n          {t('listings.create', currentLang)}\n        </a>\n      </div>\n    </div>\n\n    <div class=\"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg\">\n      <div class=\"overflow-x-auto\">\n        <div id=\"listados-container\" class=\"min-h-[50px] flex items-center justify-center\">\n          <p id=\"loading-message\" class=\"text-gray-500\" data-i18n-key=\"listings.loading\">\n            {t('listings.loading', currentLang)}\n          </p>\n        </div>\n\n        <!-- Plantilla para la tabla (se llena con JavaScript) -->\n        <table id=\"listados-table\" class=\"min-w-full divide-y divide-gray-300 hidden\">\n          <thead class=\"bg-gray-50 dark:bg-gray-700\">\n            <tr>\n              <th scope=\"col\" class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-100\" data-i18n-key=\"listings.table.name\">\n                {t('listings.table.name', currentLang)}\n              </th>\n              <th scope=\"col\" class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-100\" data-i18n-key=\"listings.table.category\">\n                {t('listings.table.category', currentLang)}\n              </th>\n              <th scope=\"col\" class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-100\" data-i18n-key=\"listings.table.animals\">\n                {t('listings.table.animals', currentLang)}\n              </th>\n              <th scope=\"col\" class=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-100\" data-i18n-key=\"listings.table.createdAt\">\n                {t('listings.table.createdAt', currentLang)}\n              </th>\n              <th scope=\"col\" class=\"relative py-3.5 pl-3 pr-4 sm:pr-6\">\n                <span class=\"sr-only\" data-i18n-key=\"listings.table.actions\">{t('listings.table.actions', currentLang)}</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody id=\"listados-body\" class=\"divide-y divide-gray-200 dark:divide-gray-600 bg-white dark:bg-gray-800\">\n            <!-- Se llenará con JavaScript -->\n          </tbody>\n        </table>\n\n        <!-- Mensaje de error (oculto por defecto) -->\n        <div id=\"error-message\" class=\"p-4 text-center text-red-600 hidden\">\n          {t('error')}\n        </div>\n\n        <!-- Mensaje de vacío (oculto por defecto) -->\n        <div id=\"empty-message\" class=\"p-8 text-center text-gray-500 dark:text-gray-400 hidden\">\n          <svg class=\"mx-auto h-12 w-12 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z\" />\n          </svg>\n          <h3 class=\"mt-2 text-sm font-medium text-gray-900 dark:text-gray-100\">{t('empty')}</h3>\n          <p class=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\n            {t('description')}\n          </p>\n          <div class=\"mt-6\">\n            <a\n              href=\"/listados/nuevo\"\n              class=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n            >\n              {t('create')}\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</MainLayout>\n\n<script>\n  // Importar el servicio de listados y sistema de traducciones\n  import * as listadosService from '../../services/listados-service';\n  import { getCurrentLanguage, t } from '../../i18n/config';\n  \n  // Función para actualizar todas las traducciones en la página\n  function updateAllTranslations() {\n    try {\n      const currentLang = getCurrentLanguage();\n      console.log('Listados: Actualizando traducciones al idioma:', currentLang);\n      \n      // Actualizar todos los elementos con atributo data-i18n-key\n      document.querySelectorAll('[data-i18n-key]').forEach(el => {\n        const key = el.getAttribute('data-i18n-key');\n        if (key) {\n          const translation = t(key, currentLang);\n          if (translation !== key) {\n            el.textContent = translation;\n            console.log(`Traducido '${key}' a '${translation}'`);\n          }\n        }\n      });\n\n      // Actualizar también el título de la página\n      const pageTitle = document.getElementById('page-title');\n      if (pageTitle) {\n        pageTitle.textContent = t('listings.title', currentLang);\n      }\n    } catch (error) {\n      console.error('Error al actualizar traducciones:', error);\n    }\n  }\n\n  // Ejecutar traducción inicial y escuchar cambios de idioma\n  document.addEventListener('DOMContentLoaded', () => {\n    // Traducción inicial\n    updateAllTranslations();\n    \n    // Detectar cambios de idioma (escuchar cambios en localStorage)\n    window.addEventListener('storage', function(e) {\n      if (e.key === 'userLanguage') {\n        updateAllTranslations();\n      }\n    });\n  });\n  \n  // Script para cargar los listados desde la API\n  document.addEventListener('DOMContentLoaded', async () => {\n    const listadosContainer = document.getElementById('listados-container');\n    const listadosTable = document.getElementById('listados-table');\n    const listadosBody = document.getElementById('listados-body');\n    const loadingMessage = document.getElementById('loading-message');\n    const errorMessage = document.getElementById('error-message');\n    const emptyMessage = document.getElementById('empty-message');\n\n    // Verificar que el usuario esté autenticado\n    const token = localStorage.getItem('token');\n    if (!token) {\n      window.location.href = '/login';\n      return;\n    }\n\n    // Obtener el idioma actual\n    const currentLang = localStorage.getItem('userLanguage') || 'es';\n    \n    // Traducciones para JavaScript\n    const translations = {\n      es: {\n        view: \"Ver\",\n        edit: \"Editar\",\n        delete: \"Eliminar\",\n        \"export\": \"Exportar\",\n        confirmDelete: \"¿Estás seguro de que quieres eliminar este listado?\",\n        error: \"Error al cargar los listados.\",\n        dateFormat: {\n          day: \"2-digit\",\n          month: \"2-digit\",\n          year: \"numeric\"\n        }\n      },\n      ca: {\n        view: \"Veure\",\n        edit: \"Editar\",\n        delete: \"Eliminar\",\n        \"export\": \"Exportar\",\n        confirmDelete: \"Estàs segur que vols eliminar aquest llistat?\",\n        error: \"Error al carregar els llistats.\",\n        dateFormat: {\n          day: \"2-digit\",\n          month: \"2-digit\",\n          year: \"numeric\"\n        }\n      }\n    };\n\n    // Función para traducir\n    const t = (key) => {\n      return translations[currentLang]?.[key] || key;\n    };\n\n    try {\n      // Cargar los listados usando nuestro servicio seguro\n      const listados = await listadosService.getListados();\n\n      // Ocultar mensaje de carga\n      loadingMessage.classList.add('hidden');\n\n      if (listados.length === 0) {\n        // Mostrar mensaje de vacío\n        emptyMessage.classList.remove('hidden');\n      } else {\n        // Mostrar tabla y llenarla con datos\n        listadosTable.classList.remove('hidden');\n\n        // Limpiar cualquier contenido previo\n        listadosBody.innerHTML = '';\n\n        // Formatear fechas según el idioma\n        const dateFormatter = new Intl.DateTimeFormat(\n          currentLang === 'ca' ? 'ca-ES' : 'es-ES', \n          t('dateFormat')\n        );\n\n        // Añadir cada fila a la tabla\n        listados.forEach(listado => {\n          const row = document.createElement('tr');\n          \n          // Formatear fecha\n          const createdDate = new Date(listado.created_at);\n          const formattedDate = dateFormatter.format(createdDate);\n          \n          row.innerHTML = `\n            <td class=\"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-gray-100 sm:pl-6\">\n              ${listado.nombre}\n            </td>\n            <td class=\"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">\n              ${listado.categoria || '-'}\n            </td>\n            <td class=\"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">\n              ${listado.animales_count || 0}\n            </td>\n            <td class=\"whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">\n              ${formattedDate}\n            </td>\n            <td class=\"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6\">\n              <div class=\"flex justify-end space-x-2\">\n                <a href=\"/listados/${listado.id}\" class=\"inline-flex items-center px-2 py-1 bg-primary text-white rounded hover:bg-primary/80\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\"></path>\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"></path>\n                  </svg>\n                  ${t('view')}\n                </a>\n                <a href=\"/listados/editar/${listado.id}\" class=\"inline-flex items-center px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"></path>\n                  </svg>\n                  ${t('edit')}\n                </a>\n                <button \n                  data-listado-id=\"${listado.id}\" \n                  class=\"delete-button inline-flex items-center px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700\"\n                >\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"></path>\n                  </svg>\n                  ${t('delete')}\n                </button>\n                <!-- Enlace de exportar eliminado -->\n              </div>\n            </td>\n          `;\n          \n          listadosBody.appendChild(row);\n        });\n\n        // Añadir listeners para botones de eliminar\n        document.querySelectorAll('.delete-button').forEach(button => {\n          button.addEventListener('click', async (e) => {\n            const listadoId = e.target.dataset.listadoId;\n            if (confirm(t('confirmDelete'))) {\n              try {\n                // Eliminar el listado usando el servicio\n                await listadosService.deleteListado(listadoId);\n\n                // Recargar la página para mostrar la lista actualizada\n                window.location.reload();\n              } catch (error) {\n                console.error('Error al eliminar listado:', error);\n                alert(error.message);\n              }\n            }\n          });\n        });\n      }\n    } catch (error) {\n      console.error('Error al cargar listados:', error);\n      \n      // Ocultar mensaje de carga\n      loadingMessage.classList.add('hidden');\n      \n      // Mostrar mensaje de error\n      errorMessage.classList.remove('hidden');\n      errorMessage.textContent = `${t('error')} ${error.message}`;\n    }\n  });\n</script>\n"],"names":["$$createComponent","t","$$render","$$renderComponent","MainLayout","$$result","$$maybeRenderHead"],"mappings":";;;;;;AAAA,MAAA,OAAA,GAAAA,eAAA,CAAA,OAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAKA,EAAA,MAAM,cAAc,kBAAmB,EAAA;AAGvC,EAAA,MAAM,YAAe,GAAA;IACnB,EAAI,EAAA;MACF,KAAO,EAAA,yBAAA;MACP,WAAa,EAAA,+FAAA;MACb,KAAO,EAAA,6CAAA;MACP,MAAQ,EAAA,qBAAA;MACR,OAAS,EAAA,sBAAA;MACT,KAAO,EAAA,+BAAA;MACP,QAAU,EAAA,cAAA;MACV,OAAS,EAAA,UAAA;MACT,OAAS,EAAA,UAAA;MACT,IAAM,EAAA,KAAA;MACN,IAAM,EAAA,QAAA;MACN,MAAQ,EAAA,UAAA;MACR,aAAe,EAAA,2DAAA;MACf,QAAU,EAAA,UAAA;MACV,KAAO,EAAA;QACL,IAAM,EAAA,QAAA;QACN,QAAU,EAAA,cAAA;QACV,OAAS,EAAA,UAAA;QACT,SAAW,EAAA,WAAA;QACX,OAAS,EAAA;AACX;AACF,KAAA;IACA,EAAI,EAAA;MACF,KAAO,EAAA,yBAAA;MACP,WAAa,EAAA,6FAAA;MACb,KAAO,EAAA,+CAAA;MACP,MAAQ,EAAA,mBAAA;MACR,OAAS,EAAA,uBAAA;MACT,KAAO,EAAA,iCAAA;MACP,QAAU,EAAA,WAAA;MACV,OAAS,EAAA,SAAA;MACT,OAAS,EAAA,SAAA;MACT,IAAM,EAAA,OAAA;MACN,IAAM,EAAA,QAAA;MACN,MAAQ,EAAA,UAAA;MACR,aAAe,EAAA,kDAAA;MACf,QAAU,EAAA,UAAA;MACV,KAAO,EAAA;QACL,IAAM,EAAA,KAAA;QACN,QAAU,EAAA,WAAA;QACV,OAAS,EAAA,SAAA;QACT,SAAW,EAAA,UAAA;QACX,OAAS,EAAA;AACX;AACF;AACF,GAAA;AAGA,EAAA,SAASC,GAAE,GAAK,EAAA;AACd,IAAA,OAAO,YAAa,CAAA,WAAW,CAAE,CAAA,GAAG,CAAK,IAAA,GAAA;AAC3C;AA5DA,EAAA,OAAAC,iBAAAC,eAAA,CAAA,QAAA,EAAA,YAAA,EAAAC,YAAA,EAAA,EAuEY,OAvEZH,EAAAA,EAAAA,CAAA,gBAAA,GAAA,EAAA,EAAA,WAAA,OAAAI,SAAAA,KAAAH,kBAAAI,eAAAD,CAAA,CAAA,CAAA,6MAAA,EA2EwGJ,GAAE,gBAA6B,CAAC,CAE7HA,qGAAAA,EAAAA,EAAAA,CAAE,sBAAmC,CAAC,CAStCA,8VAAAA,EAAAA,EAAAA,CAAE,iBAA8B,CAAC,mSAS/BA,EAAE,CAAA,kBAA+B,CAAC,CAAA,kVAAA,EAS9BA,EAAE,CAAA,qBAAkC,CAAC,CAAA,qJAAA,EAGrCA,GAAE,yBAAsC,CAAC,CAGzCA,oJAAAA,EAAAA,EAAAA,CAAE,wBAAqC,CAAC,CAGxCA,sJAAAA,EAAAA,EAAAA,CAAE,0BAAuC,CAAC,kIAGmBA,EAAE,CAAA,wBAAqC,CAAC,oTAW3GA,EAAE,CAAA,OAAO,CAAC,CAQ4DA,2fAAAA,EAAAA,EAAAA,CAAE,OAAO,CAAC,CAAA,gEAAA,EAE9EA,EAAE,CAAA,aAAa,CAAC,CAOdA,4RAAAA,EAAAA,EAAAA,CAAE,QAAQ,CAAC,CAAA,yCAAA,CAAA,EAOxB,CAAA,CAAA,CAAA,CAAA;AAvJF,CAAA,EAAA,kFAAA,MAAA,CAAA;;;;;;;;;;;;;;;;"}