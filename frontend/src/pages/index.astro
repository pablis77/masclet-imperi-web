---
import DefaultLayout from '../layouts/DefaultLayout.astro';
import Dashboard2 from '../components/dashboard/Dashboard2';

// Configuración para el layout
const userRole = 'administrador';

// Título para la página
const title = 'Dashboard - Masclet Imperi';
---

<DefaultLayout title={title}>
  <main class="container mx-auto px-4 py-6">
    <Dashboard2 client:only="react" showDebugInfo={true} />
    
    <div class="mt-8 text-center">
      <a href="/dashboard-debug" class="inline-block bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
        Ver Página de Depuración
      </a>
    </div>
  </main>
</DefaultLayout>

<script>
  // Importar funciones de autenticación
  import { isAuthenticated, getUserInfo } from '../services/apiService';
  
  document.addEventListener('DOMContentLoaded', () => {
    const authStatus = document.getElementById('authStatus');
    
    // Verificar autenticación
    if (!isAuthenticated()) {
      if (authStatus) {
        authStatus.classList.remove('hidden');
        authStatus.classList.add('bg-yellow-100', 'border', 'border-yellow-400', 'text-yellow-700');
        authStatus.innerHTML = `
          <p class="font-bold">No has iniciado sesión</p>
          <p>Para ver el dashboard completo, necesitas <a href="/login" class="underline font-semibold">iniciar sesión</a>.</p>
        `;
      }
    } else {
      // Mostrar información del usuario
      const user = getUserInfo();
      if (user && authStatus) {
        authStatus.classList.remove('hidden');
        authStatus.classList.add('bg-green-100', 'border', 'border-green-400', 'text-green-700');
        authStatus.innerHTML = `
          <p class="font-bold">Sesión iniciada</p>
          <p>Bienvenido/a, ${user.username} (${user.role})</p>
          <button id="logoutBtn" class="mt-2 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">Cerrar sesión</button>
        `;
        
        // Añadir evento para cerrar sesión
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn?.addEventListener('click', () => {
          localStorage.removeItem('token');
          localStorage.removeItem('user');
          window.location.reload();
        });
      }
    }
  });
</script>