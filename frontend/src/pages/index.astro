---
// Importar el layout completo
import MainLayout from '../components/layout/MainLayout.astro';

// Importar el componente Dashboard optimizado y funcional
import Dashboard from '../components/dashboard/Dashboard';

// Definir rol de usuario
const userRole = "administrador";

// Función simple para detectar idioma (versión integrada)
function getLanguage() {
  if (typeof localStorage !== 'undefined') {
    const lang = localStorage.getItem('userLanguage');
    return lang === 'ca' ? 'ca' : 'es';
  }
  return 'es';
}

// Traducciones integradas
const translations = {
  es: {
    welcome: "Bienvenido a Masclet Imperi"
  },
  ca: {
    welcome: "Benvingut a Masclet Imperi"
  }
};

// El texto de bienvenida según idioma
const welcomeText = typeof localStorage !== 'undefined' && localStorage.getItem('userLanguage') === 'ca' 
  ? translations.ca.welcome 
  : translations.es.welcome;
---

<!-- Script para crear token JWT automáticamente en desarrollo con comprobación mejorada -->
<script>
  // Crear token JWT para desarrollo - versión mejorada
  window.addEventListener('DOMContentLoaded', () => {
    // Primero eliminar cualquier token antiguo para evitar problemas
    localStorage.removeItem('token');
    
    // Crear token nuevo para asegurar funcionamiento correcto
    console.log('Configurando token JWT para desarrollo');
    localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6NDEwMjQ0NDgwMH0.x');
    console.log('Token JWT creado correctamente');
    
    // Comprobar que realmente se guardó
    const token = localStorage.getItem('token');
    if (token) {
      console.log('✅ Token verificado en localStorage');
    } else {
      console.error('❌ Error: No se pudo guardar el token');
      // Intentar de nuevo
      localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6NDEwMjQ0NDgwMH0.x');
    }
  });
</script>

<MainLayout title="Dashboard Masclet Imperi" userRole={userRole} currentPath="/">
  <div class="mx-auto px-4 py-6 bg-white dark:bg-gray-900">
    <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-8">{welcomeText}</h1>
    
    <!-- Componente Dashboard optimizado - Renderizado solo en el cliente -->
    <Dashboard client:only="react" />
    
    <!-- Botones de prueba eliminados -->
  </div>
</MainLayout>
