---
// Props que pueden ser pasados al componente
interface Props {
  userRole?: string;
  currentPath?: string;
}

// Valores por defecto
const { 
  userRole = "administrador",
  currentPath = "/"
} = Astro.props;

// Definir las secciones del men√∫ seg√∫n roles
const menuSections = [
  {
    title: "NAVEGACI√ìN",
    items: [
      { name: "Dashboard", url: "/", icon: "üìä", roles: ["administrador", "gerente", "editor", "usuario"] },
      { name: "Explotaciones", url: "/explotacions", icon: "üè°", roles: ["administrador", "gerente", "editor", "usuario"] },
      { name: "Explotaciones React", url: "/explotaciones-react", icon: "‚öõÔ∏è", roles: ["administrador", "gerente", "editor", "usuario"] },
      { name: "Animales", url: "/animals", icon: "üêÑ", roles: ["administrador", "gerente", "editor", "usuario"] },
    ]
  },
  {
    title: "ADMINISTRACI√ìN",
    items: [
      { name: "Importaci√≥n", url: "/imports", icon: "üì•", roles: ["administrador"] },
      { name: "Usuarios", url: "/users", icon: "üë•", roles: ["administrador", "gerente"] },
      { name: "Backup", url: "/backup", icon: "üíæ", roles: ["administrador"] },
    ]
  }
];

// Mostrar todas las secciones y elementos sin filtrar por rol
const filteredSections = menuSections;

// Funci√≥n para determinar si un elemento est√° activo
const isActive = (itemUrl: string) => {
  if (itemUrl === '/' && currentPath === '/') return true;
  if (itemUrl !== '/' && currentPath.startsWith(itemUrl)) return true;
  return false;
};
---

<aside class="masclet-sidebar w-64 bg-white dark:bg-gray-800 min-h-screen shadow-md border-r border-gray-100 dark:border-gray-800 z-40">
  <!-- Cabecera del sidebar con logo -->
  <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center">
    <div class="w-24 h-24 mb-3">
      <img src="/images/logo_masclet.png" alt="Masclet Imperi Logo" class="w-full h-full object-contain">
    </div>
    <p class="text-sm text-gray-500 dark:text-gray-300 text-center">Sistema de Gesti√≥n Ganadera</p>
  </div>

  <!-- Bot√≥n para cerrar el sidebar en m√≥vil -->
  <button id="close-sidebar" class="md:hidden absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
    <span class="text-2xl">‚úï</span>
  </button>

  <!-- Navegaci√≥n -->
  <nav class="py-4 overflow-y-auto max-h-[calc(100vh-200px)]">
    {filteredSections.map((section) => (
      <div class="mb-6">
        <h3 class="px-6 mb-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
          {section.title}
        </h3>
        <div class="space-y-1">
          {section.items.map((item) => (
            <a 
              href={item.url} 
              class:list={[
                "flex items-center px-6 py-3 text-sm font-medium transition-colors duration-150",
                {
                  "text-primary-dark bg-primary/10 dark:text-primary-light dark:bg-primary-dark/20 border-r-4 border-primary dark:border-primary-light": isActive(item.url),
                  "text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700": !isActive(item.url)
                }
              ]}
            >
              <span class="text-xl mr-3">{item.icon}</span>
              {item.name}
            </a>
          ))}
        </div>
      </div>
    ))}
  </nav>

  <!-- Eliminado banner de versi√≥n -->
</aside>

<script>
  // Script para manejar el cierre del sidebar en m√≥vil
  document.addEventListener('DOMContentLoaded', () => {
    const closeSidebarButton = document.getElementById('close-sidebar');
    
    if (closeSidebarButton) {
      closeSidebarButton.addEventListener('click', () => {
        // Disparar un evento personalizado para cerrar el sidebar
        document.dispatchEvent(new CustomEvent('close-sidebar'));
      });
    }
  });
</script>

<style>
  /* Estilos espec√≠ficos del sidebar */
  .masclet-sidebar {
    transition: transform 0.3s ease-in-out;
  }
  
  @media (max-width: 768px) {
    .masclet-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 80%; /* Reducir ancho en m√≥vil para mejor usabilidad */
      max-width: 280px;
    }
  }
</style>