---
// Props que pueden ser pasados al componente
interface Props {
  userRole?: string;
  currentPath?: string;
}

// Valores por defecto
const { 
  userRole = "usuario",
  currentPath = "/" 
} = Astro.props;

// Estructura del menú
const menuSections = [
  {
    title: "Principal",
    items: [
      { name: "Dashboard", url: "/", icon: "", roles: ["administrador", "gerente", "editor", "usuario"] },
      { name: "Explotaciones", url: "/explotacions", icon: "", roles: ["administrador", "gerente", "editor", "usuario"] }
    ]
  },
  {
    title: "Gestión",
    items: [
      { name: "Animales", url: "/animals", icon: "", roles: ["administrador", "gerente", "editor", "usuario"] },
      { name: "Partos", url: "/partos", icon: "", roles: ["administrador", "gerente", "editor", "usuario"] },
    ]
  },
  {
    title: "Administración",
    items: [
      { name: "Importación", url: "/imports", icon: "", roles: ["administrador"] },
      { name: "Usuarios", url: "/users", icon: "", roles: ["administrador", "gerente"] },
      { name: "Backup", url: "/backup", icon: "", roles: ["administrador"] }
    ]
  }
];

// Función para determinar si un elemento está activo
const isActive = (itemUrl: string) => {
  if (itemUrl === '/' && currentPath === '/') return true;
  if (itemUrl !== '/' && currentPath.startsWith(itemUrl)) return true;
  return false;
};

// Filtrar menú por rol
const filteredSections = menuSections.map(section => ({
  ...section,
  items: section.items.filter(item => item.roles.includes(userRole))
})).filter(section => section.items.length > 0);
---

<aside class="masclet-sidebar w-64 bg-white dark:bg-gray-800 min-h-screen shadow-md border-r border-gray-100 dark:border-gray-800 z-40">
  <!-- Cabecera del sidebar con logo -->
  <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center">
    <div class="w-24 h-24 mb-3">
      <img src="/images/logo_masclet.png" alt="Masclet Imperi Logo" class="w-full h-full object-contain" />
    </div>
    <p class="text-sm text-text-secondary dark:text-gray-300 text-center">Sistema de Gestión Ganadera</p>
  </div>

  <!-- Botón para cerrar el sidebar en móvil -->
  <button id="close-sidebar" class="md:hidden absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
    <span class="text-2xl"></span>
  </button>

  <!-- Navegación principal -->
  <nav class="p-4 overflow-y-auto h-[calc(100vh-18rem)]">
    {filteredSections.map(section => (
      <div class="mb-6">
        <h3 class="text-xs font-semibold text-text-muted dark:text-gray-400 uppercase tracking-wider mb-3 px-3">
          {section.title}
        </h3>
        <ul class="space-y-1">
          {section.items.map(item => (
            <li>
              <a 
                href={item.url}
                class:list={[
                  "flex items-center px-4 py-3 rounded-md text-sm transition-colors duration-150",
                  {
                    "bg-primary/10 dark:bg-primary/20 text-primary dark:text-primary-light font-medium": isActive(item.url),
                    "text-text-primary dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-primary dark:hover:text-primary-light": !isActive(item.url)
                  }
                ]}
              >
                <span class="mr-3 text-xl">{item.icon}</span>
                {item.name}
              </a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </nav>

  <!-- Pie con información de usuario -->
  <div class="p-4 mt-auto border-t border-gray-100 dark:border-gray-700 absolute bottom-0 w-full bg-white dark:bg-gray-800">
    <div class="flex flex-col space-y-2">
      <!-- Rol del usuario -->
      <div class="flex items-center text-sm text-text-secondary dark:text-gray-300 rounded-md p-2 bg-tertiary/10 dark:bg-gray-700">
        <span class="mr-2"></span>
        <span class="font-medium">Rol: <span class="text-primary dark:text-primary-light capitalize">{userRole}</span></span>
      </div>
      
      <!-- Indicador de versión -->
      <div class="text-xs text-gray-500 dark:text-gray-400 text-center">
        v1.0.0 - 2025 Masclet Imperi
      </div>
    </div>
  </div>
</aside>

<script>
  // Manejar cierre del sidebar en móvil
  const closeSidebarBtn = document.getElementById('close-sidebar');
  const sidebar = document.querySelector('.masclet-sidebar');
  
  if (closeSidebarBtn && sidebar) {
    closeSidebarBtn.addEventListener('click', () => {
      sidebar.classList.remove('mobile-sidebar-active');
    });
  }
  
  // Cerrar sidebar al hacer clic en un enlace (en móvil)
  const sidebarLinks = sidebar?.querySelectorAll('a');
  if (sidebarLinks) {
    sidebarLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth < 768) {
          sidebar?.classList.remove('mobile-sidebar-active');
        }
      });
    });
  }
</script>

<style>
  /* Asegurar que los enlaces son fáciles de tocar en móvil */
  @media (max-width: 640px) {
    nav a {
      min-height: 50px;
    }
  }
</style>