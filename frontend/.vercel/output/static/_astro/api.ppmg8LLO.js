import{c as h}from"./vendor.DPE1g--N.js";import{e as E,A as m,a as R,b as T,T as $,i as y}from"./apiConfigAdapter.B0N4Zv2p.js";const f=E;let d=m,v=y;const g=d;console.log("üåé Modo de conexi√≥n:",f);console.log("üîå API Base URL:",d);console.log("üîó URLs Relativas:",v?"S√ç":"NO");console.log("üåé [api.ts] Modo de conexi√≥n:",f);console.log("üîå [api.ts] API Base URL:",d||"URL relativa");const i=h.create({baseURL:d,timeout:T,headers:R,validateStatus:function(e){return e>=200&&e<500}});i.interceptors.request.use(e=>{const o=localStorage.getItem($);if(o&&e.headers)e.headers.Authorization=`Bearer ${o}`;else if(console.warn("‚ö†Ô∏è No se encontr√≥ token JWT para autenticar la petici√≥n"),console.log("URL de la petici√≥n:",e.url),console.log("M√©todo:",e.method),console.log("Headers actuales:",e.headers),typeof window<"u"){console.log("Contenido de localStorage:");for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a){const n=localStorage.getItem(a);console.log(`- ${a}: ${n?n.substring(0,20)+"...":"null"}`)}}}return e},e=>(console.error("Error en interceptor de peticiones:",e),Promise.reject(e)));i.interceptors.response.use(e=>{if(console.log("Respuesta del servidor recibida:",{url:e.config.url,status:e.status,statusText:e.statusText,headers:e.headers,contentType:e.headers["content-type"]}),console.log("Cuerpo completo de la respuesta:",e),console.log("Datos de la respuesta (data):",e.data),console.log("Tipo de data:",typeof e.data),typeof e.data=="string"&&e.data.trim().startsWith("{"))try{console.log("Intentando parsear respuesta como JSON...");const o=JSON.parse(e.data);return console.log("Datos parseados:",o),o}catch(o){console.warn("Error al parsear respuesta como JSON:",o)}if(e.data===void 0&&(console.warn("Respuesta con data undefined, verificando respuesta bruta..."),e.status===200)){if(e.request&&e.request.response)try{console.log("Intentando extraer datos de request.response...");const o=e.request.response;if(typeof o=="string"){const t=JSON.parse(o);return console.log("Datos extra√≠dos de request.response:",t),t}}catch(o){console.warn("Error al procesar request.response:",o)}return console.warn("No se pudieron extraer datos de la respuesta, devolviendo objeto vac√≠o"),{}}return e.data&&typeof e.data=="object"&&e.data.hasOwnProperty("data")?(console.log("Extrayendo datos de response.data.data"),e.data.data):e.data||{}},e=>{if(e.response){e.response.status===401&&(localStorage.removeItem("token"),window.location.href="/login");const o=e.response.data,t=o.detail||o.message||"Error desconocido";return Promise.reject({message:t,status:e.response.status,code:o.code||"ERROR"})}return e.request?Promise.reject({message:"No se pudo conectar con el servidor. Por favor, verifique su conexi√≥n.",status:0,code:"NETWORK_ERROR"}):Promise.reject({message:e.message||"Ocurri√≥ un error al procesar la solicitud",status:500,code:"UNKNOWN_ERROR"})});async function w(e,o={}){try{const t=new URLSearchParams;Object.entries(o).forEach(([c,u])=>{u!=null&&t.append(c,String(u))});let a;t.append("endpoint",e),a=`${g}/proxy?${t.toString()}`,console.log("üîç Fetching data:",a);const n=localStorage.getItem("token"),l={"Content-Type":"application/json"};n&&(l.Authorization=`Bearer ${n}`);const s=await fetch(a,{headers:l});if(!s.ok){const c=await s.json().catch(()=>({message:s.statusText}));throw console.error(`‚ùå Error ${s.status} en GET ${e}:`,c),new Error(c.message||`Error ${s.status}: ${s.statusText}`)}const r=await s.json();return console.log(`‚úÖ Respuesta GET ${e}:`,r),r}catch(t){throw console.error(`‚ùå Error en fetchData (${e}):`,t),{message:t.message||"No se pudo conectar con el servidor. Por favor, verifica tu conexi√≥n.",status:t.status||0,code:t.code||"NETWORK_ERROR"}}}async function p(e,o={},t="POST"){try{const a=localStorage.getItem("token"),n={"Content-Type":"application/json"};a&&(n.Authorization=`Bearer ${a}`);let l,s;l=`${g}/proxy`,s=JSON.stringify({endpoint:e,data:o,method:t}),console.log(`üì§ ${t}:`,l,o);const r=await fetch(l,{method:"POST",headers:n,body:s});if(!r.ok){const u=await r.json().catch(()=>({message:r.statusText}));throw console.error(`‚ùå Error ${r.status} en ${t} ${e}:`,u),new Error(u.message||u.detail||`Error ${r.status}: ${r.statusText}`)}const c=await r.json();return console.log(`‚úÖ Respuesta ${t} ${e}:`,c),c}catch(a){throw console.error(`‚ùå Error en ${t} (${e}):`,a),{message:a.message||"No se pudo conectar con el servidor. Por favor, verifica tu conexi√≥n.",status:a.status||0,code:a.code||"NETWORK_ERROR"}}}async function O(e,o={}){try{const t=localStorage.getItem("token"),a={"Content-Type":"application/json"};t&&(a.Authorization=`Bearer ${t}`);let n,l=JSON.stringify(o);n=`${g}${e}`,console.log("üîß PATCH:",n,o);const s=await fetch(n,{method:"PATCH",headers:a,body:l});if(!s.ok){const c=await s.json().catch(()=>({message:s.statusText}));throw console.error(`‚ùå Error ${s.status} en PATCH ${e}:`,c),new Error(c.message||c.detail||`Error ${s.status}: ${s.statusText}`)}const r=await s.json();return console.log(`‚úÖ Respuesta PATCH ${e}:`,r),r}catch(t){throw console.error(`Error en patchData (${e}):`,t),{message:t.message||"No se pudo conectar con el servidor. Por favor, verifique su conexi√≥n.",status:t.status||0,code:t.code||"NETWORK_ERROR"}}}async function P(e,o={}){return p(e,o,"PUT")}async function D(e,o={}){return p(e,o,"DELETE")}function S(e,o,t="Ha ocurrido un error. Por favor, int√©ntelo de nuevo."){console.error("API Error:",e),e.code==="NETWORK_ERROR"?o("No se pudo conectar con el servidor. Por favor, verifique su conexi√≥n."):e.message?o(e.message):o(e.message||t)}i.fetchData=w;i.postData=p;i.putData=P;i.deleteData=D;i.handleApiError=S;i.patchData=O;export{i as a};
