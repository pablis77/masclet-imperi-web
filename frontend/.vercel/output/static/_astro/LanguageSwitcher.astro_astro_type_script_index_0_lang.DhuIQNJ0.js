import{_ as P}from"./vendor.DPE1g--N.js";document.addEventListener("DOMContentLoaded",()=>{const e={es:{dashboard:"Dashboard",animals:"Animales",exploitations:"Explotaciones",users:"Usuarios",imports:"Importación",backup:"Copias de seguridad",navigation:"NAVEGACIÓN",admin:"ADMINISTRACIÓN",management_system:"Sistema de Gestión Ganadera",profile:"Perfil",logout:"Cerrar sesión",animal_file:"Ficha de Animal"},ca:{dashboard:"Tauler de control",animals:"Animals",exploitations:"Explotacions",users:"Usuaris",imports:"Importació",backup:"Còpies de seguretat",navigation:"NAVEGACIÓ",admin:"ADMINISTRACIÓ",management_system:"Sistema de Gestió Ramadera",profile:"Perfil",logout:"Tancar sessió",animal_file:"Fitxa d'Animal"}};function s(a,i){return e[i]?.[a]||a}function t(){const a=localStorage.getItem("userLanguage")||"es",i=document.getElementById("page-title");i&&(window.location.pathname.includes("/animals/")?i.textContent=s("animal_file",a):window.location.pathname==="/"||window.location.pathname==="/dashboard"?i.textContent=a==="ca"?"Tauler de control Masclet Imperi":"Dashboard Masclet Imperi":window.location.pathname.includes("/explotaciones")?i.textContent=a==="ca"?"Explotacions":"Explotaciones":window.location.pathname.includes("/imports")?i.textContent=a==="ca"?"Importació de Dades":"Importación de Datos":window.location.pathname.includes("/backup")&&(i.textContent=a==="ca"?"Còpies de seguretat del Sistema":"Backup del Sistema")),document.querySelectorAll("nav a").forEach(d=>{d.style.display==="none"&&(d.style.display=""),d.hasAttribute("data-roles")&&d.removeAttribute("data-roles");const h=d.textContent.trim(),A=h.match(/^([\u{1F300}-\u{1F5FF}\u{1F900}-\u{1F9FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F1E6}-\u{1F1FF}\u{1F191}-\u{1F251}\u{1F004}\u{1F0CF}\u{1F170}-\u{1F171}\u{1F17E}-\u{1F17F}\u{1F18E}\u{3030}\u{2B50}\u{2B55}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2B1B}-\u{2B1C}\u{3297}\u{3299}\u{303D}\u{00A9}\u{00AE}\u{2122}\u{23F3}\u{24C2}\u{23E9}-\u{23EF}\u{25B6}\u{23F8}-\u{23FA}]+)/u),_=A?A[0]+" ":"";let L="";h.includes("Dashboard")?L="dashboard":h.includes("Animales")?L="animals":h.includes("Explotaciones")?L="exploitations":h.includes("Usuarios")?L="users":h.includes("Importación")?L="imports":h.includes("Backup")&&(L="backup"),L&&(d.innerHTML=_+s(L,a))});const g=document.querySelector(".font-bold.text-xl");g&&g.textContent.includes("Gestión de Animales")&&(g.textContent=a==="ca"?"Gestió d'Animals":"Gestión de Animales")}t(),window.addEventListener("storage",function(a){a.key==="userLanguage"&&t()});const l=document.getElementById("mobile-menu-button"),n=document.getElementById("close-mobile-menu"),o=document.getElementById("mobile-menu");document.getElementById("profile-button");const r=document.getElementById("notifications-button"),c=document.getElementById("language-selector"),u=document.getElementById("mobile-language-selector"),m=document.getElementById("notifications-menu"),p=()=>{o&&(o.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},f=()=>{o&&(o.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};l&&l.addEventListener("click",p),n&&n.addEventListener("click",f),o&&o.addEventListener("click",a=>{a.target===o&&f()}),r&&m&&(r.addEventListener("click",a=>{a.stopPropagation(),m.classList.toggle("hidden")}),document.addEventListener("click",a=>{!r.contains(a.target)&&!m.contains(a.target)&&m.classList.add("hidden")}));const E=()=>{const a=document.documentElement.classList.contains("dark"),i=document.getElementById("theme-toggle-light-icon"),g=document.getElementById("theme-toggle-dark-icon"),d=document.getElementById("mobile-theme-toggle-light-icon"),h=document.getElementById("mobile-theme-toggle-dark-icon");a?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"),i&&i.classList.remove("hidden"),g&&g.classList.add("hidden"),d&&d.classList.remove("hidden"),h&&h.classList.add("hidden")):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),i&&i.classList.add("hidden"),g&&g.classList.remove("hidden"),d&&d.classList.add("hidden"),h&&h.classList.remove("hidden"))},v=localStorage.getItem("theme"),C=window.matchMedia("(prefers-color-scheme: dark)").matches;if(v==="dark"||!v&&C){document.documentElement.classList.add("dark");const a=document.getElementById("theme-toggle-light-icon"),i=document.getElementById("theme-toggle-dark-icon"),g=document.getElementById("mobile-theme-toggle-light-icon"),d=document.getElementById("mobile-theme-toggle-dark-icon");a&&a.classList.add("hidden"),i&&i.classList.remove("hidden"),g&&g.classList.add("hidden"),d&&d.classList.remove("hidden")}else{document.documentElement.classList.remove("dark");const a=document.getElementById("theme-toggle-light-icon"),i=document.getElementById("theme-toggle-dark-icon"),g=document.getElementById("mobile-theme-toggle-light-icon"),d=document.getElementById("mobile-theme-toggle-dark-icon");a&&a.classList.remove("hidden"),i&&i.classList.add("hidden"),g&&g.classList.remove("hidden"),d&&d.classList.add("hidden")}const b=document.getElementById("theme-toggle"),F=document.getElementById("mobile-theme-toggle");b&&b.addEventListener("click",E),F&&F.addEventListener("click",E);function N(){const a=localStorage.getItem("userLanguage")||"es";c&&(c.value=a,c.addEventListener("change",()=>{const i=c.value;localStorage.setItem("userLanguage",i),window.location.reload()})),u&&(u.value=a,u.addEventListener("change",()=>{const i=u.value;localStorage.setItem("userLanguage",i),window.location.reload()}))}N()});let k=0,B="";function I(e=!1,s="silent"){const t=document.getElementById("user-role-display");if(!t)return;const l=localStorage.getItem("token");if(e||!l){t.textContent="---";return}if(t.textContent&&t.dataset.processed==="true")return;try{let m=function(v){const x=v.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),b=decodeURIComponent(atob(x).split("").map(F=>"%"+("00"+F.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(b)};var n=m;const p=m(l),f=p.sub||"",E=p.role||"";if((s==="verbose"||B!==E&&Date.now()-k>5e3)&&(k=Date.now(),B=E),E){t.textContent=E,localStorage.setItem("userRole",E),localStorage.setItem("username",f),t.dataset.processed="true";return}}catch{}const o=localStorage.getItem("username"),r=localStorage.getItem("userRole"),c=localStorage.getItem("user");if(o==="Ramon"||r==="Ramon"){t.textContent="Ramon",localStorage.setItem("userRole","Ramon"),t.dataset.processed="true";return}if(r)t.textContent=r,t.dataset.processed="true";else if(c)try{const m=JSON.parse(c);t.textContent=m.role||"usuario",t.dataset.processed="true"}catch{t.textContent="usuario"}else t.textContent="usuario"}document.addEventListener("DOMContentLoaded",()=>{I(!1,"verbose")});window.addEventListener("storage",e=>{(e.key==="token"||e.key==="user"||e.key==="userRole"||e.key==="username")&&I(!1,"verbose")});const q=document.referrer.includes("/login");q&&(I(!1,"verbose"),setTimeout(()=>I(!1,"verbose"),500));let T;document.addEventListener("click",()=>{clearTimeout(T),T=setTimeout(()=>I(),100)});document.addEventListener("DOMContentLoaded",()=>{const e={es:{dashboard:"Dashboard",animals:"Animales",listings:"Listados",exploitations:"Explotaciones",users:"Usuarios",imports:"Importación",backup:"Copias de seguridad",management_system:"Sistema de Gestión",administrador:"Administrador",gerente:"Ramon",editor:"Editor",usuario:"Usuario"},ca:{dashboard:"Tauler de control",animals:"Animals",listings:"Llistats",exploitations:"Explotacions",users:"Usuaris",imports:"Importació",backup:"Còpies de seguretat",management_system:"Sistema de Gestió",administrador:"Administrador",gerente:"Ramon",editor:"Editor",usuario:"Usuari"}};function s(n,o){return e[o]?.[n]||n}function t(){const n=localStorage.getItem("userLanguage")||"es",o=document.getElementById("nav-title");o&&(o.textContent="NAVEGACIÓN"),document.querySelectorAll('h3[data-section-key="navigation"]').forEach(c=>{c.textContent="NAVEGACIÓN"}),document.querySelectorAll('h3[data-section-key="admin"]').forEach(c=>{c.textContent="ADMINISTRACIÓN"}),document.querySelectorAll("nav a").forEach(c=>{const u=c.textContent.trim(),m=u.match(/^([\u{1F300}-\u{1F5FF}\u{1F900}-\u{1F9FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F1E6}-\u{1F1FF}\u{1F191}-\u{1F251}\u{1F004}\u{1F0CF}\u{1F170}-\u{1F171}\u{1F17E}-\u{1F17F}\u{1F18E}\u{3030}\u{2B50}\u{2B55}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2B1B}-\u{2B1C}\u{3297}\u{3299}\u{303D}\u{00A9}\u{00AE}\u{2122}\u{23F3}\u{24C2}\u{23E9}-\u{23EF}\u{25B6}\u{23F8}-\u{23FA}]+)/u),p=m?m[0]+" ":"";let f="";u.includes("Dashboard")?f="dashboard":u.includes("Animales")?f="animals":u.includes("Explotaciones")?f="exploitations":u.includes("Usuarios")?f="users":u.includes("Importación")?f="imports":(u.includes("Backup")||u.includes("Copias"))&&(f="backup"),f&&(c.innerHTML=`${p} ${s(f,n)}`)});const r=document.querySelector("p.text-sm.text-gray-500.dark\\:text-gray-300.text-center");r&&(r.textContent=s("management_system",n))}t(),setInterval(()=>{document.querySelectorAll('h3[data-section-key="navigation"]').forEach(n=>{n.textContent!=="NAVEGACIÓN"&&(console.log("Corrigiendo título de navegación"),n.textContent="NAVEGACIÓN")})},1e3),window.addEventListener("storage",function(n){n.key==="userLanguage"&&t()});const l=document.getElementById("close-sidebar");l&&l.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("close-sidebar"))})});function w(){try{P(async()=>{const{getCurrentLanguage:e,t:s}=await import("./config.DUTcyYPh.js");return{getCurrentLanguage:e,t:s}},[]).then(({getCurrentLanguage:e,t:s})=>{const t=e();console.log("Sidebar: Actualizando traducciones al idioma:",t),document.querySelectorAll("[data-i18n-key]").forEach(l=>{const n=l.getAttribute("data-i18n-key");if(n&&n.startsWith("menu.")){const o=s(n,t);o!==n&&(l.textContent=o)}})})}catch(e){console.error("Error al actualizar traducciones del menú:",e)}}document.addEventListener("DOMContentLoaded",w);window.addEventListener("storage",function(e){e.key==="userLanguage"&&w()});window.addEventListener("popstate",w);const G={es:{rights_reserved:"Todos los derechos reservados",version:"Versión",about:"Acerca de",help:"Ayuda",privacy:"Privacidad",terms:"Términos"},ca:{rights_reserved:"Tots els drets reservats",version:"Versió",about:"Sobre nosaltres",help:"Ajuda",privacy:"Privacitat",terms:"Termes"}};function y(e,s){return G[s]?.[e]||e}function R(){const e=localStorage.getItem("userLanguage")||"es",s=document.querySelector(".text-sm.text-gray-600.dark\\:text-gray-300");if(s){const n=s.textContent.split("-")[0].trim();s.textContent=`${n} - ${y("rights_reserved",e)}`}const t=document.querySelector(".text-xs.text-gray-500");if(t){const n=t.textContent.split(" ").pop();t.textContent=`${y("version",e)} ${n}`}document.querySelectorAll(".flex.flex-wrap.justify-center a").forEach(n=>{const o=n.getAttribute("href");o==="/about"?n.textContent=y("about",e):o==="/help"?n.textContent=y("help",e):o==="/privacy"?n.textContent=y("privacy",e):o==="/terms"&&(n.textContent=y("terms",e))})}document.addEventListener("DOMContentLoaded",()=>{R()});window.addEventListener("storage",function(e){e.key==="userLanguage"&&R()});const D=document.getElementById("footer-contrast-toggle");D&&D.addEventListener("click",()=>{document.documentElement.classList.toggle("high-contrast-mode");const e=document.documentElement.classList.contains("high-contrast-mode");localStorage.setItem("highContrast",e?"true":"false")});localStorage.getItem("highContrast")==="true"&&document.documentElement.classList.add("high-contrast-mode");const M=document.getElementById("accessibility-toggle");M&&M.addEventListener("click",()=>{document.documentElement.classList.toggle("accessibility-mode");const e=document.documentElement.classList.contains("accessibility-mode");localStorage.setItem("accessibilityMode",e?"true":"false")});localStorage.getItem("accessibilityMode")==="true"&&document.documentElement.classList.add("accessibility-mode");function S(e,s=!1,t=null){if(s&&document.readyState==="loading")return document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector(e);return n&&t&&t(n),n}),null;const l=document.querySelector(e);return l&&t&&t(l),l}function U(e){typeof document>"u"||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e())}function O(e,s){const t=document.querySelector(e);t&&s(t)}function V(e,s){const t=document.querySelectorAll(e);t&&t.length>0&&t.forEach(s)}function $(e){return document.querySelector(e)!==null}function j(e,s=10,t=300){return new Promise((l,n)=>{let o=0;const r=()=>{o++;const c=document.querySelector(e);if(c){l(c);return}if(o>=s){n(new Error(`Elemento ${e} no encontrado después de ${s} intentos`));return}setTimeout(r,t)};r()})}typeof window<"u"&&(window.DOMSafeAccess={safeGetElement:S,onDOMReady:U,withElement:O,withElements:V,elementExists:$,waitForElement:j});U(()=>{const e=S("#language-selector"),s=S("#current-lang-indicator");if(e){const t=localStorage.getItem("userLanguage")||"es";e.value=t,console.log("[LanguageSwitcher] Idioma detectado:",t),s&&(s.textContent=`Idioma actual: ${t}`),new URL(window.location.href).searchParams.set("lang",t),e.addEventListener("change",()=>{const r=e.value;console.log("[LanguageSwitcher] Cambiando idioma a:",r),localStorage.setItem("userLanguage",r),localStorage.setItem("languageChanging","true");const c=new URL(window.location.href);c.searchParams.set("lang",r),c.searchParams.set("t",Date.now()),console.log("[LanguageSwitcher] Forzando recarga completa con idioma:",r),window.location.href=c.toString()});const o=new URLSearchParams(window.location.search).get("lang");if(o&&o!==t&&(o==="es"||o==="ca")){console.log("[LanguageSwitcher] Detectado idioma en URL:",o),localStorage.setItem("userLanguage",o);const r=new URL(window.location.href);r.searchParams.delete("lang"),window.location.href=r.toString()}}else console.info("[LanguageSwitcher] Selector de idioma no disponible en esta página")});
