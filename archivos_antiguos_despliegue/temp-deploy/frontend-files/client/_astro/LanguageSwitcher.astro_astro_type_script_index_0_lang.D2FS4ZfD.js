import{b3 as U}from"./vendor.CIJYp_OF.js";document.addEventListener("DOMContentLoaded",()=>{const e={es:{dashboard:"Dashboard",animals:"Animales",exploitations:"Explotaciones",users:"Usuarios",imports:"Importación",backup:"Copias de seguridad",navigation:"NAVEGACIÓN",admin:"ADMINISTRACIÓN",management_system:"Sistema de Gestión Ganadera",profile:"Perfil",logout:"Cerrar sesión",animal_file:"Ficha de Animal"},ca:{dashboard:"Tauler de control",animals:"Animals",exploitations:"Explotacions",users:"Usuaris",imports:"Importació",backup:"Còpies de seguretat",navigation:"NAVEGACIÓ",admin:"ADMINISTRACIÓ",management_system:"Sistema de Gestió Ramadera",profile:"Perfil",logout:"Tancar sessió",animal_file:"Fitxa d'Animal"}};function i(o,s){return e[s]?.[o]||o}function t(){const o=localStorage.getItem("userLanguage")||"es",s=document.getElementById("page-title");s&&(window.location.pathname.includes("/animals/")?s.textContent=i("animal_file",o):window.location.pathname==="/"||window.location.pathname==="/dashboard"?s.textContent=o==="ca"?"Tauler de control Masclet Imperi":"Dashboard Masclet Imperi":window.location.pathname.includes("/explotaciones")?s.textContent=o==="ca"?"Explotacions":"Explotaciones":window.location.pathname.includes("/imports")?s.textContent=o==="ca"?"Importació de Dades":"Importación de Datos":window.location.pathname.includes("/backup")&&(s.textContent=o==="ca"?"Còpies de seguretat del Sistema":"Backup del Sistema")),document.querySelectorAll("nav a").forEach(l=>{l.style.display==="none"&&(l.style.display=""),l.hasAttribute("data-roles")&&l.removeAttribute("data-roles");const h=l.textContent.trim(),S=h.match(/^([\u{1F300}-\u{1F5FF}\u{1F900}-\u{1F9FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F1E6}-\u{1F1FF}\u{1F191}-\u{1F251}\u{1F004}\u{1F0CF}\u{1F170}-\u{1F171}\u{1F17E}-\u{1F17F}\u{1F18E}\u{3030}\u{2B50}\u{2B55}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2B1B}-\u{2B1C}\u{3297}\u{3299}\u{303D}\u{00A9}\u{00AE}\u{2122}\u{23F3}\u{24C2}\u{23E9}-\u{23EF}\u{25B6}\u{23F8}-\u{23FA}]+)/u),N=S?S[0]+" ":"";let E="";h.includes("Dashboard")?E="dashboard":h.includes("Animales")?E="animals":h.includes("Explotaciones")?E="exploitations":h.includes("Usuarios")?E="users":h.includes("Importación")?E="imports":h.includes("Backup")&&(E="backup"),E&&(l.innerHTML=N+i(E,o))});const m=document.querySelector(".font-bold.text-xl");m&&m.textContent.includes("Gestión de Animales")&&(m.textContent=o==="ca"?"Gestió d'Animals":"Gestión de Animales")}t(),window.addEventListener("storage",function(o){o.key==="userLanguage"&&t()});const g=document.getElementById("mobile-menu-button"),n=document.getElementById("close-mobile-menu"),a=document.getElementById("mobile-menu");document.getElementById("profile-button");const c=document.getElementById("notifications-button"),r=document.getElementById("language-selector"),d=document.getElementById("mobile-language-selector"),u=document.getElementById("notifications-menu"),p=()=>{a&&(a.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},f=()=>{a&&(a.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};g&&g.addEventListener("click",p),n&&n.addEventListener("click",f),a&&a.addEventListener("click",o=>{o.target===a&&f()}),c&&u&&(c.addEventListener("click",o=>{o.stopPropagation(),u.classList.toggle("hidden")}),document.addEventListener("click",o=>{!c.contains(o.target)&&!u.contains(o.target)&&u.classList.add("hidden")}));const L=()=>{const o=document.documentElement.classList.contains("dark"),s=document.getElementById("theme-toggle-light-icon"),m=document.getElementById("theme-toggle-dark-icon"),l=document.getElementById("mobile-theme-toggle-light-icon"),h=document.getElementById("mobile-theme-toggle-dark-icon");o?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"),s&&s.classList.remove("hidden"),m&&m.classList.add("hidden"),l&&l.classList.remove("hidden"),h&&h.classList.add("hidden")):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),s&&s.classList.add("hidden"),m&&m.classList.remove("hidden"),l&&l.classList.add("hidden"),h&&h.classList.remove("hidden"))},b=localStorage.getItem("theme"),x=window.matchMedia("(prefers-color-scheme: dark)").matches;if(b==="dark"||!b&&x){document.documentElement.classList.add("dark");const o=document.getElementById("theme-toggle-light-icon"),s=document.getElementById("theme-toggle-dark-icon"),m=document.getElementById("mobile-theme-toggle-light-icon"),l=document.getElementById("mobile-theme-toggle-dark-icon");o&&o.classList.add("hidden"),s&&s.classList.remove("hidden"),m&&m.classList.add("hidden"),l&&l.classList.remove("hidden")}else{document.documentElement.classList.remove("dark");const o=document.getElementById("theme-toggle-light-icon"),s=document.getElementById("theme-toggle-dark-icon"),m=document.getElementById("mobile-theme-toggle-light-icon"),l=document.getElementById("mobile-theme-toggle-dark-icon");o&&o.classList.remove("hidden"),s&&s.classList.add("hidden"),m&&m.classList.remove("hidden"),l&&l.classList.add("hidden")}const v=document.getElementById("theme-toggle"),F=document.getElementById("mobile-theme-toggle");v&&v.addEventListener("click",L),F&&F.addEventListener("click",L);function M(){const o=localStorage.getItem("userLanguage")||"es";r&&(r.value=o,r.addEventListener("change",()=>{const s=r.value;localStorage.setItem("userLanguage",s),window.location.reload()})),d&&(d.value=o,d.addEventListener("change",()=>{const s=d.value;localStorage.setItem("userLanguage",s),window.location.reload()}))}M()});let k=0,A="";function y(e=!1,i="silent"){const t=document.getElementById("user-role-display");if(!t)return;const g=localStorage.getItem("token");if(e||!g){t.textContent="---";return}if(t.textContent&&t.dataset.processed==="true")return;try{let u=function(b){const w=b.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),v=decodeURIComponent(atob(w).split("").map(F=>"%"+("00"+F.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(v)};var n=u;const p=u(g),f=p.sub||"",L=p.role||"";if((i==="verbose"||A!==L&&Date.now()-k>5e3)&&(k=Date.now(),A=L),L){t.textContent=L,localStorage.setItem("userRole",L),localStorage.setItem("username",f),t.dataset.processed="true";return}}catch{}const a=localStorage.getItem("username"),c=localStorage.getItem("userRole"),r=localStorage.getItem("user");if(a==="Ramon"||c==="Ramon"){t.textContent="Ramon",localStorage.setItem("userRole","Ramon"),t.dataset.processed="true";return}if(c)t.textContent=c,t.dataset.processed="true";else if(r)try{const u=JSON.parse(r);t.textContent=u.role||"usuario",t.dataset.processed="true"}catch{t.textContent="usuario"}else t.textContent="usuario"}document.addEventListener("DOMContentLoaded",()=>{y(!1,"verbose")});window.addEventListener("storage",e=>{(e.key==="token"||e.key==="user"||e.key==="userRole"||e.key==="username")&&y(!1,"verbose")});const _=document.referrer.includes("/login");_&&(y(!1,"verbose"),setTimeout(()=>y(!1,"verbose"),500));let B;document.addEventListener("click",()=>{clearTimeout(B),B=setTimeout(()=>y(),100)});document.addEventListener("DOMContentLoaded",()=>{const e={es:{dashboard:"Dashboard",animals:"Animales",listings:"Listados",exploitations:"Explotaciones",users:"Usuarios",imports:"Importación",backup:"Copias de seguridad",management_system:"Sistema de Gestión",administrador:"Administrador",gerente:"Ramon",editor:"Editor",usuario:"Usuario"},ca:{dashboard:"Tauler de control",animals:"Animals",listings:"Llistats",exploitations:"Explotacions",users:"Usuaris",imports:"Importació",backup:"Còpies de seguretat",management_system:"Sistema de Gestió",administrador:"Administrador",gerente:"Ramon",editor:"Editor",usuario:"Usuari"}};function i(n,a){return e[a]?.[n]||n}function t(){const n=localStorage.getItem("userLanguage")||"es",a=document.getElementById("nav-title");a&&(a.textContent="NAVEGACIÓN"),document.querySelectorAll('h3[data-section-key="navigation"]').forEach(r=>{r.textContent="NAVEGACIÓN"}),document.querySelectorAll('h3[data-section-key="admin"]').forEach(r=>{r.textContent="ADMINISTRACIÓN"}),document.querySelectorAll("nav a").forEach(r=>{const d=r.textContent.trim(),u=d.match(/^([\u{1F300}-\u{1F5FF}\u{1F900}-\u{1F9FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F1E6}-\u{1F1FF}\u{1F191}-\u{1F251}\u{1F004}\u{1F0CF}\u{1F170}-\u{1F171}\u{1F17E}-\u{1F17F}\u{1F18E}\u{3030}\u{2B50}\u{2B55}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2B1B}-\u{2B1C}\u{3297}\u{3299}\u{303D}\u{00A9}\u{00AE}\u{2122}\u{23F3}\u{24C2}\u{23E9}-\u{23EF}\u{25B6}\u{23F8}-\u{23FA}]+)/u),p=u?u[0]+" ":"";let f="";d.includes("Dashboard")?f="dashboard":d.includes("Animales")?f="animals":d.includes("Explotaciones")?f="exploitations":d.includes("Usuarios")?f="users":d.includes("Importación")?f="imports":(d.includes("Backup")||d.includes("Copias"))&&(f="backup"),f&&(r.innerHTML=`${p} ${i(f,n)}`)});const c=document.querySelector("p.text-sm.text-gray-500.dark\\:text-gray-300.text-center");c&&(c.textContent=i("management_system",n))}t(),setInterval(()=>{document.querySelectorAll('h3[data-section-key="navigation"]').forEach(n=>{n.textContent!=="NAVEGACIÓN"&&(console.log("Corrigiendo título de navegación"),n.textContent="NAVEGACIÓN")})},1e3),window.addEventListener("storage",function(n){n.key==="userLanguage"&&t()});const g=document.getElementById("close-sidebar");g&&g.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("close-sidebar"))})});function C(){try{U(async()=>{const{getCurrentLanguage:e,t:i}=await import("./config.DUTcyYPh.js");return{getCurrentLanguage:e,t:i}},[]).then(({getCurrentLanguage:e,t:i})=>{const t=e();console.log("Sidebar: Actualizando traducciones al idioma:",t),document.querySelectorAll("[data-i18n-key]").forEach(g=>{const n=g.getAttribute("data-i18n-key");if(n&&n.startsWith("menu.")){const a=i(n,t);a!==n&&(g.textContent=a)}})})}catch(e){console.error("Error al actualizar traducciones del menú:",e)}}document.addEventListener("DOMContentLoaded",C);window.addEventListener("storage",function(e){e.key==="userLanguage"&&C()});window.addEventListener("popstate",C);const P={es:{rights_reserved:"Todos los derechos reservados",version:"Versión",about:"Acerca de",help:"Ayuda",privacy:"Privacidad",terms:"Términos"},ca:{rights_reserved:"Tots els drets reservats",version:"Versió",about:"Sobre nosaltres",help:"Ajuda",privacy:"Privacitat",terms:"Termes"}};function I(e,i){return P[i]?.[e]||e}function R(){const e=localStorage.getItem("userLanguage")||"es",i=document.querySelector(".text-sm.text-gray-600.dark\\:text-gray-300");if(i){const n=i.textContent.split("-")[0].trim();i.textContent=`${n} - ${I("rights_reserved",e)}`}const t=document.querySelector(".text-xs.text-gray-500");if(t){const n=t.textContent.split(" ").pop();t.textContent=`${I("version",e)} ${n}`}document.querySelectorAll(".flex.flex-wrap.justify-center a").forEach(n=>{const a=n.getAttribute("href");a==="/about"?n.textContent=I("about",e):a==="/help"?n.textContent=I("help",e):a==="/privacy"?n.textContent=I("privacy",e):a==="/terms"&&(n.textContent=I("terms",e))})}document.addEventListener("DOMContentLoaded",()=>{R()});window.addEventListener("storage",function(e){e.key==="userLanguage"&&R()});const T=document.getElementById("footer-contrast-toggle");T&&T.addEventListener("click",()=>{document.documentElement.classList.toggle("high-contrast-mode");const e=document.documentElement.classList.contains("high-contrast-mode");localStorage.setItem("highContrast",e?"true":"false")});localStorage.getItem("highContrast")==="true"&&document.documentElement.classList.add("high-contrast-mode");const D=document.getElementById("accessibility-toggle");D&&D.addEventListener("click",()=>{document.documentElement.classList.toggle("accessibility-mode");const e=document.documentElement.classList.contains("accessibility-mode");localStorage.setItem("accessibilityMode",e?"true":"false")});localStorage.getItem("accessibilityMode")==="true"&&document.documentElement.classList.add("accessibility-mode");document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("language-selector"),i=document.getElementById("current-lang-indicator");if(e){const t=localStorage.getItem("userLanguage")||"es";e.value=t,console.log("[LanguageSwitcher] Idioma detectado:",t),i&&(i.textContent=`Idioma actual: ${t}`),new URL(window.location.href).searchParams.set("lang",t),e.addEventListener("change",()=>{const c=e.value;console.log("[LanguageSwitcher] Cambiando idioma a:",c),localStorage.setItem("userLanguage",c),localStorage.setItem("languageChanging","true");const r=new URL(window.location.href);r.searchParams.set("lang",c),r.searchParams.set("t",Date.now()),console.log("[LanguageSwitcher] Forzando recarga completa con idioma:",c),window.location.href=r.toString()});const a=new URLSearchParams(window.location.search).get("lang");if(a&&a!==t&&(a==="es"||a==="ca")){console.log("[LanguageSwitcher] Detectado idioma en URL:",a),localStorage.setItem("userLanguage",a);const c=new URL(window.location.href);c.searchParams.delete("lang"),window.location.href=c.toString()}}else console.error("[LanguageSwitcher] No se encontró el selector de idioma")});
