import { showSuccess, showError } from "/src/stores/messageStore.ts";
import { cachedFetch } from "/src/stores/cacheStore.ts";
import animalService from "/src/services/animalService.ts";
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("new-animal-form");
  const genereSelect = document.getElementById("genere");
  const alletarContainer = document.getElementById("alletar-container");
  if (genereSelect && alletarContainer) {
    genereSelect.addEventListener("change", () => {
      if (genereSelect.value === "F") {
        alletarContainer.classList.remove("hidden");
      } else {
        alletarContainer.classList.add("hidden");
      }
    });
  }
  if (form) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const submitBtn = form.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = "Creando...";
      }
      try {
        const formData = new FormData(form);
        const animalData = {};
        for (const [key, value] of formData.entries()) {
          if (value !== "") {
            if (key === "dob" && value) {
              const dateParts = value.split("-");
              if (dateParts.length === 3) {
                animalData[key] = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
              } else {
                animalData[key] = value;
              }
            } else {
              animalData[key] = value;
            }
          }
        }
        const requiredFields = ["nom", "genere", "explotacio", "estado"];
        for (const field of requiredFields) {
          if (!animalData[field]) {
            throw new Error(`El campo ${field} es obligatorio`);
          }
        }
        if (animalData.genere === "F" && !animalData.alletar) {
          animalData.alletar = "0";
        }
        if (animalData.genere === "M" && animalData.alletar) {
          delete animalData.alletar;
        }
        console.log("Datos a enviar:", animalData);
        const token = localStorage.getItem("token");
        if (!token) {
          throw new Error("No hay token de autenticación. Por favor, inicie sesión nuevamente.");
        }
        const result = await animalService.createAnimal(animalData);
        console.log("Animal creado:", result);
        showSuccess("Animal creado", `El animal ${animalData.nom} ha sido creado correctamente`);
        setTimeout(() => {
          let animalId;
          if (result && result.data && result.data.id) {
            animalId = result.data.id;
          } else if (result && result.id) {
            animalId = result.id;
          } else {
            console.error("No se pudo obtener el ID del animal creado:", result);
            window.location.href = "/animals";
            return;
          }
          console.log("Redirigiendo a la ficha del animal con ID:", animalId);
          window.location.href = `/animals/${animalId}`;
        }, 1e3);
      } catch (error) {
        console.error("Error al crear animal:", error);
        showError("Error", error.message || "Ha ocurrido un error al crear el animal");
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = "Crear Animal";
        }
      }
    });
  }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNyZWF0ZUFuaW1hbEZvcm0uYXN0cm8iXSwic291cmNlc0NvbnRlbnQiOlsiLS0tXG4vKipcbiAqIEZvcm11bGFyaW8gcGFyYSBjcmVhciB1biBudWV2byBhbmltYWxcbiAqL1xuaW1wb3J0IHR5cGUgeyBBbmltYWwgfSBmcm9tICcuLi8uLi90eXBlcy90eXBlcyc7XG5pbXBvcnQgQWxlcnQgZnJvbSAnLi4vdWkvQWxlcnQuYXN0cm8nO1xuXG5pbnRlcmZhY2UgUHJvcHMge1xuICBleHBsb3RhY2lvbmVzOiBBcnJheTx7IGlkOiBudW1iZXI7IGV4cGxvdGFjaW86IHN0cmluZyB9PjtcbiAgZXJyb3I/OiBzdHJpbmcgfCBudWxsO1xufVxuXG5jb25zdCB7IGV4cGxvdGFjaW9uZXMsIGVycm9yID0gbnVsbCB9ID0gQXN0cm8ucHJvcHM7XG4tLS1cblxuPGRpdiBjbGFzcz1cImJnLXdoaXRlIGRhcms6YmctZ3JheS04MDAgcm91bmRlZC1sZyBzaGFkb3cgcC02IGJvcmRlciBib3JkZXItZ3JheS0xMDAgZGFyazpib3JkZXItZ3JheS03MDBcIj5cbiAge2Vycm9yICYmIChcbiAgICA8QWxlcnQgXG4gICAgICB0eXBlPVwiZXJyb3JcIiBcbiAgICAgIHRpdGxlPVwiRXJyb3JcIiBcbiAgICAgIG1lc3NhZ2U9e2Vycm9yfSBcbiAgICAgIGNsYXNzPVwibWItNFwiXG4gICAgLz5cbiAgKX1cblxuICA8Zm9ybSBpZD1cIm5ldy1hbmltYWwtZm9ybVwiIGNsYXNzPVwic3BhY2UteS02XCI+XG4gICAgPCEtLSBEYXRvcyBiw6FzaWNvcyAtLT5cbiAgICA8ZGl2IGNsYXNzPVwiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNlwiPlxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsIGNsYXNzPVwiYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktNzAwIGRhcms6dGV4dC1ncmF5LTMwMCBtYi0xXCI+XG4gICAgICAgICAgTm9tYnJlICpcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgbmFtZT1cIm5vbVwiIFxuICAgICAgICAgIGlkPVwibm9tXCJcbiAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgIGNsYXNzPVwidy1mdWxsIHB4LTQgcHktMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbWQgYmctd2hpdGUgZGFyazpiZy1ncmF5LTcwMCB0ZXh0LWdyYXktODAwIGRhcms6dGV4dC13aGl0ZVwiXG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJOb21icmUgZGVsIGFuaW1hbFwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItMVwiPlxuICAgICAgICAgIEPDs2RpZ29cbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgbmFtZT1cImNvZFwiIFxuICAgICAgICAgIGlkPVwiY29kXCJcbiAgICAgICAgICBjbGFzcz1cInctZnVsbCBweC00IHB5LTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCByb3VuZGVkLW1kIGJnLXdoaXRlIGRhcms6YmctZ3JheS03MDAgdGV4dC1ncmF5LTgwMCBkYXJrOnRleHQtd2hpdGVcIlxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiQ8OzZGlnbyBkZWwgYW5pbWFsXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPCEtLSBEYXRvcyBkZSBpZGVudGlmaWNhY2nDs24gLS0+XG4gICAgPGRpdiBjbGFzcz1cImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTMgZ2FwLTZcIj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItMVwiPlxuICAgICAgICAgIEfDqW5lcm8gKlxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IFxuICAgICAgICAgIG5hbWU9XCJnZW5lcmVcIiBcbiAgICAgICAgICBpZD1cImdlbmVyZVwiXG4gICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICBjbGFzcz1cInctZnVsbCBweC00IHB5LTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCByb3VuZGVkLW1kIGJnLXdoaXRlIGRhcms6YmctZ3JheS03MDAgdGV4dC1ncmF5LTgwMCBkYXJrOnRleHQtd2hpdGVcIlxuICAgICAgICA+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPlNlbGVjY2lvbmFyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIk1cIj5NYWNobzwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJGXCI+SGVtYnJhPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3M9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTFcIj5cbiAgICAgICAgICBGZWNoYSBkZSBOYWNpbWllbnRvXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dCBcbiAgICAgICAgICB0eXBlPVwiZGF0ZVwiIFxuICAgICAgICAgIG5hbWU9XCJkb2JcIiBcbiAgICAgICAgICBpZD1cImRvYlwiXG4gICAgICAgICAgY2xhc3M9XCJ3LWZ1bGwgcHgtNCBweS0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgcm91bmRlZC1tZCBiZy13aGl0ZSBkYXJrOmJnLWdyYXktNzAwIHRleHQtZ3JheS04MDAgZGFyazp0ZXh0LXdoaXRlXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsIGNsYXNzPVwiYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktNzAwIGRhcms6dGV4dC1ncmF5LTMwMCBtYi0xXCI+XG4gICAgICAgICAgTsO6bWVybyBkZSBTZXJpZVxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgdHlwZT1cInRleHRcIiBcbiAgICAgICAgICBuYW1lPVwibnVtX3NlcmllXCIgXG4gICAgICAgICAgaWQ9XCJudW1fc2VyaWVcIlxuICAgICAgICAgIGNsYXNzPVwidy1mdWxsIHB4LTQgcHktMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbWQgYmctd2hpdGUgZGFyazpiZy1ncmF5LTcwMCB0ZXh0LWdyYXktODAwIGRhcms6dGV4dC13aGl0ZVwiXG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJOw7ptZXJvIGRlIHNlcmllIG9maWNpYWxcIlxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8IS0tIERhdG9zIGRlIGV4cGxvdGFjacOzbiAtLT5cbiAgICA8ZGl2IGNsYXNzPVwiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNlwiPlxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsIGNsYXNzPVwiYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktNzAwIGRhcms6dGV4dC1ncmF5LTMwMCBtYi0xXCI+XG4gICAgICAgICAgRXhwbG90YWNpw7NuICpcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgbmFtZT1cImV4cGxvdGFjaW9cIiBcbiAgICAgICAgICBpZD1cImV4cGxvdGFjaW9cIlxuICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgY2xhc3M9XCJ3LWZ1bGwgcHgtNCBweS0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgcm91bmRlZC1tZCBiZy13aGl0ZSBkYXJrOmJnLWdyYXktNzAwIHRleHQtZ3JheS04MDAgZGFyazp0ZXh0LXdoaXRlXCJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIk5vbWJyZSBkZSBsYSBleHBsb3RhY2nDs25cIlxuICAgICAgICAgIGxpc3Q9XCJleHBsb3RhY2lvbmVzLWxpc3RcIlxuICAgICAgICAvPlxuICAgICAgICA8IS0tIExpc3RhIGRlc3BsZWdhYmxlIHBhcmEgc3VnZXJlbmNpYXMgKGRhdGFsaXN0KSAtLT5cbiAgICAgICAgPGRhdGFsaXN0IGlkPVwiZXhwbG90YWNpb25lcy1saXN0XCI+XG4gICAgICAgICAge2V4cGxvdGFjaW9uZXMubWFwKGV4cCA9PiAoXG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPXtleHAuZXhwbG90YWNpb30+e2V4cC5leHBsb3RhY2lvfTwvb3B0aW9uPlxuICAgICAgICAgICkpfVxuICAgICAgICA8L2RhdGFsaXN0PlxuICAgICAgICA8cCBjbGFzcz1cInRleHQteHMgdGV4dC1ncmF5LTUwMCBkYXJrOnRleHQtZ3JheS00MDAgbXQtMVwiPlB1ZWRlcyBzZWxlY2Npb25hciB1bmEgZXhpc3RlbnRlIG8gY3JlYXIgdW5hIG51ZXZhPC9wPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3M9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTFcIj5cbiAgICAgICAgICBPcmlnZW5cbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgXG4gICAgICAgICAgbmFtZT1cIm9yaWdlblwiXG4gICAgICAgICAgaWQ9XCJvcmlnZW5cIlxuICAgICAgICAgIGNsYXNzPVwidy1mdWxsIHB4LTQgcHktMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbWQgYmctd2hpdGUgZGFyazpiZy1ncmF5LTcwMCB0ZXh0LWdyYXktODAwIGRhcms6dGV4dC13aGl0ZVwiXG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJPcmlnZW4gbyB1YmljYWNpw7NuXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPCEtLSBEYXRvcyBkZSBwYXJlbnRlc2NvIC0tPlxuICAgIDxkaXYgY2xhc3M9XCJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC02XCI+XG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3M9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTFcIj5cbiAgICAgICAgICBQYWRyZVxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgdHlwZT1cInRleHRcIiBcbiAgICAgICAgICBuYW1lPVwicGFyZVwiIFxuICAgICAgICAgIGlkPVwicGFyZVwiXG4gICAgICAgICAgY2xhc3M9XCJ3LWZ1bGwgcHgtNCBweS0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgcm91bmRlZC1tZCBiZy13aGl0ZSBkYXJrOmJnLWdyYXktNzAwIHRleHQtZ3JheS04MDAgZGFyazp0ZXh0LXdoaXRlXCJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIk5vbWJyZSBkZWwgcGFkcmVcIlxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWwgY2xhc3M9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTFcIj5cbiAgICAgICAgICBNYWRyZVxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgXG4gICAgICAgICAgdHlwZT1cInRleHRcIiBcbiAgICAgICAgICBuYW1lPVwibWFyZVwiIFxuICAgICAgICAgIGlkPVwibWFyZVwiXG4gICAgICAgICAgY2xhc3M9XCJ3LWZ1bGwgcHgtNCBweS0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgZGFyazpib3JkZXItZ3JheS02MDAgcm91bmRlZC1tZCBiZy13aGl0ZSBkYXJrOmJnLWdyYXktNzAwIHRleHQtZ3JheS04MDAgZGFyazp0ZXh0LXdoaXRlXCJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIk5vbWJyZSBkZSBsYSBtYWRyZVwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDwhLS0gRXN0YWRvIHkgYW1hbWFudGFtaWVudG8gLS0+XG4gICAgPGRpdiBjbGFzcz1cImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTZcIj5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbCBjbGFzcz1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItMVwiPlxuICAgICAgICAgIEVzdGFkbyAqXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3QgXG4gICAgICAgICAgbmFtZT1cImVzdGFkb1wiIFxuICAgICAgICAgIGlkPVwiZXN0YWRvXCJcbiAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgIGNsYXNzPVwidy1mdWxsIHB4LTQgcHktMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIGRhcms6Ym9yZGVyLWdyYXktNjAwIHJvdW5kZWQtbWQgYmctd2hpdGUgZGFyazpiZy1ncmF5LTcwMCB0ZXh0LWdyYXktODAwIGRhcms6dGV4dC13aGl0ZVwiXG4gICAgICAgID5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiT0tcIiBzZWxlY3RlZD5BY3Rpdm88L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiREVGXCI+RmFsbGVjaWRvPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGlkPVwiYWxsZXRhci1jb250YWluZXJcIiBjbGFzcz1cImhpZGRlblwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9XCJibG9jayB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgZGFyazp0ZXh0LWdyYXktMzAwIG1iLTFcIj5cbiAgICAgICAgICBBbWFtYW50YW1pZW50b1xuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IFxuICAgICAgICAgIG5hbWU9XCJhbGxldGFyXCIgXG4gICAgICAgICAgaWQ9XCJhbGxldGFyXCJcbiAgICAgICAgICBjbGFzcz1cInctZnVsbCBweC00IHB5LTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCByb3VuZGVkLW1kIGJnLXdoaXRlIGRhcms6YmctZ3JheS03MDAgdGV4dC1ncmF5LTgwMCBkYXJrOnRleHQtd2hpdGVcIlxuICAgICAgICA+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIjBcIiBzZWxlY3RlZD5ObyBhbWFtYW50YTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCIxXCI+VW4gdGVybmVybzwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCIyXCI+RG9zIHRlcm5lcm9zPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG5cbiAgICA8IS0tIE9ic2VydmFjaW9uZXMgLS0+XG4gICAgPGRpdj5cbiAgICAgIDxsYWJlbCBjbGFzcz1cImJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMCBkYXJrOnRleHQtZ3JheS0zMDAgbWItMVwiPlxuICAgICAgICBPYnNlcnZhY2lvbmVzIChtw6F4LiAyMDAwIGNhcmFjdGVyZXMpXG4gICAgICA8L2xhYmVsPlxuICAgICAgPHRleHRhcmVhIFxuICAgICAgICBuYW1lPVwib2JzZXJ2YWNpb25lc1wiIFxuICAgICAgICBpZD1cIm9ic2VydmFjaW9uZXNcIlxuICAgICAgICByb3dzPVwiNFwiXG4gICAgICAgIG1heGxlbmd0aD1cIjIwMDBcIlxuICAgICAgICBjbGFzcz1cInctZnVsbCBweC00IHB5LTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCBkYXJrOmJvcmRlci1ncmF5LTYwMCByb3VuZGVkLW1kIGJnLXdoaXRlIGRhcms6YmctZ3JheS03MDAgdGV4dC1ncmF5LTgwMCBkYXJrOnRleHQtd2hpdGVcIlxuICAgICAgICBwbGFjZWhvbGRlcj1cIkHDsWFkZSBub3RhcyBvIGluZm9ybWFjacOzbiBhZGljaW9uYWwgc29icmUgZWwgYW5pbWFsXCJcbiAgICAgID48L3RleHRhcmVhPlxuICAgIDwvZGl2PlxuICAgIFxuICAgIDwhLS0gTGV5ZW5kYSBwYXJhIGNhbXBvcyBvYmxpZ2F0b3Jpb3MgLS0+XG4gICAgPGRpdiBjbGFzcz1cInRleHQtc20gdGV4dC1ncmF5LTUwMCBkYXJrOnRleHQtZ3JheS00MDAgbXQtMlwiPlxuICAgICAgPHNwYW4gY2xhc3M9XCJ0ZXh0LWJsYWNrIGRhcms6dGV4dC13aGl0ZSBmb250LWJvbGRcIj4qPC9zcGFuPiA8c3BhbiBjbGFzcz1cImZvbnQtYm9sZFwiPkNhbXBvcyBvYmxpZ2F0b3Jpb3M8L3NwYW4+XG4gICAgPC9kaXY+XG5cbiAgICA8IS0tIEJvdG9uZXMgZGUgYWNjacOzbiAtLT5cbiAgICA8ZGl2IGNsYXNzPVwiZmxleCBqdXN0aWZ5LWVuZCBnYXAtM1wiPlxuICAgICAgPGEgXG4gICAgICAgIGhyZWY9XCIvYW5pbWFsc1wiXG4gICAgICAgIGNsYXNzPVwicHgtNiBweS0zIGJnLWdyYXktMjAwIHRleHQtZ3JheS04MDAgaG92ZXI6YmctZ3JheS0zMDAgZGFyazpiZy1ncmF5LTcwMCBkYXJrOnRleHQtd2hpdGUgZGFyazpob3ZlcjpiZy1ncmF5LTYwMCByb3VuZGVkLW1kIHRyYW5zaXRpb24tY29sb3JzXCJcbiAgICAgID5cbiAgICAgICAgQ2FuY2VsYXJcbiAgICAgIDwvYT5cbiAgICAgIDxidXR0b24gXG4gICAgICAgIHR5cGU9XCJzdWJtaXRcIlxuICAgICAgICBjbGFzcz1cInB4LTYgcHktMyBiZy1wcmltYXJ5IHRleHQtd2hpdGUgaG92ZXI6YmctcHJpbWFyeS84MCByb3VuZGVkLW1kIHRyYW5zaXRpb24tY29sb3JzXCJcbiAgICAgID5cbiAgICAgICAgQ3JlYXIgQW5pbWFsXG4gICAgICA8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgPC9mb3JtPlxuPC9kaXY+XG5cbjxzY3JpcHQ+XG4gIGltcG9ydCB7IHNob3dTdWNjZXNzLCBzaG93RXJyb3IgfSBmcm9tICcuLi8uLi9zdG9yZXMvbWVzc2FnZVN0b3JlJztcbiAgaW1wb3J0IHsgY2FjaGVkRmV0Y2ggfSBmcm9tICcuLi8uLi9zdG9yZXMvY2FjaGVTdG9yZSc7XG4gIGltcG9ydCBhbmltYWxTZXJ2aWNlIGZyb20gJy4uLy4uL3NlcnZpY2VzL2FuaW1hbFNlcnZpY2UnO1xuICBcbiAgLy8gU2NyaXB0IHBhcmEgbWFuZWphciBlbCBlbnbDrW8gZGVsIGZvcm11bGFyaW9cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy1hbmltYWwtZm9ybScpO1xuICAgIGNvbnN0IGdlbmVyZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmUnKTtcbiAgICBjb25zdCBhbGxldGFyQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FsbGV0YXItY29udGFpbmVyJyk7XG4gICAgXG4gICAgLy8gTW9zdHJhci9vY3VsdGFyIGNhbXBvIGRlIGFtYW1hbnRhbWllbnRvIHNlZ8O6biBlbCBnw6luZXJvXG4gICAgaWYgKGdlbmVyZVNlbGVjdCAmJiBhbGxldGFyQ29udGFpbmVyKSB7XG4gICAgICBnZW5lcmVTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICBpZiAoZ2VuZXJlU2VsZWN0LnZhbHVlID09PSAnRicpIHtcbiAgICAgICAgICBhbGxldGFyQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsbGV0YXJDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZiAoZm9ybSkge1xuICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIFxuICAgICAgICAvLyBPYnRlbmVyIGVsIGJvdMOzbiBkZSBzdWJtaXQgcGFyYSBkZXNoYWJpbGl0YXJsb1xuICAgICAgICBjb25zdCBzdWJtaXRCdG4gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gICAgICAgIGlmIChzdWJtaXRCdG4pIHtcbiAgICAgICAgICBzdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIHN1Ym1pdEJ0bi5pbm5lckhUTUwgPSAnQ3JlYW5kby4uLic7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gT2J0ZW5lciB0b2RvcyBsb3MgY2FtcG9zIGRlbCBmb3JtdWxhcmlvXG4gICAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG4gICAgICAgICAgY29uc3QgYW5pbWFsRGF0YSA9IHt9O1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFByb2Nlc2FyIHRvZG9zIGxvcyBjYW1wb3NcbiAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBmb3JtRGF0YS5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgLy8gQ29udmVydGlyIGxhIGZlY2hhIGFsIGZvcm1hdG8gZXNwZXJhZG8gcG9yIGVsIGJhY2tlbmQgKEREL01NL1lZWVkpXG4gICAgICAgICAgICAgIGlmIChrZXkgPT09ICdkb2InICYmIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgLy8gQ29udmVydGlyIGRlIFlZWVktTU0tREQgYSBERC9NTS9ZWVlZXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZVBhcnRzID0gdmFsdWUuc3BsaXQoJy0nKTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0ZVBhcnRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICAgICAgICAgICAgYW5pbWFsRGF0YVtrZXldID0gYCR7ZGF0ZVBhcnRzWzJdfS8ke2RhdGVQYXJ0c1sxXX0vJHtkYXRlUGFydHNbMF19YDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgYW5pbWFsRGF0YVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFuaW1hbERhdGFba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFZhbGlkYXIgY2FtcG9zIHJlcXVlcmlkb3NcbiAgICAgICAgICBjb25zdCByZXF1aXJlZEZpZWxkcyA9IFsnbm9tJywgJ2dlbmVyZScsICdleHBsb3RhY2lvJywgJ2VzdGFkbyddO1xuICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgcmVxdWlyZWRGaWVsZHMpIHtcbiAgICAgICAgICAgIGlmICghYW5pbWFsRGF0YVtmaWVsZF0pIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFbCBjYW1wbyAke2ZpZWxkfSBlcyBvYmxpZ2F0b3Jpb2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaSBlcyBoZW1icmEsIGFzZWd1cmFyIHF1ZSBhbGxldGFyIHRlbmdhIHVuIHZhbG9yXG4gICAgICAgICAgaWYgKGFuaW1hbERhdGEuZ2VuZXJlID09PSAnRicgJiYgIWFuaW1hbERhdGEuYWxsZXRhcikge1xuICAgICAgICAgICAgYW5pbWFsRGF0YS5hbGxldGFyID0gJzAnOyAvLyBWYWxvciBwb3IgZGVmZWN0b1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaSBlcyBtYWNobywgZWxpbWluYXIgYWxsZXRhclxuICAgICAgICAgIGlmIChhbmltYWxEYXRhLmdlbmVyZSA9PT0gJ00nICYmIGFuaW1hbERhdGEuYWxsZXRhcikge1xuICAgICAgICAgICAgZGVsZXRlIGFuaW1hbERhdGEuYWxsZXRhcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coJ0RhdG9zIGEgZW52aWFyOicsIGFuaW1hbERhdGEpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEVudmlhciBkYXRvcyBhbCBzZXJ2aWRvclxuICAgICAgICAgIGNvbnN0IHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rva2VuJyk7XG4gICAgICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBoYXkgdG9rZW4gZGUgYXV0ZW50aWNhY2nDs24uIFBvciBmYXZvciwgaW5pY2llIHNlc2nDs24gbnVldmFtZW50ZS4nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVXNhciBhbmltYWxTZXJ2aWNlIHBhcmEgY3JlYXIgZWwgYW5pbWFsXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5pbWFsU2VydmljZS5jcmVhdGVBbmltYWwoYW5pbWFsRGF0YSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0FuaW1hbCBjcmVhZG86JywgcmVzdWx0KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBNb3N0cmFyIG1lbnNhamUgZGUgw6l4aXRvXG4gICAgICAgICAgc2hvd1N1Y2Nlc3MoJ0FuaW1hbCBjcmVhZG8nLCBgRWwgYW5pbWFsICR7YW5pbWFsRGF0YS5ub219IGhhIHNpZG8gY3JlYWRvIGNvcnJlY3RhbWVudGVgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZWRpcmVjY2lvbmFyIGEgbGEgcMOhZ2luYSBkZSBkZXRhbGxlIGRlbCBhbmltYWxcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIC8vIEV4dHJhZXIgZWwgSUQgY29ycmVjdGFtZW50ZSBzZWfDum4gbGEgZXN0cnVjdHVyYSBkZSByZXNwdWVzdGEgZGVsIGJhY2tlbmRcbiAgICAgICAgICAgIGxldCBhbmltYWxJZDtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEuaWQpIHtcbiAgICAgICAgICAgICAgYW5pbWFsSWQgPSByZXN1bHQuZGF0YS5pZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ICYmIHJlc3VsdC5pZCkge1xuICAgICAgICAgICAgICBhbmltYWxJZCA9IHJlc3VsdC5pZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIHNlIHB1ZG8gb2J0ZW5lciBlbCBJRCBkZWwgYW5pbWFsIGNyZWFkbzonLCByZXN1bHQpO1xuICAgICAgICAgICAgICAvLyBSZWRpcmVjY2lvbmFyIGEgbGEgbGlzdGEgZGUgYW5pbWFsZXMgZW4gY2FzbyBkZSBlcnJvclxuICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvYW5pbWFscyc7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlZGlyaWdpZW5kbyBhIGxhIGZpY2hhIGRlbCBhbmltYWwgY29uIElEOicsIGFuaW1hbElkKTtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYC9hbmltYWxzLyR7YW5pbWFsSWR9YDtcbiAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICBcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbCBjcmVhciBhbmltYWw6JywgZXJyb3IpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIE1vc3RyYXIgbWVuc2FqZSBkZSBlcnJvclxuICAgICAgICAgIHNob3dFcnJvcignRXJyb3InLCBlcnJvci5tZXNzYWdlIHx8ICdIYSBvY3VycmlkbyB1biBlcnJvciBhbCBjcmVhciBlbCBhbmltYWwnKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBSZXN0YXVyYXIgYm90w7NuXG4gICAgICAgICAgaWYgKHN1Ym1pdEJ0bikge1xuICAgICAgICAgICAgc3VibWl0QnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICBzdWJtaXRCdG4uaW5uZXJIVE1MID0gJ0NyZWFyIEFuaW1hbCc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuPC9zY3JpcHQ+Il0sIm1hcHBpbmdzIjoiQUF5T0UsU0FBUyxhQUFhLGlCQUFpQjtBQUN2QyxTQUFTLG1CQUFtQjtBQUM1QixPQUFPLG1CQUFtQjtBQUcxQixTQUFTLGlCQUFpQixvQkFBb0IsTUFBTTtBQUNsRCxRQUFNLE9BQU8sU0FBUyxlQUFlLGlCQUFpQjtBQUN0RCxRQUFNLGVBQWUsU0FBUyxlQUFlLFFBQVE7QUFDckQsUUFBTSxtQkFBbUIsU0FBUyxlQUFlLG1CQUFtQjtBQUdwRSxNQUFJLGdCQUFnQixrQkFBa0I7QUFDcEMsaUJBQWEsaUJBQWlCLFVBQVUsTUFBTTtBQUM1QyxVQUFJLGFB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