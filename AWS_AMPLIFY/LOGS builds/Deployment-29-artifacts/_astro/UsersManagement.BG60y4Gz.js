import{r as d,a as e}from"./vendor.BAk4NxX6.js";import{a as B}from"./api.SKp-IjmL.js";import{A as k}from"./apiConfig.BYL0hBvc.js";import{g as X,i as Q}from"./authService.CvC7CJU-.js";import{getCurrentLanguage as O,t as p}from"./config.DUTcyYPh.js";import"./apiConfigAdapter.B0N4Zv2p.js";const P={async getUsers(t=1,o=10,x){try{const u=new URLSearchParams;u.append("page",t.toString()),u.append("limit",o.toString()),x&&u.append("search",x),console.log("Obteniendo usuarios, página:",t,"límite:",o);const s=localStorage.getItem("token");if(!s)return console.error("No hay token de autenticación disponible"),[];const l={headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}};console.log("Enviando solicitud con token:",s.substring(0,15)+"..."),console.log("URL de solicitud:",`/users?${u.toString()}`);try{console.log("Intentando obtener usuarios con fetch...");let a;a=`${`${k.backendURL||""}${k.baseURL}`}/users/?${u.toString()}`,console.log("URL de la API construida desde configuración centralizada:",a),console.log("URL completa:",a);const w=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}});if(w.ok){const j=await w.json();if(console.log("Datos obtenidos con fetch:",j),j&&j.items&&Array.isArray(j.items))return console.log("Devolviendo usuarios desde fetch:",j.items.length),j.items;if(Array.isArray(j))return console.log("Devolviendo array de usuarios desde fetch:",j.length),j}else console.warn("Error en la respuesta fetch:",w.status)}catch(a){console.error("Error al usar fetch:",a)}console.log("Usando axios como método alternativo...");let f,n;window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(f=`http://localhost:8000/api/v1/users?${u.toString()}`,n=await B.get(f,{...l,baseURL:""})):(f=`users?${u.toString()}`,n=await B.get(f,l)),console.log("Respuesta completa de axios:",n);let g;if(n.data)g=n.data,console.log("Datos encontrados en response.data");else if(n.request&&n.request.response)try{g=JSON.parse(n.request.response),console.log("Datos encontrados en response.request.response")}catch{console.warn("Error al parsear response.request.response")}if(!g){console.warn("No se encontraron datos en la respuesta, intentando solicitud alternativa...");const a=await B.get("/users",l);if(a.data)g=a.data,console.log("Datos encontrados en solicitud alternativa");else if(a.request&&a.request.response)try{g=JSON.parse(a.request.response),console.log("Datos encontrados en alternativeResponse.request.response")}catch{console.warn("Error al parsear alternativeResponse.request.response")}}return g?g?(console.log("Datos a procesar:",g),g.items&&Array.isArray(g.items)?(console.log("Estructura detectada: { items: [...usuarios] }"),g.items):Array.isArray(g)?(console.log("La respuesta es un array directo de usuarios con",g.length,"elementos"),{items:g,total:g.length,page:t,limit:o,pages:Math.ceil(g.length/o)}):g):(console.warn("No se pudieron obtener datos de usuarios después de múltiples intentos"),[]):(console.warn("Intentando solicitud XMLHttpRequest como último recurso..."),new Promise(a=>{const i=new XMLHttpRequest;let w;window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?w="http://localhost:8000/api/v1/users":w=`${B.defaults.baseURL}/users`,console.log("URL para XMLHttpRequest:",w),i.open("GET",w),i.setRequestHeader("Authorization",`Bearer ${s}`),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.onload=function(){i.status===200?(console.log("Respuesta XMLHttpRequest:",i.response),i.response&&i.response.items?a(i.response.items):Array.isArray(i.response)?a(i.response):a([])):(console.error("Error en XMLHttpRequest:",i.status),a([]))},i.onerror=function(){console.error("Error de red en XMLHttpRequest"),a([])},i.send()}))}catch(u){return console.error("Error al obtener usuarios:",u),[]}},async getUserById(t){try{return console.log("Obteniendo usuario con ID:",t),(await B.get(`/users/${t}`)).data}catch(o){throw console.error(`Error al obtener usuario con ID ${t}:`,o),o}},async createUser(t){try{console.log("Creando nuevo usuario:",t.username);const o={...t,role:t.role.toLowerCase(),is_active:t.is_active!==void 0?t.is_active:!0};console.log("Datos del usuario a crear:",JSON.stringify(o,null,2));const x=localStorage.getItem("token");if(!x)throw console.error("No hay token de autenticación disponible para crear usuario"),new Error("No hay token de autenticación disponible");const s=`${`${k.backendURL||""}${k.baseURL}`}/users/`;console.log("Usando URL construida desde API_CONFIG para crear usuario:",s);const l=await fetch(s,{method:"POST",headers:{Authorization:x?`Bearer ${x}`:"","Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw{message:"Error al crear usuario",status:l.status,code:"ERROR"};const f=await l.json();return console.log("Respuesta al crear usuario:",f),f}catch(o){throw console.error("Error al crear usuario:",o),o}},async updateUser(t,o){try{console.log("Actualizando usuario con ID:",t);const x=localStorage.getItem("token"),s=`${`${k.backendURL||""}${k.baseURL}`}/users/${t}/`;console.log("Usando URL construida desde API_CONFIG:",s);const l=await fetch(s,{method:"PUT",headers:{Authorization:x?`Bearer ${x}`:"","Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw{message:"Error al actualizar usuario",status:l.status,code:"ERROR"};return await l.json()}catch(x){throw console.error(`Error al actualizar usuario con ID ${t}:`,x),x}},async deleteUser(t){try{console.log("Eliminando usuario con ID:",t);const o=localStorage.getItem("token"),u=`${`${k.backendURL||""}${k.baseURL}`}/users/${t}/`;console.log("Usando URL construida desde API_CONFIG para eliminar:",u);const s=await fetch(u,{method:"DELETE",headers:{Authorization:o?`Bearer ${o}`:"","Content-Type":"application/json"}});if(!s.ok)throw{message:"Error al eliminar usuario",status:s.status,code:"ERROR"}}catch(o){throw console.error(`Error al eliminar usuario con ID ${t}:`,o),o}}},Y=({user:t,onSuccess:o,onCancel:x,availableRoles:u})=>{const[s,l]=d.useState({username:"",email:"",password:"",confirmPassword:"",role:"usuario"}),[f,n]=d.useState(!1),[g,a]=d.useState(null),[i,w]=d.useState(!1),[j,D]=d.useState(!1),[R,$]=d.useState(!1),U=X(),[L,z]=d.useState(U),[N,F]=d.useState(U?.role==="administrador");console.log("UserForm - Estado de usuario actual:",{currentUser:L,isAdmin:N,role:U?.role}),d.useEffect(()=>{t?(w(!0),l({username:t.username,email:t.email,password:"",confirmPassword:"",role:t.role}),console.log("UserForm - Usuario cargado para edición:",t),console.log("UserForm - Datos de formulario inicializados:",{username:t.username,email:t.email,role:t.role})):(w(!1),l({username:"",email:"",password:"",confirmPassword:"",role:"usuario"}))},[t]);const C=m=>{const{name:h,value:E}=m.target;let A=h;h.includes("_")&&(A=h.split("_")[0]);let I=A;A.includes("username")&&(I="username"),A.includes("email")&&(I="email"),A.includes("password")&&!A.includes("confirm")&&(I="password"),A.includes("confirmPassword")&&(I="confirmPassword"),l(q=>({...q,[I]:E}))},S=()=>s.username.trim()?s.email.trim()?!i&&!s.password?(a("La contraseña es obligatoria"),!1):!i&&s.password!==s.confirmPassword?(a("Las contraseñas no coinciden"),!1):!0:(a("El email es obligatorio"),!1):(a("El nombre de usuario es obligatorio"),!1),b=async m=>{if(m.preventDefault(),!!S()){n(!0),a(null);try{if(i&&t){const h={username:s.username,email:s.email,role:s.role};s.password&&N&&Object.assign(h,{password:s.password}),console.log("UserForm - Enviando datos para actualizar usuario:",h);const E=await P.updateUser(t.id,h);console.log("UserForm - Usuario actualizado correctamente:",E)}else{const h={username:s.username,email:s.email,password:s.password,role:s.role};console.log("UserForm - Enviando datos para crear usuario:",h);const E=await P.createUser(h);console.log("UserForm - Usuario creado correctamente:",E)}o()}catch(h){console.error("Error al guardar usuario:",h),h.response?a(h.response.data?.detail||"Error al guardar el usuario"):h.request?a("No se pudo conectar con el servidor"):a("Error al procesar la solicitud")}finally{n(!1)}}},c=Math.random().toString(36).substring(2,10);return e.jsxs("form",{className:"space-y-6",onSubmit:b,autoComplete:"off",spellCheck:"false",children:[e.jsxs("div",{style:{display:"none"},children:[e.jsx("input",{type:"text",name:"username_fake",autoComplete:"username"}),e.jsx("input",{type:"password",name:"password_fake",autoComplete:"current-password"})]}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:i?"Editar Usuario":"Crear Nuevo Usuario"}),g&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:g})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Nombre de usuario"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:`username_${c}`,id:"username",value:s.username,onChange:C,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"email",name:`email_${c}`,id:"email",value:s.email,onChange:C,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})})]}),(!i||N)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Contraseña"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",name:`password_${c}`,id:"password",value:s.password,onChange:C,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!i&&!N,autoComplete:"new-password",autoCorrect:"off",autoCapitalize:"off"}),N&&e.jsx("button",{type:"button",onClick:()=>D(!j),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5",children:j?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z",clipRule:"evenodd"}),e.jsx("path",{d:"M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),e.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirmar contraseña"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:R?"text":"password",name:`confirmPassword_${c}`,id:"confirmPassword",value:s.confirmPassword,onChange:C,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!i&&!N,autoComplete:"new-password",autoCorrect:"off",autoCapitalize:"off"}),N&&e.jsx("button",{type:"button",onClick:()=>$(!R),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5",children:R?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z",clipRule:"evenodd"}),e.jsx("path",{d:"M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),e.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]})})]})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Rol"}),e.jsx("div",{className:"mt-1",children:e.jsx("select",{id:"role",name:"role",value:s.role,onChange:C,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:u?u.map(m=>{let h=m;return m==="Ramon"?h="Gerente (Ramon)":m==="administrador"?h="Administrador":m==="editor"?h="Editor":m==="usuario"&&(h="Usuario"),e.jsx("option",{value:m,children:h},m)}):U?.role==="administrador"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"administrador",children:"Administrador"}),e.jsx("option",{value:"Ramon",children:"Gerente (Ramon)"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"usuario",children:"Usuario"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"usuario",children:"Usuario"})]})})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-5",children:[e.jsx("button",{type:"button",onClick:x,className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:f,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:f?"Guardando...":i?"Actualizar":"Crear"})]})]})},Z=({isOpen:t,title:o,message:x,confirmText:u,cancelText:s,onConfirm:l,onCancel:f,type:n="danger"})=>{if(!t)return null;const a=(()=>{switch(n){case"danger":return{icon:e.jsx("svg",{className:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmButton:"bg-red-600 hover:bg-red-700 focus:ring-red-500",iconBackground:"bg-red-100"};case"warning":return{icon:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmButton:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500",iconBackground:"bg-yellow-100"};case"info":default:return{icon:e.jsx("svg",{className:"h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmButton:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",iconBackground:"bg-blue-100"}}})();return e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${a.iconBackground} sm:mx-0 sm:h-10 sm:w-10`,children:a.icon}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:o}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:x})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",className:`inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm ${a.confirmButton}`,onClick:l,children:u}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:f,children:s})]})]})]})})},ee=({currentPage:t,totalPages:o,onPageChange:x})=>{if(o<=1)return null;const s=(()=>{const l=[];if(o<=5)for(let n=1;n<=o;n++)l.push(n);else if(t<=3)for(let n=1;n<=5;n++)l.push(n);else if(t>=o-2)for(let n=o-4;n<=o;n++)l.push(n);else for(let n=t-2;n<=t+2;n++)l.push(n);return l})();return e.jsx("nav",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando página ",e.jsx("span",{className:"font-medium",children:t})," de"," ",e.jsx("span",{className:"font-medium",children:o})]})}),e.jsx("div",{children:e.jsxs("ul",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>x(t-1),disabled:t===1,className:`relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${t===1?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("span",{className:"sr-only",children:"Anterior"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]})}),s.map(l=>e.jsx("li",{children:e.jsx("button",{onClick:()=>x(l),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${l===t?"z-10 bg-blue-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:l})},l)),e.jsx("li",{children:e.jsxs("button",{onClick:()=>x(t+1),disabled:t===o,className:`relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${t===o?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("span",{className:"sr-only",children:"Siguiente"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})})]})})]})})};let H=typeof window>"u";const se=({onEdit:t,onRefresh:o,forceLang:x})=>{const u=H?"es":x||O(),[s,l]=d.useState(u),[f,n]=d.useState([]),[g,a]=d.useState(!0),[i,w]=d.useState(null),[j,D]=d.useState(null),[R,$]=d.useState(null),[U,L]=d.useState(!1),[z,N]=d.useState(1),[F,C]=d.useState(1),[S,b]=d.useState(10),[c,m]=d.useState(0);d.useEffect(()=>{h();const r=X();r&&D(r),H&&(H=!1,setTimeout(()=>{l(O())},50))},[z,S,o]);const h=async()=>{a(!0);try{console.log("Solicitando usuarios: página",z,"tamaño",S),console.log("DEBUG: Usando URL absoluta para evitar errores de proxy");let r,y=[],M=1,_=0;try{console.log("DEBUG: Usando configuración centralizada para API");const v=localStorage.getItem("token"),W=`${`${k.backendURL||""}${k.baseURL}`}/users/?page=${z}&size=${S}`;console.log("DEBUG: URL completa construida desde API_CONFIG:",W);const G=await fetch(W,{headers:{Authorization:v?`Bearer ${v}`:"","Content-Type":"application/json"}});if(G.ok)r=await G.json(),console.log("DEBUG: Éxito con API centralizada:",r);else throw new Error(`Error en respuesta: ${G.status}`)}catch(v){console.log("DEBUG: Error con fetch usando API_CONFIG, intentando con userServiceProxy como último recurso",v),r=await P.getUsers(z,S)}if(console.log("Respuesta del servidor (tipo):",typeof r),console.log("Respuesta del servidor (valor):",r),Array.isArray(r))console.log("Formato detectado: Array directo de usuarios"),y=[...r],M=1,_=r.length;else if(r&&typeof r=="object")if(r.items&&Array.isArray(r.items))console.log("Formato detectado: Objeto con items[]"),y=[...r.items],M=r.pages||1,_=r.total||r.items.length;else{const v=r,T=v.users||v.data||v.results;Array.isArray(T)&&T.length>0&&(console.log("Formato alternativo detectado con usuarios"),y=[...T]),M=v.pages||v.totalPages||1,_=v.total||v.totalItems||v.count||y.length}console.log("Usuarios encontrados:",y.length),n(y),C(M),m(_),w(null)}catch(r){console.error("Error al cargar usuarios:",r),w(p("users.table.error",s))}finally{a(!1)}},E=r=>{N(r)},A=r=>{const y=parseInt(r.target.value);b(y),N(1)},I=r=>{$(r),L(!0)},q=async()=>{if(R)try{await P.deleteUser(R.id),L(!1),$(null),h(),o()}catch(r){console.error("Error al eliminar usuario:",r),w(p("users.table.delete_error",s)),L(!1)}},V=()=>{L(!1),$(null)},K=r=>{let y="";switch(r){case"administrador":y="bg-red-100 text-red-800";break;case"gerente":y="bg-blue-100 text-blue-800";break;case"editor":y="bg-green-100 text-green-800";break;default:y="bg-gray-100 text-gray-800"}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y}`,children:r})};return g&&f.length===0?e.jsx("div",{className:"text-center py-4",children:p("users.table.loading",s)}):i&&f.length===0?e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 my-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:i})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[p("users.table.showing",s)," ",f.length," ",p("users.table.of",s)," ",c," ",p("users.table.users",s)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"pageSize",className:"mr-2 text-sm text-gray-700",children:p("users.table.show",s)}),e.jsxs("select",{id:"pageSize",value:S,onChange:A,className:"rounded border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"})]})]})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:p("users.table.user",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:p("users.table.email",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:p("users.table.role",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:p("users.table.status",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:p("users.table.actions",s)})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500",children:p("users.table.no_users",s)})}):f.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.username}),e.jsx("div",{className:"text-sm text-gray-500",children:r.full_name})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:r.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:K(r.role)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.is_active?p("users.table.active",s):p("users.table.inactive",s)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>t(r),className:"text-indigo-600 hover:text-indigo-900 focus:outline-none",children:p("users.table.edit",s)}),j?.id!==r.id&&r.role!=="Ramon"&&(r.role!=="administrador"||j?.role==="administrador")&&e.jsx("button",{onClick:()=>I(r),className:"text-red-600 hover:text-red-900 focus:outline-none",children:p("users.table.delete",s)})]})]},r.id))})]})]}),F>1&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(ee,{currentPage:z,totalPages:F,onPageChange:E})}),e.jsx(Z,{isOpen:U,title:p("users.table.confirm_delete_title",s),message:p("users.table.confirm_delete_message",s).replace("{username}",R?.username||""),confirmText:p("users.table.confirm",s),cancelText:p("users.table.cancel",s),onConfirm:q,onCancel:V})]})};let J=typeof window>"u";const ie=()=>{const[t,o]=d.useState(!1),[x,u]=d.useState(void 0),[s,l]=d.useState(null),[f,n]=d.useState(!1),[g,a]=d.useState(0),i=J?"es":O(),[w,j]=d.useState(i),[D,R]=d.useState("Cargando..."),[$,U]=d.useState({});d.useEffect(()=>{J&&typeof window<"u"&&(J=!1,setTimeout(()=>{const b=O();j(b)},100))},[]),d.useEffect(()=>{const b=Q();if(R(b?"Autenticado":"No autenticado"),!b){U(m=>({...m,isAuthenticated:!1}));return}let c=X();if(b&&!c&&(console.log("Autenticado pero sin datos de usuario, recreando usuario administrador"),localStorage.getItem("token")&&(c={id:1,username:"admin",email:"admin@mascletimperi.com",full_name:"Administrador",role:"administrador",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},localStorage.setItem("user",JSON.stringify(c)))),U(m=>({...m,user:c?JSON.stringify(c):"null"})),c){l(c);let m=!1;c.username==="admin"?(m=!0,c.role!=="administrador"&&(console.log("Corrigiendo el rol del usuario admin de:",c.role,"a: administrador"),c.role="administrador",localStorage.setItem("user",JSON.stringify(c)))):m=c.role==="administrador"||c.role==="Ramon"||c.role==="gerente",n(m);const h={role:c.role,hasAdminRole:m,username:c.username,isAdmin:m,tokenExists:!!localStorage.getItem("token"),tokenFirstChars:localStorage.getItem("token")?.substring(0,15)+"..."||"no-token"};console.log("Información de depuración del usuario:",h),U(E=>({...E,...h}))}else U(m=>({...m,userFound:!1}))},[]);const L=()=>{u(void 0),o(!0)},z=b=>{u(b),o(!0)},N=()=>{o(!1),u(void 0),a(b=>b+1)},F=()=>{o(!1),u(void 0)},C=(b,c)=>w==="ca"&&{"Gestión de Usuarios":"Gestió d'Usuaris","Añadir Usuario":"Afegir Usuari","Nuevo Usuario":"Nou Usuari",Cargando:"Carregant"}[b]||c,S=()=>e.jsxs("div",{className:"bg-white border border-gray-300 p-4 mb-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Panel de Diagnóstico"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado de Autenticación:"})," ",D]}),e.jsxs("div",{children:[e.jsx("strong",{children:"¿Es administrador?:"})," ",f?"Sí":"No"]}),Object.entries($).map(([b,c])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[b,":"]})," ",typeof c=="object"?JSON.stringify(c):String(c)]},b))]})]});return!f&&s?e.jsxs(e.Fragment,{children:[S(),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 my-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"No tienes permisos para gestionar usuarios. Solo los administradores y usuarios con rol Ramon pueden acceder a esta sección."})})]})})]}):e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[S(),t?e.jsx(Y,{user:x,onSuccess:N,onCancel:F,availableRoles:f?["administrador","Ramon","editor","usuario"]:["editor","usuario"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:C("Gestión de Usuarios","Gestión de Usuarios")}),f&&e.jsx("button",{onClick:L,className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded shadow focus:outline-none focus:shadow-outline transition duration-150 ease-in-out",children:C("Añadir Usuario","Añadir Usuario")})]}),e.jsx(se,{onEdit:z,onRefresh:()=>a(b=>b+1),forceLang:w},g)]})]})};export{ie as UsersManagement};
