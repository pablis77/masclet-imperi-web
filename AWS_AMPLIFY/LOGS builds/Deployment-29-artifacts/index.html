<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Aplicación de Gestión Ganadera Masclet Imperi">
  <title>Masclet Imperi</title>
  <!-- Favicon -->
  <link rel="shortcut icon" href="/favico.ico" type="image/x-icon">
  <!-- CSS Crítico -->
  
  
  <!-- CSS por sección -->
  <!-- MARCADOR: CSS SECCIONES -->
</head>
<body>
  <div id="app">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Cargando aplicación...</p>
      <noscript>
        <p class="error-message">Esta aplicación requiere JavaScript para funcionar. Por favor, habilítalo en tu navegador.</p>
      </noscript>
    </div>
  </div>
  
  <!-- Scripts críticos -->
  <script src="/_astro/apiConfig.BYL0hBvc.js" type="module"></script>
  <script src="/_astro/apiConfigAdapter.B0N4Zv2p.js" type="module"></script>
  <script src="/_astro/apiService.DCRZ96ES.js" type="module"></script>
  <script src="/_astro/authService.CvC7CJU-.js" type="module"></script>
  <script src="/_astro/client.DKNAXmG2.js" type="module"></script>
  <script src="/_astro/config.DUTcyYPh.js" type="module"></script>
  <script src="/_astro/hoisted.1V3GKfbn.js" type="module"></script>
  <script src="/_astro/hoisted.BCvrb1Oz.js" type="module"></script>
  <script src="/_astro/hoisted.BIV2cWaw.js" type="module"></script>
  <script src="/_astro/hoisted.BIqjo7BV.js" type="module"></script>
  <script src="/_astro/hoisted.BV_2N16L.js" type="module"></script>
  <script src="/_astro/hoisted.BZelodpO.js" type="module"></script>
  <script src="/_astro/hoisted.C3xYb-ui.js" type="module"></script>
  <script src="/_astro/hoisted.CAmN3r4C.js" type="module"></script>
  <script src="/_astro/hoisted.CIMOwe07.js" type="module"></script>
  <script src="/_astro/hoisted.CLA89lsY.js" type="module"></script>
  <script src="/_astro/hoisted.CZWJGYzn.js" type="module"></script>
  <script src="/_astro/hoisted.CZe9BKd0.js" type="module"></script>
  <script src="/_astro/hoisted.CkMJnkcY.js" type="module"></script>
  <script src="/_astro/hoisted.D2c55RlZ.js" type="module"></script>
  <script src="/_astro/hoisted.D3qLyoWa.js" type="module"></script>
  <script src="/_astro/hoisted.DGGcg4U_.js" type="module"></script>
  <script src="/_astro/hoisted.J-PvLqDK.js" type="module"></script>
  <script src="/_astro/hoisted.URzcT_LN.js" type="module"></script>
  <script src="/_astro/hoisted._g6EniQO.js" type="module"></script>
  <script src="/_astro/hoisted.a0A2-I9N.js" type="module"></script>
  <script src="/_astro/hoisted.gdKQoGeX.js" type="module"></script>
  <script src="/_astro/hoisted.gwLOX2bX.js" type="module"></script>
  <script src="/_astro/hoisted.iM3qY8sM.js" type="module"></script>
  <script src="/_astro/notificationService.DETo-XEc.js" type="module"></script>
  <script src="/_astro/vendor.BAk4NxX6.js" type="module"></script>
  
  <!-- Scripts por sección (carga dinámica) -->
  <script>
  // Assets organizados por sección
  const SECTION_ASSETS = {
  "core": {
    "js": [
      "apiConfig.BYL0hBvc.js",
      "apiConfigAdapter.B0N4Zv2p.js",
      "apiService.DCRZ96ES.js",
      "authService.CvC7CJU-.js",
      "client.DKNAXmG2.js",
      "config.DUTcyYPh.js",
      "hoisted.1V3GKfbn.js",
      "hoisted.BCvrb1Oz.js",
      "hoisted.BIV2cWaw.js",
      "hoisted.BIqjo7BV.js",
      "hoisted.BV_2N16L.js",
      "hoisted.BZelodpO.js",
      "hoisted.C3xYb-ui.js",
      "hoisted.CAmN3r4C.js",
      "hoisted.CIMOwe07.js",
      "hoisted.CLA89lsY.js",
      "hoisted.CZWJGYzn.js",
      "hoisted.CZe9BKd0.js",
      "hoisted.CkMJnkcY.js",
      "hoisted.D2c55RlZ.js",
      "hoisted.D3qLyoWa.js",
      "hoisted.DGGcg4U_.js",
      "hoisted.J-PvLqDK.js",
      "hoisted.URzcT_LN.js",
      "hoisted._g6EniQO.js",
      "hoisted.a0A2-I9N.js",
      "hoisted.gdKQoGeX.js",
      "hoisted.gwLOX2bX.js",
      "hoisted.iM3qY8sM.js",
      "notificationService.DETo-XEc.js",
      "vendor.BAk4NxX6.js"
    ],
    "css": [
      "index.DJoSdzOi.css"
    ]
  },
  "DASHBOARD": {
    "js": [
      "DashboardV2.D3-bt97t.js",
      "NotificationsMenu._4m-Nx7C.js"
    ],
    "css": []
  },
  "other": {
    "js": [],
    "css": [],
    "sections": {
      "ANIMALES": {
        "js": [
          "/_astro/AnimalFilters.BavX2u2F.js",
          "/_astro/AnimalTable.DwggHQYQ.js",
          "/_astro/animalService.Dx4yrBkr.js",
          "/_astro/AnimalFilters.BavX2u2F.js",
          "/_astro/AnimalTable.DwggHQYQ.js",
          "/_astro/animalService.Dx4yrBkr.js"
        ],
        "css": []
      },
      "EXPLOTACIONES": {
        "js": [
          "/_astro/ExplotacionesPage.B9QRgxsO.js",
          "/_astro/ExplotacionesPage.B9QRgxsO.js"
        ],
        "css": []
      },
      "IMPORTACIONES": {
        "js": [
          "/_astro/ImportContainer.C-yjQJUV.js",
          "/_astro/ResetDatabaseButton.D6oeMAPH.js",
          "/_astro/ImportContainer.C-yjQJUV.js",
          "/_astro/ResetDatabaseButton.D6oeMAPH.js"
        ],
        "css": []
      },
      "EXTRAS": {
        "js": [
          "/_astro/LanguageSwitcher.astro_astro_type_script_index_0_lang.BhT4Hx0d.js",
          "/_astro/LanguageSwitcher.astro_astro_type_script_index_0_lang.BhT4Hx0d.js"
        ],
        "css": []
      },
      "USUARIOS": {
        "js": [
          "/_astro/RoleGuard.tKckocPJ.js",
          "/_astro/UsersManagement.BG60y4Gz.js",
          "/_astro/RoleGuard.tKckocPJ.js",
          "/_astro/UsersManagement.BG60y4Gz.js"
        ],
        "css": []
      },
      "CORE": {
        "js": [
          "/_astro/apiConfig.BYL0hBvc.js",
          "/_astro/apiConfigAdapter.B0N4Zv2p.js",
          "/_astro/apiService.DCRZ96ES.js",
          "/_astro/authService.CvC7CJU-.js",
          "/_astro/client.DKNAXmG2.js",
          "/_astro/config.DUTcyYPh.js",
          "/_astro/hoisted.1V3GKfbn.js",
          "/_astro/hoisted.BCvrb1Oz.js",
          "/_astro/hoisted.BIV2cWaw.js",
          "/_astro/hoisted.BIqjo7BV.js",
          "/_astro/hoisted.BV_2N16L.js",
          "/_astro/hoisted.BZelodpO.js",
          "/_astro/hoisted.C3xYb-ui.js",
          "/_astro/hoisted.CAmN3r4C.js",
          "/_astro/hoisted.CIMOwe07.js",
          "/_astro/hoisted.CLA89lsY.js",
          "/_astro/hoisted.CZWJGYzn.js",
          "/_astro/hoisted.CZe9BKd0.js",
          "/_astro/hoisted.CkMJnkcY.js",
          "/_astro/hoisted.D2c55RlZ.js",
          "/_astro/hoisted.D3qLyoWa.js",
          "/_astro/hoisted.DGGcg4U_.js",
          "/_astro/hoisted.J-PvLqDK.js",
          "/_astro/hoisted.URzcT_LN.js",
          "/_astro/hoisted._g6EniQO.js",
          "/_astro/hoisted.a0A2-I9N.js",
          "/_astro/hoisted.gdKQoGeX.js",
          "/_astro/hoisted.gwLOX2bX.js",
          "/_astro/hoisted.iM3qY8sM.js",
          "/_astro/notificationService.DETo-XEc.js",
          "/_astro/vendor.BAk4NxX6.js"
        ],
        "css": []
      },
      "LISTADOS": {
        "js": [
          "/_astro/listados-service.C0iTSrMs.js",
          "/_astro/listados-service.C0iTSrMs.js"
        ],
        "css": []
      }
    }
  }
};
  
  // Ruta base para los assets
  const BASE_PATH = '_astro';
  
  // Función para cargar un script dinámicamente
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = src;
      script.type = 'module';
      script.onload = resolve;
      script.onerror = reject;
      document.body.appendChild(script);
    });
  }
  
  // Función para cargar un CSS dinámicamente
  function loadCSS(href) {
    return new Promise((resolve) => {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = href;
      link.onload = resolve;
      document.head.appendChild(link);
    });
  }
  
  // Función para cargar assets de una sección específica
  async function loadSectionAssets(sectionName) {
    if (!SECTION_ASSETS[sectionName]) {
      console.warn('⚠️ Sección no encontrada:', sectionName);
      return;
    }
    
    const section = SECTION_ASSETS[sectionName];
    
    // Cargar CSS
    if (section.css && section.css.length > 0) {
      for (const cssFile of section.css) {
        // Evitar añadir dos veces _astro/
        let cleanCssFile = cssFile.replace(/^_astro//, '');
        let cssPath = BASE_PATH ? '/' + BASE_PATH + '/' + cleanCssFile : '/' + cleanCssFile;
        // Eliminar dobles barras
        cssPath = cssPath.replace(////g, '/');
        await loadCSS(cssPath);
        console.log('✅ CSS cargado:', cssFile);
      }
    }
    
    // Cargar JS
    if (section.js && section.js.length > 0) {
      for (const jsFile of section.js) {
        // Evitar añadir dos veces _astro/
        let cleanJsFile = jsFile.replace(/^_astro//, '');
        let jsPath = BASE_PATH ? '/' + BASE_PATH + '/' + cleanJsFile : '/' + cleanJsFile;
        // Eliminar dobles barras
        jsPath = jsPath.replace(////g, '/');
        await loadScript(jsPath);
        console.log('✅ Script cargado:', jsFile);
      }
    }
  }
  
  // Detectar sección actual basado en la ruta
  function detectCurrentSection() {
    const path = window.location.pathname;
    
    if (path.includes('/login')) {
      return 'LOGIN';
    } else if (path.includes('/explotacion')) {
      return 'EXPLOTACIONES';
    } else if (path.includes('/animal')) {
      return 'ANIMALES';
    } else if (path.includes('/listado')) {
      return 'LISTADOS';
    } else if (path.includes('/user')) {
      return 'USUARIOS';
    } else if (path.includes('/import')) {
      return 'IMPORTACION';
    } else if (path.includes('/backup')) {
      return 'BACKUPS';
    } else {
      // Por defecto cargar dashboard
      return 'DASHBOARD';
    }
  }
  
  // Cargar assets de la sección actual
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const currentSection = detectCurrentSection();
      console.log('🔍 Sección detectada:', currentSection);
      await loadSectionAssets(currentSection);
      console.log('✅ Assets de la sección cargados correctamente');
    } catch (error) {
      console.error('❌ Error al cargar assets de sección:', error);
    }
  });
</script>
  
  <!-- Script de diagnóstico y carga -->
  <script>
    // Muestra mensajes de diagnóstico en caso de error
    window.addEventListener('error', function(e) {
      console.error('⚠️ Error en la carga:', e);
      const loadingText = document.querySelector('.loading-text');
      if (loadingText) {
        loadingText.innerHTML = 'Error al cargar la aplicación<br><small>' + 
          e.message.substring(0, 100) + '...</small>';
        loadingText.style.color = '#ff3860';
      }
    });
    
    // Reporte de inicialización correcta
    window.addEventListener('load', function() {
      console.log('✅ Aplicación cargada correctamente');
      
      // Ocultar el spinner cuando la aplicación esté cargada
      const loadingSpinner = document.querySelector('.loading-spinner');
      const loadingContainer = document.querySelector('.loading-container');
      
      if (loadingSpinner) {
        loadingSpinner.style.display = 'none';
      }
      
      if (loadingContainer) {
        // Esperar un poco para mostrar una transición suave
        setTimeout(() => {
          loadingContainer.style.display = 'none';
        }, 300);
      }
    });
  </script>
</body>
</html>