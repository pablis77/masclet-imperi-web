import{r as s,b as C,a as e}from"./vendor.BAk4NxX6.js";import{i as I,g as k}from"./authService.CvC7CJU-.js";import{g as P}from"./roleService.DPZjdIfe.js";const T=()=>{const[i,v]=s.useState(null),[m,o]=s.useState(!0),[p,h]=s.useState(null),[f,b]=s.useState(null),[u,w]=s.useState(""),[t,j]=s.useState(""),[g,N]=s.useState(""),[S,n]=s.useState(null),[E,y]=s.useState("");s.useEffect(()=>{if(!I()){h("Debes iniciar sesi칩n para ver esta p치gina"),o(!1);return}let a=k();const r=localStorage.getItem("token");if(r)try{const l=C(r);console.log("Token JWT decodificado:",l);const d=l.sub||"",x=l.role||"";d==="Ramon"||x==="Ramon"?(console.log("游닇 Usuario Ramon detectado en el token JWT - usando datos reales"),a={id:14,username:"Ramon",email:"ramon@prueba.com",role:"Ramon",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("userRole","Ramon"),localStorage.setItem("username","Ramon")):(console.log(`游닇 Usuario ${d} detectado en el token JWT - usando datos del token`),a={id:1,username:d,email:`${d.toLowerCase()}@mascletimperi.com`,role:x||"usuario",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("userRole",x),localStorage.setItem("username",d))}catch(l){console.error("Error al procesar el token JWT:",l)}if(!a){h("No se pudo obtener la informaci칩n del usuario"),o(!1);return}a&&(a.username==="admin"&&a.role!=="administrador"&&(console.log("Corrigiendo rol para usuario admin de:",a.role,"a: administrador"),a.role="administrador",localStorage.setItem("user",JSON.stringify(a))),a.username==="Ramon"&&a.role!=="Ramon"&&(console.log("Corrigiendo rol para usuario Ramon de:",a.role,"a: Ramon"),a.role="Ramon",localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("ramonFix","true"),localStorage.setItem("userRole","Ramon")));const c=P();console.log("Rol actual detectado:",c),v(a),y(c),o(!1)},[]);const R=async a=>{if(a.preventDefault(),!u||!t||!g){n("Todos los campos son obligatorios");return}if(t!==g){n("Las nuevas contrase침as no coinciden");return}if(t.length<8){n("La nueva contrase침a debe tener al menos 8 caracteres");return}n(null),o(!0);try{const r=await fetch("/api/v1/users/me/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({current_password:u,new_password:t})});if(!r.ok){const c=await r.json();throw new Error(c.detail||"Error al cambiar la contrase침a")}w(""),j(""),N(""),b("Contrase침a actualizada correctamente"),setTimeout(()=>{b(null)},5e3)}catch(r){n(r.message)}finally{o(!1)}};return m?e.jsx("div",{className:"text-center p-4",children:"Cargando..."}):p?e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Error:"}),e.jsxs("span",{className:"block sm:inline",children:[" ",p]})]}):e.jsx("div",{className:"bg-white shadow-md rounded-lg p-6",children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Informaci칩n del usuario"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nombre de usuario"}),e.jsx("p",{className:"font-medium",children:i?.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Correo electr칩nico"}),e.jsx("p",{className:"font-medium",children:i?.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Rol"}),e.jsx("p",{className:"font-medium",children:i?.role})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Cambiar contrase침a"}),f&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:f})}),S&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:S})}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"oldPassword",children:"Contrase침a actual"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"oldPassword",type:"password",value:u,onChange:a=>w(a.target.value),placeholder:"Ingresa tu contrase침a actual"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"newPassword",children:"Nueva contrase침a"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"newPassword",type:"password",value:t,onChange:a=>j(a.target.value),placeholder:"Ingresa tu nueva contrase침a"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"confirmPassword",children:"Confirmar nueva contrase침a"}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"confirmPassword",type:"password",value:g,onChange:a=>N(a.target.value),placeholder:"Confirma tu nueva contrase침a"})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",type:"submit",disabled:m,children:m?"Procesando...":"Cambiar contrase침a"})})]})]})]})})};export{T as ProfileManagement};
