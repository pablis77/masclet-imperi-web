import{g as X,b as J}from"./listados-service.BvIhkIE3.js";import"./config.DUTcyYPh.js";import"./hoisted.BdTuqGqB.js";import"./LanguageSwitcher.astro_astro_type_script_index_0_lang.CXyVlJeA.js";import"./apiService.DFT83caO.js";import"./vendor.DPE1g--N.js";import"./apiConfigAdapter.B0N4Zv2p.js";function _(){try{localStorage.setItem("userLanguage","ca"),console.log("Listado Detail: Forzando idioma catalán en toda la página")}catch(o){console.error("Error al forzar idioma:",o)}}function Y(){try{_();const o="ca";console.log("Listado Detail: Actualizando traducciones al idioma:",o);const p=document.getElementById("page-title");p&&(p.textContent=o==="ca"?"Detalls del Llistat":"Detalles del Listado"),[{id:"btn-back",es:"Volver a Listados",ca:"Tornar a Llistats"},{id:"btn-edit",es:"Editar Listado",ca:"Editar Llistat"},{id:"export-btn-text",es:"Exportar a PDF",ca:"Exportar a PDF"},{selector:".campo-categoria",es:"Categoría",ca:"Categoria"},{selector:".campo-animales",es:"Animales",ca:"Animals"},{selector:".campo-creado",es:"Creado el",ca:"Creat el"},{selector:".empty-message",es:"No hay animales en este listado.",ca:"No hi ha animals en aquest llistat."},{selector:".col-nombre",es:"Nombre",ca:"Nom"},{selector:".col-codigo",es:"Código",ca:"Codi"},{selector:".col-explotacion",es:"Explotación",ca:"Explotació"},{selector:".col-genero",es:"Género",ca:"Gènere"},{selector:".col-estado",es:"Confirmación",ca:"Confirmació"},{selector:".col-observaciones",es:"Observaciones",ca:"Observacions"}].forEach(n=>{if(n.id){const c=document.getElementById(n.id);c&&(c.textContent=o==="ca"?n.ca:n.es)}else n.selector&&document.querySelectorAll(n.selector).forEach(c=>{c.textContent=o==="ca"?n.ca:n.es})}),console.log("Traducciones actualizadas correctamente")}catch(o){console.error("Error al actualizar traducciones:",o)}}function K(){try{let o=function(l){if(l.nodeType===3){let n=l.nodeValue.trim();if(n)for(const[c,y]of Object.entries(p))n.includes(c)&&(l.nodeValue=l.nodeValue.replace(c,y),console.log(`Traducido: '${c}' -> '${y}'`))}else for(let n=0;n<l.childNodes.length;n++)o(l.childNodes[n])};console.log("Aplicando traducción directa a todos los textos estáticos");const p={"Detalles del Listado":"Detalls del Llistat","Volver a Listados":"Tornar a Llistats","Editar Listado":"Editar Llistat","Exportar a PDF":"Exportar a PDF",Categoría:"Categoria",Animales:"Animals","Creado el":"Creat el","No hay animales en este listado":"No hi ha animals en aquest llistat",Nombre:"Nom",Código:"Codi",Explotación:"Explotació",Género:"Gènere",Confirmación:"Confirmació",Observaciones:"Observacions","Cargando detalles del listado...":"Carregant detalls del llistat...","Error al cargar los detalles del listado":"Error al carregar els detalls del llistat","Por favor, intenta nuevamente":"Si us plau, torna-ho a intentar"};o(document.body),document.title=document.title.replace("Detalles del Listado","Detalls del Llistat"),console.log("Traducción directa completada")}catch(o){console.error("Error en traducción directa:",o)}}document.addEventListener("DOMContentLoaded",()=>{_(),Y(),setTimeout(()=>{K()},500),window.addEventListener("storage",function(o){o.key==="userLanguage"&&(Y(),setTimeout(K,200))})});document.addEventListener("DOMContentLoaded",async()=>{const o=window.location.pathname.split("/"),p=o[o.length-1],l=document.getElementById("loading-message"),n=document.getElementById("listado-content"),c=document.getElementById("listado-title"),y=document.getElementById("listado-descripcion"),P=document.getElementById("listado-categoria"),F=document.getElementById("listado-animales-count"),z=document.getElementById("listado-fecha"),b=document.getElementById("empty-message"),L=document.getElementById("animals-table"),v=document.getElementById("animals-container");try{const i=await X(p);if(i){if(c&&(c.textContent=i.nombre||""),y&&(y.textContent=i.descripcion||""),P){let e="-";switch(i.categoria){case"vaccination":case"vacunacion":e="Vacunación";break;case"treatment":case"tratamiento":e="Tratamiento";break;case"inspection":case"inspeccion":e="Inspección";break;case"other":case"otro":e="Otro";break;default:e=i.categoria||"-"}P.textContent=e}F&&(F.textContent=i.animales?.length||0),z&&(z.textContent=i.created_at?new Date(i.created_at).toLocaleDateString():"-"),i.animales&&i.animales.length>0?(b&&b.classList.add("hidden"),L&&L.classList.remove("hidden"),v&&(v.innerHTML=""),i.animales.forEach(e=>{const r=document.createElement("tr"),C=e.genere==="M"?"Toro":"Vaca",a=e.estado==="OK"?"Activo":"Inactivo";r.innerHTML=`
              <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-white sm:pl-6">
                ${e.nom||""}
              </td>
              <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400">
                ${e.id||""}
              </td>
              <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400">
                ${e.explotacio||""}
              </td>
              <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400">
                ${C}
              </td>
              <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400">
                <select class="estado-animal border-gray-300 rounded-md text-sm" data-animal-id="${e.id}">
                  <option value="OK" ${e.confirmacion==="OK"?"selected":""}>OK</option>
                  <option value="NO" ${e.confirmacion==="NO"||!e.confirmacion?"selected":""}>NO</option>
                </select>
              </td>
              <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 dark:text-gray-400">
                <input type="text" class="observaciones-animal border-gray-300 rounded-md text-sm w-full" data-animal-id="${e.id}" placeholder="Observaciones" value="${e.observaciones||""}">
              </td>
            `,v&&v.appendChild(r)})):(b&&b.classList.remove("hidden"),L&&L.classList.add("hidden")),l&&l.classList.add("hidden"),n&&n.classList.remove("hidden");const W=document.getElementById("guardar-cambios"),w=document.getElementById("mensaje-exito"),S=document.getElementById("mensaje-error");W&&W.addEventListener("click",async()=>{try{const e=[],r=document.querySelectorAll(".estado-animal"),C=document.querySelectorAll(".observaciones-animal");r.forEach((h,t)=>{const u=parseInt(h.getAttribute("data-animal-id")),m=h.value,E=C[t]?.value||"";e.push({id:u,confirmacion:m,observaciones:E}),console.log(`Animal ${u}: confirmacion=${m}, observaciones=${E}`)});const a=await J(p,e);if(w){w.classList.remove("hidden"),S.classList.add("hidden");const h=e.filter(m=>m.confirmacion==="OK").length,t=e.length,u=document.getElementById("listado-animales-count");u&&(u.innerHTML=`<span class="text-green-600 font-medium">${h}</span>/${t}`),setTimeout(()=>{w.classList.add("hidden")},3e3)}}catch(e){console.error("Error al guardar los cambios:",e),S&&(S.classList.remove("hidden"),w.classList.add("hidden"),setTimeout(()=>{S.classList.add("hidden")},3e3))}});const x=document.getElementById("export-listado-pdf");x&&x.addEventListener("click",async()=>{const e=document.getElementById("pdf-export-status"),r=document.getElementById("export-btn-text"),C=r.textContent;e&&(e.textContent="Generando PDF...",e.className="mt-2 text-sm font-medium text-blue-600",e.classList.remove("hidden")),r&&(r.textContent="Procesando..."),x.disabled=!0,x.classList.add("opacity-70","cursor-not-allowed");try{if(typeof window.jspdf>"u"||typeof window.jsPDF>"u")throw new Error("No se pudo cargar la librería jsPDF. Por favor, recargue la página e inténtelo de nuevo.");const a=localStorage.getItem("userLanguage")||"es",{jsPDF:h}=window.jspdf,t=new h,u=document.getElementById("listado-title"),m=u?u.textContent.replace("Detalles del Listado: ","").trim():"Listado",E=a==="ca"?`Llistat - ${m}`:`Listado - ${m}`;t.setFontSize(10),t.setTextColor(100,100,100);const k=new Date().toLocaleDateString(a==="ca"?"ca-ES":"es-ES");t.text(a==="ca"?`Data: ${k}`:`Fecha: ${k}`,195,15,{align:"right"});const T=10;let I=T+35+20;try{const s=new Image;s.crossOrigin="Anonymous",s.src="/images/logo_masclet.png",await new Promise(($,O)=>{s.onload=$,s.onerror=D=>{console.error("Error al cargar la imagen:",D),O(D)}});const d=t.internal.pageSize.getWidth(),f=60,g=35,B=d/2-f/2;t.addImage(s,"PNG",B,T,f,g),t.setFontSize(20),t.setTextColor(40,40,40),t.text(E,d/2,T+g+10,{align:"center"}),I=T+g+25}catch(s){console.error("Error al cargar el logo:",s);const d=t.internal.pageSize.getWidth();t.setFontSize(20),t.setTextColor(40,40,40),t.text(E,d/2,30,{align:"center"}),I=45}t.setFontSize(14),t.setTextColor(50,50,50),t.text(a==="ca"?"Dades del llistat:":"Datos del listado:",20,I);const H=document.getElementById("listado-categoria"),j=document.getElementById("listado-animales-count"),G=document.getElementById("listado-fecha"),M=document.getElementById("listado-descripcion"),R=[[a==="ca"?"Nom":"Nombre",m],[a==="ca"?"Categoria":"Categoría",H?H.textContent:"-"],[a==="ca"?"Animals":"Animales",j?j.textContent:"0"],[a==="ca"?"Data de creació":"Fecha de creación",G?G.textContent:"-"],[a==="ca"?"Descripció":"Descripción",M?M.textContent:"-"]];window.autoTable(t,{startY:I+10,head:[[a==="ca"?"Camp":"Campo","Valor"]],body:R,theme:"grid",styles:{fontSize:9,cellPadding:2,lineWidth:.1,lineColor:[200,200,200],minCellHeight:8,valign:"middle"},headStyles:{fillColor:[126,211,33],textColor:255,fontStyle:"bold",minCellHeight:10},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:40,halign:"left"},1:{cellWidth:"auto",halign:"left"}}});let A=t.previousAutoTable.finalY+15;const N=[],V=document.querySelector("#animals-table tbody");if(V){const s=V.querySelectorAll("tr");let d=!1;if(s.forEach(f=>{const g=f.querySelectorAll("td");if(g.length>=4&&!f.textContent.includes("No hay animales")){d=!0;const B=g[0]?.textContent?.trim()||"N/A",$=g[1]?.textContent?.trim()||"N/A",O=g[2]?.textContent?.trim()||"N/A",D=g[3]?.textContent?.trim()||"N/A";N.push([B,$,O,D,"NO/OK",""])}}),d&&N.length>0){t.setFontSize(14),t.setTextColor(50,50,50),t.text(a==="ca"?"Animals al llistat:":"Animales en el listado:",20,A);const f=[a==="ca"?"Nom":"Nombre",a==="ca"?"Codi":"Código",a==="ca"?"Explotació":"Explotación",a==="ca"?"Gènere":"Género",a==="ca"?"Confirmació":"Confirmación",a==="ca"?"Observacions":"Observaciones"];window.autoTable(t,{startY:A+5,head:[f],body:N,theme:"grid",styles:{fontSize:8,cellPadding:2,lineWidth:.1,lineColor:[200,200,200],minCellHeight:8,valign:"middle"},headStyles:{fillColor:[126,211,33],textColor:255,fontStyle:"bold",minCellHeight:10},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:{0:{cellWidth:25},1:{cellWidth:20},2:{cellWidth:25},3:{cellWidth:15},4:{cellWidth:25},5:{cellWidth:"auto"}}}),A=t.previousAutoTable.finalY+10}}const q=t.internal.getNumberOfPages();for(let s=1;s<=q;s++){t.setPage(s),t.setFontSize(8),t.setTextColor(150,150,150);const d=t.internal.pageSize.getWidth();t.text("Masclet Imperi - Sistema de Gestión Ganadera",d/2,t.internal.pageSize.getHeight()-10,{align:"center"}),t.text(`Página ${s} de ${q}`,d/2,t.internal.pageSize.getHeight()-5,{align:"center"})}t.save(`listado_${m.replace(/\s+/g,"_").toLowerCase()}_${new Date().toISOString().split("T")[0]}.pdf`),e&&(e.textContent="PDF generado correctamente",e.className="mt-2 text-sm font-medium text-green-600")}catch(a){console.error("Error al generar el PDF:",a),e&&(e.textContent=`Error: ${a.message||"No se pudo generar el PDF"}`,e.className="mt-2 text-sm font-medium text-red-600")}finally{r&&(r.textContent=C),x.disabled=!1,x.classList.remove("opacity-70","cursor-not-allowed"),e&&e.classList.contains("text-green-600")&&setTimeout(()=>{e.classList.add("hidden")},5e3)}})}}catch(i){console.error("Error al cargar los detalles del listado:",i),l&&(l.innerHTML='<p class="text-red-500">Error al cargar los detalles del listado. Por favor, intenta nuevamente.</p>')}});
