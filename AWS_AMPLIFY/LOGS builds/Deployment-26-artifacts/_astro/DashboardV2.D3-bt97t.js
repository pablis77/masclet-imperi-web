import{_ as D,a as e,r as d,B,P as k,C as J,A as Y,p as U,d as G}from"./vendor.BAk4NxX6.js";import{a as S}from"./apiService.DCRZ96ES.js";import{t as i,getCurrentLanguage as H}from"./config.DUTcyYPh.js";import"./apiConfigAdapter.B0N4Zv2p.js";const K=typeof window<"u";let I={};async function z(){if(!K){console.log("⏩ Saltando registro de Chart.js en entorno SSR");return}try{const r=await D(()=>import("./vendor.BAk4NxX6.js").then(s=>s.g),[]);I=r.Chart,I.register(r.CategoryScale,r.LinearScale,r.PointElement,r.LineElement,r.BarElement,r.ArcElement,r.DoughnutController,r.PieController,r.BarController,r.LineController,r.ScatterController,r.RadarController,r.TimeScale,r.Tooltip,r.Legend),console.log("✅ Componentes de Chart.js registrados correctamente")}catch(r){console.error("Error al cargar Chart.js:",r)}}const F=({title:r,value:s,color:o,darkMode:l,translationKey:t})=>{const a=localStorage.getItem("userLanguage")||"es",m=t?i(t,a):r;return e.jsxs("div",{className:`${o}`,style:{width:"100%",padding:"0.75rem",borderRadius:"0.5rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem",border:l?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:m}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:s})]})},M=({number:r,title:s,darkMode:o,translationKey:l})=>{const t=localStorage.getItem("userLanguage")||"es",a=l?i(l,t):s;return e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"0.5rem",marginTop:"1rem",padding:"0.5rem",backgroundColor:o?"#7cb518":"#a4cc44",border:"none",borderRadius:"0.25rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"1.5rem",height:"1.5rem",borderRadius:"9999px",backgroundColor:"#fff",color:"#88c425",fontWeight:"bold",marginRight:"0.5rem"},children:r}),e.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"white"},children:a})]})};z();const Z=({data:r,darkMode:s})=>{const[o,l]=d.useState("es");if(d.useEffect(()=>{const n=localStorage.getItem("userLanguage")||"es";l(n);const c=u=>{u.key==="userLanguage"&&l(u.newValue||"es")};return window.addEventListener("storage",c),()=>window.removeEventListener("storage",c)},[]),!r)return null;let t={M:0,F:0,esforrada:0};r&&("M"in r&&"F"in r?t={M:r.M||0,F:r.F||0,esforrada:r.esforrada||0}:Object.entries(r).forEach(([c,u])=>{c==="M"||c==="m"?t.M+=u:c==="F"||c==="f"?t.F+=u:(c==="esforrada"||c==="ESFORRADA")&&(t.esforrada+=u)}));const a={M:i("dashboard.males",o),F:i("dashboard.females",o),esforrada:i("dashboard.others",o)},f={labels:Object.keys(t).map(n=>a[n]||n),datasets:[{label:"Género de las crías",data:Object.values(t),backgroundColor:["rgba(59, 130, 246, 0.7)","rgba(236, 72, 153, 0.7)","rgba(249, 115, 22, 0.7)"],borderColor:["rgba(59, 130, 246, 1)","rgba(236, 72, 153, 1)","rgba(249, 115, 22, 1)"],borderWidth:1}]};return e.jsx(k,{data:f})},q=({darkMode:r,data:s})=>{const[o,l]=d.useState("es");if(d.useEffect(()=>{const n=localStorage.getItem("userLanguage")||"es";l(n);const c=u=>{u.key==="userLanguage"&&l(u.newValue||"es")};return window.addEventListener("storage",c),()=>window.removeEventListener("storage",c)},[]),!Object.values(s||{}).some(n=>n>0))return e.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:r?"#d1d5db":"#6b7280"},children:o==="ca"?"No hi ha dades disponibles":"No hay datos disponibles"});if(!s||typeof s!="object")return console.error("No se recibieron datos válidos para el gráfico anual"),e.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:r?"#d1d5db":"#6b7280"},children:o==="ca"?"No hi ha dades disponibles":"No hay datos disponibles"});const m=Object.keys(s).filter(n=>typeof s[n]=="number"&&s[n]>0).sort((n,c)=>parseInt(n)-parseInt(c)),f={labels:m,datasets:[{label:o==="ca"?"Parts per any":"Partos por año",data:m.map(n=>s&&typeof s=="object"&&n in s?s[n]:0),backgroundColor:"#10b981",borderColor:"#059669",borderWidth:1}]};return e.jsx(B,{data:f,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Año"}},y:{title:{display:!0,text:"Número de partos"},beginAtZero:!0}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:n=>`Año ${n[0].label}`,label:n=>`Partos: ${n.formattedValue}`}}}}})},Q=({darkMode:r,data:s})=>{const[o,l]=d.useState("es");d.useEffect(()=>{const h=localStorage.getItem("userLanguage")||"es";l(h);const b=x=>{x.key==="userLanguage"&&l(x.newValue||"es")};return window.addEventListener("storage",b),()=>window.removeEventListener("storage",b)},[]);const t=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],m=o==="ca"?["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"]:t;let n={...{Enero:0,Febrero:0,Marzo:0,Abril:0,Mayo:0,Junio:0,Julio:0,Agosto:0,Septiembre:0,Octubre:0,Noviembre:0,Diciembre:0}};s&&typeof s=="object"&&("por_mes"in s&&s.por_mes&&typeof s.por_mes=="object"?n=s.por_mes:"Enero"in s||"enero"in s?n=s:Object.entries(s).forEach(([h,b])=>{if(h.match(/^\d{4}-\d{2}$/)){const x=parseInt(h.split("-")[1]);if(x>=1&&x<=12){const E=t[x-1];typeof b=="number"&&(n[E]+=b)}}}));const c=t.map(h=>n[h]||0),u={labels:m,datasets:[{label:o==="ca"?"Parts per mes":"Partos por mes",data:c,backgroundColor:"#3b82f6",borderColor:"#2563eb",borderWidth:1}]};return e.jsx(B,{data:u,options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Mes"}},y:{title:{display:!0,text:"Número de partos"},beginAtZero:!0}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:h=>h[0].label,label:h=>`Partos: ${h.formattedValue}`}}}}})},W=r=>{if(!r||Object.keys(r).length===0)return"N/A";const s=Object.entries(r);if(s.length===0)return"N/A";const o=s.reduce((l,t)=>t[1]>l[1]?t:l,s[0]);return`${o[0]} (${o[1]} partos)`},P=r=>{if(!r||Object.keys(r).length===0)return"N/A";const s=Object.entries(r).filter(l=>l[1]>0);if(s.length===0)return"N/A";const o=s.reduce((l,t)=>t[1]<l[1]?t:l,s[0]);return`${o[0]} (${o[1]} parto${o[1]!==1?"s":""})`},$=r=>{if(!r||Object.keys(r).length===0)return"N/A";const s=Object.entries(r).filter(([l,t])=>t>0).map(([l])=>l);return s.length===0?"N/A":s.sort((l,t)=>parseInt(l)-parseInt(t))[0]},T=r=>{if(!r||Object.keys(r).length===0)return"N/A";const s=Object.entries(r).filter(([t,a])=>a>0).map(([t])=>t);if(s.length===0)return"N/A";const o=s.sort((t,a)=>parseInt(a)-parseInt(t))[0],l=r[o];return`${o} (${l} parto${l!==1?"s":""})`},X=r=>{if(!r)return 0;const s=new Date().getFullYear().toString();return r[s]||0},ee=({statsData:r,partosData:s,darkMode:o,loading:l,error:t})=>{const[a,m]=d.useState("es");return d.useEffect(()=>{const f=localStorage.getItem("userLanguage");f&&m(f);const n=c=>{c.key==="userLanguage"&&m(c.newValue||"es")};return window.addEventListener("storage",n),()=>{window.removeEventListener("storage",n)}},[]),d.useEffect(()=>{r&&r.partos&&(console.log("DATOS MENSUALES RECIBIDOS:",r.partos.por_mes),console.log("TIPO DE DATOS:",typeof r.partos.por_mes),console.log("CLAVES:",Object.keys(r.partos.por_mes||{})),console.log("VALORES:",Object.values(r.partos.por_mes||{})),console.log("DATOS ANUALES RECIBIDOS:",r.partos.distribucion_anual),console.log("TIPO DE DATOS:",typeof r.partos.distribucion_anual),console.log("CLAVES:",Object.keys(r.partos.distribucion_anual||{})))},[r]),l?e.jsx("div",{className:"col-span-12 text-center py-4",children:i("dashboard.loading",a)}):t?e.jsxs("div",{className:"col-span-12 text-center py-4 text-red-500",children:[i("dashboard.loading_error",a),": ",t]}):!r||!s?e.jsx("div",{className:"col-span-12 text-center py-4",children:i("common.no_results",a)}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:i("dashboard.partos_analysis",a)}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[e.jsx(F,{title:i("dashboard.partos_count",a),value:r.partos.total,color:"bg-blue-500",darkMode:o,translationKey:"dashboard.partos_count"}),e.jsx(F,{title:a==="ca"?"Maig":"Mayo",value:r.partos.ultimo_mes,color:"bg-cyan-500",darkMode:o})]}),e.jsxs("div",{className:"mt-4",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[e.jsx(F,{title:new Date().getFullYear().toString(),value:X(r.partos.distribucion_anual),color:"bg-cyan-500",darkMode:o}),e.jsx(F,{title:a==="ca"?"Supervivència":"Supervivencia",value:`${((r.partos.tasa_supervivencia||0)*100).toFixed(1)}%`,color:"bg-emerald-500",darkMode:o})]})]}),e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:a==="ca"?"Distribució mensual":"Distribución mensual"}),e.jsx("div",{style:{height:"300px"},children:e.jsx(Q,{darkMode:o,data:r.partos.por_mes})}),e.jsx("div",{className:"text-xs text-center mt-2",style:{color:o?"#d1d5db":"#6b7280"},children:a==="ca"?"Distribució mensual de parts":"Distribución mensual de partos"}),e.jsx("div",{className:"text-xs text-center mt-1",style:{color:o?"rgba(209, 213, 219, 0.6)":"rgba(107, 114, 128, 0.6)"},children:e.jsx("span",{style:{fontSize:"9px"},children:a==="ca"?"Mes amb més parts: Març (46), mes amb menys parts: Agost (4)":"Mes con más partos: Marzo (46), mes con menos partos: Agosto (4)"})})]}),e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:a==="ca"?"Distribució anual detallada":"Distribución anual detallada"}),e.jsx("div",{style:{height:"300px"},children:e.jsx(q,{darkMode:o,data:r.partos.distribucion_anual})}),e.jsx("pre",{style:{display:"none",fontSize:"8px",maxHeight:"80px",overflow:"auto",margin:"0",padding:"4px",backgroundColor:o?"#1e293b":"#f1f5f9",borderRadius:"4px"},children:JSON.stringify(r.partos.distribucion_anual,null,2)}),e.jsx("div",{className:"text-sm text-center mt-3",style:{color:o?"#d1d5db":"#6b7280",fontWeight:"bold"},children:a==="ca"?"Distribució anual de parts (dades reals)":"Distribución anual de partos (datos reales)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-3 mb-2",children:[e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(59, 130, 246, 0.2)":"rgba(59, 130, 246, 0.1)",borderRadius:"6px",fontWeight:"semibold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Any amb ",e.jsx("strong",{children:"més"})," parts:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:W(r.partos.distribucion_anual)})]}):e.jsxs(e.Fragment,{children:["Año con ",e.jsx("strong",{children:"más"})," partos:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:W(r.partos.distribucion_anual)})]})}),e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(239, 68, 68, 0.2)":"rgba(239, 68, 68, 0.1)",borderRadius:"6px",fontWeight:"semibold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Any amb ",e.jsx("strong",{children:"menys"})," parts:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:P(r.partos.distribucion_anual)})]}):e.jsxs(e.Fragment,{children:["Año con ",e.jsx("strong",{children:"menos"})," partos:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:P(r.partos.distribucion_anual)})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(16, 185, 129, 0.2)":"rgba(16, 185, 129, 0.1)",borderRadius:"6px",fontWeight:"semibold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Primer any amb parts:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:$(r.partos.distribucion_anual)})]}):e.jsxs(e.Fragment,{children:["Primer año con partos:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:$(r.partos.distribucion_anual)})]})}),e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(245, 158, 11, 0.2)":"rgba(245, 158, 11, 0.1)",borderRadius:"6px",fontWeight:"semibold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Últim any amb parts:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:T(r.partos.distribucion_anual)})]}):e.jsxs(e.Fragment,{children:["Último año con partos:",e.jsx("br",{}),e.jsx("span",{className:"text-lg font-bold",children:T(r.partos.distribucion_anual)})]})})]}),e.jsx("div",{className:"text-sm text-center mt-3",style:{color:o?"#d1d5db":"#6b7280",fontWeight:"bold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Total: ",e.jsxs("span",{className:"text-lg",children:[r.partos.total," parts"]})]}):e.jsxs(e.Fragment,{children:["Total: ",e.jsxs("span",{className:"text-lg",children:[r.partos.total," partos"]})]})})]}),e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:i("dashboard.gender_distribution",a)}),e.jsx("div",{style:{height:"270px",display:"flex",justifyContent:"center"},children:e.jsx(Z,{data:r.partos.por_genero_cria,darkMode:o})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4 mb-2",children:[e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(37, 99, 235, 0.2)":"rgba(37, 99, 235, 0.1)",borderRadius:"6px",border:"1px solid rgba(37, 99, 235, 0.3)",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:a==="ca"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Mascles"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:r.partos.por_genero_cria?.M||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.M||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Machos"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:r.partos.por_genero_cria?.M||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.M||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]})}),e.jsx("div",{className:"text-sm text-center p-2",style:{backgroundColor:o?"rgba(236, 72, 153, 0.2)":"rgba(236, 72, 153, 0.1)",borderRadius:"6px",border:"1px solid rgba(236, 72, 153, 0.3)",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},children:a==="ca"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Femelles"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:r.partos.por_genero_cria?.F||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.F||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Hembras"}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:r.partos.por_genero_cria?.F||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.F||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]})})]}),(r.partos.por_genero_cria?.esforrada||0)>0&&e.jsx("div",{className:"mt-2 text-sm text-center p-2",style:{backgroundColor:o?"rgba(107, 114, 128, 0.2)":"rgba(107, 114, 128, 0.1)",borderRadius:"6px",border:"1px solid rgba(107, 114, 128, 0.3)"},children:a==="ca"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Esforrada"}),e.jsx("div",{className:"text-lg font-bold mt-1",children:r.partos.por_genero_cria?.esforrada||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.esforrada||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-semibold",children:"Esforrada"}),e.jsx("div",{className:"text-lg font-bold mt-1",children:r.partos.por_genero_cria?.esforrada||0}),e.jsxs("div",{className:"text-xs mt-1",children:["(",((r.partos.por_genero_cria?.esforrada||0)/((r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0))*100).toFixed(1),"% del total)"]})]})}),e.jsx("div",{className:"text-sm text-center mt-3",style:{color:o?"#d1d5db":"#6b7280",fontWeight:"bold"},children:a==="ca"?e.jsxs(e.Fragment,{children:["Total crías: ",e.jsx("span",{className:"text-lg",children:(r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0)})]}):e.jsxs(e.Fragment,{children:["Total crías: ",e.jsx("span",{className:"text-lg",children:(r.partos.por_genero_cria?.M||0)+(r.partos.por_genero_cria?.F||0)+(r.partos.por_genero_cria?.esforrada||0)})]})})]})]})};J.register(Y,U,G);const re=({darkMode:r=!1})=>{const s=H(),[o,l]=d.useState(null),[t,a]=d.useState(null),[m,f]=d.useState(null),[n,c]=d.useState(!0),[u,h]=d.useState(null);if(d.useEffect(()=>{(async()=>{try{c(!0),console.log("Obteniendo datos para ResumenOriginalCard desde endpoint optimizado...");const w=await S.get("/dashboard/resumen-card");l(w.stats),a(w.animales_detallados),f(w.periodo),console.log("Datos obtenidos correctamente desde endpoint optimizado"),c(!1),h(null)}catch(w){const L=w instanceof Error?w.message:"Error desconocido";console.error(`Error cargando datos desde endpoint optimizado: ${L}`),console.error("Intentando fallback a peticiones individuales...");try{const[C,A,R]=await Promise.all([S.get("/dashboard/stats"),S.get("/dashboard-detallado/animales-detallado"),S.get("/dashboard-periodo/periodo-dinamico")]);l(C),a(A),f(R),c(!1),h(null)}catch(C){const A=C instanceof Error?C.message:"Error desconocido";console.error(`Fallback también ha fallado: ${A}`),h("Error cargando datos del dashboard. Por favor, intenta de nuevo."),c(!1)}}})()},[]),n)return e.jsx("div",{className:"dashboard-card",style:{gridColumn:"span 12"},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Cargando datos del panel de control..."})]})});if(u)return e.jsx("div",{className:"dashboard-card",style:{gridColumn:"span 12"},children:e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),u]})})});const b=t?.total||0,x=t?.por_genero?.machos?.activos||0,E=t?.por_genero?.machos?.fallecidos||0,v=t?.por_genero?.hembras?.activas||0,O=t?.por_genero?.hembras?.fallecidas||0,p=t?.general?.activos||0,g=t?.general?.fallecidos||0,N=t?.por_alletar?.["0"]||0,_=t?.por_alletar?.["1"]||0,y=t?.por_alletar?.["2"]||0;return console.log("DATOS DETALLADOS USADOS:",{totalAnimals:b,activeMales:x,inactiveMales:E,activeFemales:v,inactiveFemales:O,activeAnimals:p,inactiveAnimals:g,nursing0:N,nursing1:_,nursing2:y}),console.log("RESPUESTA ORIGINAL:",t),e.jsxs("div",{className:`dashboard-card ${r?"bg-gray-800 text-white":""}`,style:{gridColumn:"span 12"},children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:m&&e.jsxs("div",{className:"text-sm bg-blue-100 text-blue-800 rounded-full px-3 py-1",children:[i("dashboard.summary_card.period",s),": ",m.formato_fecha_inicio||"N/A"," a ",m.formato_fecha_fin||"N/A",m.dias&&e.jsxs("span",{className:"ml-2 font-semibold",children:["• ",m.dias," ",i("dashboard.summary_card.days",s)]})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.75rem"},children:[e.jsxs("div",{style:{border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"0.5rem",overflow:"hidden",backgroundColor:r?"rgba(255, 255, 255, 0.1)":"white"},children:[e.jsx("h3",{className:`text-md font-semibold p-2 ${r?"bg-gray-700":"bg-gray-100"}`,children:i("dashboard.summary_card.animals_summary",s)}),e.jsxs("div",{className:"bg-purple-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.total_animals",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:b})]}),e.jsxs("div",{className:"bg-green-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.active_animals",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:p})]}),e.jsxs("div",{className:"bg-blue-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.active_males",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:x})]}),e.jsxs("div",{className:"bg-fuchsia-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.active_females",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:v})]})]}),e.jsxs("div",{style:{border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"0.5rem",overflow:"hidden",backgroundColor:r?"rgba(255, 255, 255, 0.1)":"white"},children:[e.jsx("h3",{className:`text-md font-semibold p-2 ${r?"bg-gray-700":"bg-gray-100"}`,children:i("dashboard.summary_card.nursing_status",s)}),e.jsxs("div",{className:"bg-orange-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.cows_not_nursing",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:N})]}),e.jsxs("div",{className:"bg-cyan-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.nursing_one_calf",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:_})]}),e.jsxs("div",{className:"bg-red-500",style:{width:"100%",padding:"0.75rem",display:"flex",flexDirection:"column",justifyContent:"center",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{color:"white",fontWeight:"bold",marginBottom:"0.25rem"},children:i("dashboard.summary_card.nursing_two_calves",s)}),e.jsx("p",{style:{color:"white",fontSize:"1.75rem",fontWeight:"bold",margin:0},children:y})]})]}),e.jsxs("div",{style:{border:"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",borderRadius:"0.5rem",overflow:"hidden",backgroundColor:r?"rgba(255, 255, 255, 0.1)":"white"},children:[e.jsx("h3",{className:`text-md font-semibold p-2 ${r?"bg-gray-700":"bg-gray-100"}`,children:i("dashboard.summary_card.population_analysis",s)}),e.jsx("div",{style:{padding:"0.75rem",height:"260px",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(k,{data:{labels:[i("dashboard.summary_card.bulls",s),i("dashboard.summary_card.cows",s),i("dashboard.summary_card.deceased",s)],datasets:[{data:[x,v,g],backgroundColor:["#3b82f6","#ec4899","#6b7280"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:r?"#fff":"#000",font:{size:12}}},tooltip:{callbacks:{label:function(j){let w=j.label||"",L=j.raw||0,C=j.dataset.data.reduce((R,V)=>Number(R)+Number(V),0),A=Math.round(Number(L)/C*100);return`${w}: ${L} (${A}%)`}}}}}})}),e.jsxs("div",{className:"text-xs text-center mt-1",style:{color:r?"#d1d5db":"#6b7280"},children:[i("dashboard.summary_card.male_female_ratio",s),": ",x,":",v," (",x&&v?(x/v).toFixed(2):"N/A",")"]})]})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[i("dashboard.summary_card.last_update",s),": ",new Date().toLocaleString()]})]})},ne=()=>{console.log("🟢 DASHBOARD V2 CARGADO - VERSIÓN NUEVA");const[r,s]=d.useState(null),[o,l]=d.useState(null),[t,a]=d.useState({stats:!0,partos:!0}),[m,f]=d.useState({stats:null,partos:null}),[n,c]=d.useState(!1),[u,h]=d.useState([]),b=(p,g=!1)=>{const _=`[${new Date().toISOString()}] ${g?"❌ ":""}${p}`;h(y=>[_,...y]),g?console.error(`[DashboardV2] ${p}`):console.log(`[DashboardV2] ${p}`)},x=()=>{a({stats:!0,partos:!0})},E=()=>{try{const p=sessionStorage.getItem("dashboardData");if(p){const g=JSON.parse(p),N=g.timestamp||0;if(new Date().getTime()-N<5*60*1e3)return b("✅ Usando datos en caché (< 5min)"),g.stats&&s(g.stats),g.partos&&l(g.partos),!0}}catch(p){console.warn("Error leyendo caché:",p)}return!1},v=p=>{try{const g={stats:p.stats,partos:p.partos,timestamp:new Date().getTime()};sessionStorage.setItem("dashboardData",JSON.stringify(g))}catch(g){console.warn("Error guardando caché:",g)}};d.useEffect(()=>{(async()=>{try{x(),E()&&a({stats:!1,partos:!1});try{b("Obteniendo datos del dashboard...");const[y,j]=await Promise.all([S.get("/dashboard/stats"),S.get("/dashboard/partos")]);s(y),l(j),a({stats:!1,partos:!1}),f({stats:null,partos:null}),v({stats:y,partos:j}),b("✅ Datos del dashboard cargados correctamente")}catch(y){const j=y instanceof Error?y.message:"Error desconocido";b(`Error cargando datos: ${j}`,!0),f({stats:j,partos:j}),a({stats:!1,partos:!1})}}catch(_){console.error("Error general cargando datos:",_)}})();const g=document.documentElement.classList.contains("dark");c(g);const N=new MutationObserver(_=>{_.forEach(y=>{if(y.attributeName==="class"){const j=document.documentElement.classList.contains("dark");c(j)}})});return N.observe(document.documentElement,{attributes:!0}),()=>{N.disconnect()}},[]),d.useEffect(()=>{typeof window<"u"&&(async()=>{try{b("Registrando componentes de Chart.js..."),await z(),b("✅ Componentes de Chart.js registrados correctamente")}catch(g){b("❌ Error al registrar componentes de Chart.js",!0),console.error("Error registrando Chart.js:",g)}})()},[]);const O=()=>{document.documentElement.classList.contains("dark")?document.documentElement.classList.remove("dark"):document.documentElement.classList.add("dark")};return e.jsxs("div",{className:`dashboard-container ${n?"theme-dark":"theme-light"}`,"data-component-name":"DashboardV2",children:[e.jsx("button",{onClick:O,style:{position:"fixed",bottom:"6rem",left:"1rem",backgroundColor:n?"#374151":"#e5e7eb",color:n?"white":"black",padding:"0.75rem",borderRadius:"9999px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",zIndex:20,border:"none",cursor:"pointer",fontSize:"1.2rem"},children:n?"☀️":"🌙"}),e.jsx("div",{className:"dashboard-header"}),e.jsx(M,{number:"1",title:"Resumen General",darkMode:n,translationKey:"dashboard.summary"}),e.jsx("div",{className:"stats-grid-lg",children:e.jsx(re,{darkMode:n})}),e.jsx(M,{number:"2",title:"Análisis de Partos",darkMode:n,translationKey:"dashboard.partos_analysis"}),e.jsxs("div",{className:"combined-stats-grid",children:[e.jsx("div",{style:{display:"contents"},children:e.jsx(ee,{statsData:r,partosData:o,darkMode:n,loading:t.stats||t.partos,error:m.stats||m.partos})}),e.jsx("div",{})]})]})};export{ne as default};
