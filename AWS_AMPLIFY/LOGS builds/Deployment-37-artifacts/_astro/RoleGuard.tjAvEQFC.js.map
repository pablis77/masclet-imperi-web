{"version":3,"file":"RoleGuard.tjAvEQFC.js","sources":["../../../src/components/guards/RoleGuard.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { getCurrentRole } from '../../services/roleService';\nimport type { UserRole } from '../../services/roleService';\nimport { isAuthenticated } from '../../services/authService';\n\ninterface RoleGuardProps {\n  allowedRoles: string[];\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n  redirectToLogin?: boolean;\n}\n\n/**\n * Componente para proteger rutas basado en roles de usuario\n * Verifica si el usuario tiene alguno de los roles permitidos para acceder al contenido\n */\nexport const RoleGuard: React.FC<RoleGuardProps> = ({\n  allowedRoles,\n  children,\n  fallback = null,\n  redirectToLogin = true\n}) => {\n  const [isClient, setIsClient] = useState<boolean>(false);\n  const [canAccess, setCanAccess] = useState<boolean>(false);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [currentRole, setCurrentRole] = useState<string>('');\n\n  // Efecto para detectar el entorno cliente\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  // Efecto para gestionar el acceso, solo se ejecuta en el cliente\n  useEffect(() => {\n    // Solo ejecutar en el cliente\n    if (!isClient) return;\n    \n    // Si el usuario no está autenticado y se solicita redirección\n    if (!isAuthenticated() && redirectToLogin) {\n      console.log('Usuario no autenticado, redirigiendo a login');\n      window.location.href = '/login';\n      return;\n    }\n    \n    // Verificar rol del usuario\n    const role = getCurrentRole();\n    console.log('Rol actual:', role);\n    console.log('Roles permitidos:', allowedRoles);\n    \n    setCurrentRole(role);\n    const hasAccess = allowedRoles.includes(role);\n    console.log('¿Tiene acceso?', hasAccess);\n    \n    setCanAccess(hasAccess);\n    setLoading(false);\n    \n    if (!hasAccess && redirectToLogin) {\n      console.log(`Acceso denegado: se requiere uno de estos roles [${allowedRoles.join(', ')}]`);\n      // No redirigimos automáticamente, solo mostramos mensaje de acceso denegado\n    }\n  }, [isClient, allowedRoles, redirectToLogin]);\n\n  // Mostrar indicador de carga mientras se verifica el acceso\n  // o si aún no estamos en el cliente\n  if (loading || !isClient) {\n    return (\n      <div className=\"flex items-center justify-center p-4\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  // Mostrar el contenido si tiene acceso, o el fallback si no\n  return canAccess ? (\n    <>{children}</>\n  ) : (\n    <>\n      {fallback || (\n        <div className=\"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 my-4 rounded shadow-md\" role=\"alert\">\n          <div className=\"flex items-center\">\n            <svg className=\"w-6 h-6 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path>\n            </svg>\n            <div>\n              <p className=\"font-bold\">Acceso denegado</p>\n              <p>No tienes los permisos necesarios para acceder a esta página.</p>\n              <p className=\"mt-2 text-sm\">Se requiere uno de estos roles: {allowedRoles.join(', ')}</p>\n              <p className=\"mt-2 text-sm\">Tu rol actual: {currentRole}</p>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default RoleGuard;\n"],"names":["RoleGuard","allowedRoles","children","fallback","redirectToLogin","isClient","setIsClient","useState","canAccess","setCanAccess","loading","setLoading","currentRole","setCurrentRole","useEffect","isAuthenticated","role","getCurrentRole","hasAccess","jsx","Fragment","jsxs"],"mappings":"4IAgBO,MAAMA,EAAsC,CAAC,CAClD,aAAAC,EACA,SAAAC,EACA,SAAAC,EAAW,KACX,gBAAAC,EAAkB,EACpB,IAAM,CACJ,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAAA,SAAkB,EAAK,EACjD,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAAkB,EAAK,EACnD,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAkB,EAAI,EAC9C,CAACK,EAAaC,CAAc,EAAIN,EAAAA,SAAiB,EAAE,EAuCrD,OApCJO,EAAAA,UAAU,IAAM,CACdR,EAAY,EAAI,CAClB,EAAG,EAAE,EAGLQ,EAAAA,UAAU,IAAM,CAEd,GAAI,CAACT,EAAU,OAGX,GAAA,CAACU,EAAgB,GAAKX,EAAiB,CACzC,QAAQ,IAAI,8CAA8C,EAC1D,OAAO,SAAS,KAAO,SACvB,MAAA,CAIF,MAAMY,EAAOC,EAAe,EACpB,QAAA,IAAI,cAAeD,CAAI,EACvB,QAAA,IAAI,oBAAqBf,CAAY,EAE7CY,EAAeG,CAAI,EACb,MAAAE,EAAYjB,EAAa,SAASe,CAAI,EACpC,QAAA,IAAI,iBAAkBE,CAAS,EAEvCT,EAAaS,CAAS,EACtBP,EAAW,EAAK,EAEZ,CAACO,GAAad,GAChB,QAAQ,IAAI,oDAAoDH,EAAa,KAAK,IAAI,CAAC,GAAG,CAG3F,EAAA,CAACI,EAAUJ,EAAcG,CAAe,CAAC,EAIxCM,GAAW,CAACL,EAEZc,MAAC,OAAI,UAAU,uCACb,eAAC,MAAI,CAAA,UAAU,8DAA8D,CAC/E,CAAA,EAKGX,EACLW,EAAAA,IAAAC,EAAA,SAAA,CAAG,SAAAlB,CAAS,CAAA,oBAGT,SACCC,GAAAgB,EAAA,IAAC,MAAI,CAAA,UAAU,+EAA+E,KAAK,QACjG,SAACE,EAAA,KAAA,MAAA,CAAI,UAAU,oBACb,SAAA,CAACF,EAAAA,IAAA,MAAA,CAAI,UAAU,eAAe,KAAK,OAAO,OAAO,eAAe,QAAQ,YAAY,MAAM,6BACxF,SAACA,EAAAA,IAAA,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAY,IAAI,EAAE,sIAAA,CAAuI,CAC9M,CAAA,SACC,MACC,CAAA,SAAA,CAACA,EAAA,IAAA,IAAA,CAAE,UAAU,YAAY,SAAe,kBAAA,EACxCA,EAAAA,IAAC,KAAE,SAA6D,+DAAA,CAAA,EAChEE,EAAAA,KAAC,IAAE,CAAA,UAAU,eAAe,SAAA,CAAA,mCAAiCpB,EAAa,KAAK,IAAI,CAAA,EAAE,EACrFoB,EAAAA,KAAC,IAAE,CAAA,UAAU,eAAe,SAAA,CAAA,kBAAgBT,CAAA,CAAY,CAAA,CAAA,CAC1D,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EAEJ,CAEJ"}