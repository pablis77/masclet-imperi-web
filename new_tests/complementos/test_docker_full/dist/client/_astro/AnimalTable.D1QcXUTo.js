import{r as l,j as e}from"./vendor-react.DLP523nT.js";import{a as K}from"./animalService.CGD0ISy9.js";import"./vendor-charts.C44Mn7ly.js";import"./vendor.CIJYp_OF.js";import"./apiService.BiZKHdlD.js";import"./api.BZ43VDWK.js";const q={es:{"animals.table.type":"Tipo","animals.table.name":"Nombre","animals.table.code":"C칩digo","animals.table.exploitation":"Explotaci칩n","animals.table.status":"Estado","animals.table.actions":"Acciones","animals.table.view":"Ver","animals.table.update":"Actualizar","animals.table.active":"Activo","animals.table.inactive":"Baja","animals.male":"Macho","animals.female":"Hembra"},ca:{"animals.table.type":"Tipus","animals.table.name":"Nom","animals.table.code":"Codi","animals.table.exploitation":"Explotaci칩","animals.table.status":"Estat","animals.table.actions":"Accions","animals.table.view":"Veure","animals.table.update":"Actualitzar","animals.table.active":"Actiu","animals.table.inactive":"Baixa","animals.male":"Mascle","animals.female":"Femella"}};function h(d,c){c!=="es"&&c!=="ca"&&(c="es");try{const g=q[c];return d in g?g[d]:(console.warn(`[Translation] Clave no encontrada: ${d} para idioma: ${c}`),d)}catch(g){return console.error(`[Translation] Error al traducir ${d}:`,g),d}}const re=({initialFilters:d={},id:c,canEdit:g=!1,canCreate:G=!1})=>{const[E,A]=l.useState([]),[f,k]=l.useState(!1),[M,p]=l.useState(null),[y,D]=l.useState(d),[n,S]=l.useState(1),[m,T]=l.useState(1),[v,$]=l.useState(0),[j,B]=l.useState(!1),[u,N]=l.useState(null),L=l.useRef(null),x=l.useRef(null),[i,H]=l.useState("es"),[J,_]=l.useState(!1);l.useEffect(()=>{_(!0);const a=localStorage.getItem("userLanguage")||"es";console.log("[AnimalTable] Idioma detectado:",a),H(a)},[]);const w=async()=>{try{k(!0),p(null),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{f&&(k(!1),p("Tiempo de espera agotado. Por favor, intenta de nuevo."))},1e4),await new Promise(s=>setTimeout(s,500));const a=window.location.hostname.includes("render.com");let r;try{console.log(`Cargando animales - P치gina: ${n}, L칤mite: 15`),r=await K.getAnimals({...y,page:n,limit:15})}catch(s){if(console.error("Error al obtener animales desde API:",s),a)console.warn("Detectado entorno Render: usando respuesta alternativa"),r={items:[],total:0,page:1,limit:10,pages:1};else throw s}if(a||!r.items||!Array.isArray(r.items)){if(console.log("Aplicando correcci칩n defensiva a la respuesta"),(!r||typeof r!="object")&&(r={items:[],total:0,page:1,limit:10,pages:1}),!r.items)r.items=[];else if(!Array.isArray(r.items))if(console.warn("response.items no es un array, intentando reparar"),typeof r.items=="object"){const s=[];try{Object.values(r.items).forEach(t=>{t&&typeof t=="object"&&s.push(t)}),r.items=s.length>0?s:[]}catch(t){console.error("Error al intentar reparar items:",t),r.items=[]}}else r.items=[]}let o=[...r.items];if(y.search&&y.search.trim()!==""){const s=y.search.trim().toLowerCase();o.sort((t,C)=>{const R=t.nom?.toLowerCase()===s,I=C.nom?.toLowerCase()===s;if(R&&!I)return-1;if(!R&&I)return 1;const z=t.nom?.toLowerCase().startsWith(s),P=C.nom?.toLowerCase().startsWith(s);if(z&&!P)return-1;if(!z&&P)return 1;const W=t.nom?.toLowerCase().includes(s),O=C.nom?.toLowerCase().includes(s);return W&&!O?-1:!W&&O?1:0}),console.log("Animales ordenados localmente:",o.map(t=>t.nom||"Sin nombre"))}A(o),$(r.total||0),T(r.pages||1),document.dispatchEvent(new CustomEvent("animals-loaded",{detail:{total:r.total||0,filtered:r.items?.length||0,page:r.page||1,pages:r.pages||1}}))}catch(a){console.error("Error cargando animales:",a),a.code==="DB_COLUMN_ERROR"||a.message&&a.message.includes("estado_t")?(p('La columna "estado_t" no existe en la tabla de animales. Este es un problema conocido del backend que est치 siendo solucionado. Mientras tanto, se mostrar치n datos simulados si est치n disponibles.'),B(!0)):p(a.message||"Error al cargar los animales"),A([]),$(0),T(0)}finally{x.current&&(clearTimeout(x.current),x.current=null),k(!1)}};l.useEffect(()=>(w(),()=>{x.current&&clearTimeout(x.current)}),[]),l.useEffect(()=>{w()},[y,n]),l.useEffect(()=>{const a=t=>{D(t.detail),S(1),t.detail.search||N(null)},r=()=>{w(),N(null)},o=t=>{N(t.detail),B(t.detail.usedMock),t.detail.usedMock?p(`Nota: Mostrando resultados simulados debido a un ${t.detail.reason}. Se encontraron ${t.detail.count} coincidencias para "${t.detail.term}".`):p(null)};document.addEventListener("refresh-animals",r),document.addEventListener("reload-animals",r),document.addEventListener("search-completed",o);const s=document.getElementById(c||"");return s?s.addEventListener("apply-filters",a):document.addEventListener("filters-applied",a),()=>{document.removeEventListener("refresh-animals",r),document.removeEventListener("reload-animals",r),document.removeEventListener("search-completed",o),s?s.removeEventListener("apply-filters",a):document.removeEventListener("filters-applied",a)}},[c]),l.useEffect(()=>{const a=document.getElementById("totalAnimalsContainer");if(a)if(f)a.innerHTML=`
          <span class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
            <div class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-primary mr-2"></div>
            Cargando...
          </span>
        `;else if(u&&u.term){const r=u.usedMock?'<span class="ml-1 px-1 py-0.5 text-xs bg-yellow-200 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-200 rounded">DATOS SIMULADOS</span>':"";a.innerHTML=`
            <span class="text-sm text-gray-500 dark:text-gray-400">
              Total: ${v} animales | B칰squeda: "${u.term}" (${u.count} coincidencias) ${r}
            </span>
          `}else{const r=j?'<span class="ml-1 px-1 py-0.5 text-xs bg-yellow-200 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-200 rounded">DATOS SIMULADOS</span>':"";a.innerHTML=`
            <span class="text-sm text-gray-500 dark:text-gray-400">
              Total: ${v} animales ${r}
            </span>
          `}},[v,f,u,j]);const b=a=>{console.log(`Cambiando a p치gina ${a}`),a!==n&&(S(a),L.current&&L.current.scrollIntoView({behavior:"smooth"}))},F=()=>m<=1?null:e.jsxs("div",{className:"flex items-center justify-center mt-6 space-x-1",children:[e.jsxs("button",{onClick:()=>b(1),disabled:n===1,className:`inline-flex items-center px-2 py-1 border rounded-md text-sm font-medium 
                    ${n===1?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 border-gray-200 dark:border-gray-700 cursor-not-allowed":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:"sr-only",children:"Primera"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})})]}),e.jsxs("button",{onClick:()=>b(n-1),disabled:n===1,className:`inline-flex items-center px-2 py-1 border rounded-md text-sm font-medium 
                    ${n===1?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 border-gray-200 dark:border-gray-700 cursor-not-allowed":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:"sr-only",children:"Anterior"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})]}),[...Array(m)].map((a,r)=>{const o=r+1;return o===1||o===m||o>=n-1&&o<=n+1?e.jsx("button",{onClick:()=>b(o),className:`inline-flex items-center px-3 py-1 border text-sm font-medium rounded-md 
                          ${o===n?"bg-primary/10 dark:bg-primary/30 text-primary border-primary/20 dark:border-primary/40":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:o},o):o===n-2||o===n+2?e.jsx("span",{className:"px-1 text-gray-500 dark:text-gray-400",children:"..."},`ellipsis-${o}`):null}),e.jsxs("button",{onClick:()=>b(n+1),disabled:n===m,className:`inline-flex items-center px-2 py-1 border rounded-md text-sm font-medium 
                    ${n===m?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 border-gray-200 dark:border-gray-700 cursor-not-allowed":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:"sr-only",children:"Siguiente"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("button",{onClick:()=>b(m),disabled:n===m,className:`inline-flex items-center px-2 py-1 border rounded-md text-sm font-medium 
                    ${n===m?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-600 border-gray-200 dark:border-gray-700 cursor-not-allowed":"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx("span",{className:"sr-only",children:"칔ltima"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"})})]})]}),V=a=>{const r="text-2xl";return a.genere==="M"?e.jsx("span",{className:r,children:"游낵"}):a.alletar!=="0"?e.jsx("span",{className:r,children:"游낷"}):e.jsx("span",{className:r,children:"游냝"})},U=a=>{const r=a.estado==="OK"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r}`,children:a.estado==="OK"?h("animals.table.active",i):h("animals.table.inactive",i)})};return e.jsxs("div",{ref:L,className:"w-full overflow-x-auto",children:[j&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-200",children:"Mostrando datos simulados. No se pudo conectar con el servidor. Los animales mostrados son de ejemplo y no reflejan datos reales."})})]})}),M&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/30 border-l-4 border-red-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-200",children:M})})]})}),f?e.jsxs("div",{className:"flex justify-center items-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Cargando animales..."})]}):E.length===0?e.jsxs("div",{className:"text-center py-8 bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-lg",children:"No se encontraron animales"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Intenta con otros filtros o importa datos de prueba"}),e.jsx("button",{onClick:w,className:"mt-4 bg-primary hover:bg-primary/80 text-white px-4 py-2 rounded-md transition-colors",children:"Reintentar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-100 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Tipus":"Tipo"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Nom":"Nombre"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Codi":"C칩digo"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Explotaci칩":"Explotaci칩n"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Estat":"Estado"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-200 uppercase tracking-wider",children:i==="ca"?"Accions":"Acciones"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600",children:E.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("a",{href:`/animals/${a.id}`,className:"cursor-pointer hover:scale-110 transition-transform inline-block",title:a.alletar==="0"?"No amamantando":a.alletar==="1"?"Amamantando 1 ternero":"Amamantando 2 terneros",children:V(a)})}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-200",children:a.nom}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.genere==="M"?h("animals.male",i):h("animals.female",i)})]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-200",children:a.cod||"-"}),a.num_serie&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Serie: ",a.num_serie]})]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.explotacio})})})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:U(a)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("a",{href:`/animals/${a.id}`,className:"inline-flex items-center px-2 py-1 bg-primary text-white rounded hover:bg-primary/80",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),h("animals.table.view",i)]}),g&&a.estado==="OK"&&e.jsxs("a",{href:`/animals/update/${a.id}`,className:"inline-flex items-center px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),h("animals.table.update",i)]})]})})]},a.id))})]})}),F()]})]})};export{re as default};
