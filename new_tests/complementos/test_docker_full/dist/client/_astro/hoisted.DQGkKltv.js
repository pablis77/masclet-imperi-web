import"./hoisted.CJA0zZzA.js";import{s as f,a as u}from"./hoisted.DqPf54Wg.js";import{b5 as g}from"./vendor.CIJYp_OF.js";import{a as E}from"./animalService.CGD0ISy9.js";import"./LanguageSwitcher.astro_astro_type_script_index_0_lang.D2FS4ZfD.js";import"./apiService.BiZKHdlD.js";import"./api.BZ43VDWK.js";document.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("create-animal-form");r&&r.addEventListener("submit",async i=>{i.preventDefault();try{console.log("Enviando datos del nuevo animal..."),await new Promise(t=>setTimeout(t,1e3)),window.location.href="/animals?success=true&message=Animal+creado+correctamente"}catch(t){console.error("Error al crear animal:",t),alert("Error al crear el animal. Inténtalo de nuevo.")}})});g({});document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("new-animal-form"),i=document.getElementById("genere"),t=document.getElementById("alletar-container");i&&t&&i.addEventListener("change",()=>{i.value==="F"?t.classList.remove("hidden"):t.classList.add("hidden")}),r&&r.addEventListener("submit",async d=>{d.preventDefault();const n=r.querySelector('button[type="submit"]');n&&(n.disabled=!0,n.innerHTML="Creando...");try{const s=new FormData(r),e={};for(const[a,l]of s.entries())if(l!=="")if(a==="dob"&&l){const c=l.split("-");c.length===3?e[a]=`${c[2]}/${c[1]}/${c[0]}`:e[a]=l}else e[a]=l;const m=["nom","genere","explotacio","estado"];for(const a of m)if(!e[a])throw new Error(`El campo ${a} es obligatorio`);if(e.genere==="F"&&!e.alletar&&(e.alletar="0"),e.genere==="M"&&e.alletar&&delete e.alletar,console.log("Datos a enviar:",e),!localStorage.getItem("token"))throw new Error("No hay token de autenticación. Por favor, inicie sesión nuevamente.");const o=await E.createAnimal(e);console.log("Animal creado:",o),f("Animal creado",`El animal ${e.nom} ha sido creado correctamente`),setTimeout(()=>{let a;if(o&&o.data&&o.data.id)a=o.data.id;else if(o&&o.id)a=o.id;else{console.error("No se pudo obtener el ID del animal creado:",o),window.location.href="/animals";return}console.log("Redirigiendo a la ficha del animal con ID:",a),window.location.href=`/animals/${a}`},1e3)}catch(s){console.error("Error al crear animal:",s),u("Error",s.message||"Ha ocurrido un error al crear el animal"),n&&(n.disabled=!1,n.innerHTML="Crear Animal")}})});
