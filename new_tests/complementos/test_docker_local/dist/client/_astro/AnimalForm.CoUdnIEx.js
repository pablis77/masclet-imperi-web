import{r as c,j as e}from"./vendor-react.DLP523nT.js";import{a as n}from"./animalService.CGD0ISy9.js";import"./vendor-charts.C44Mn7ly.js";import"./vendor.CIJYp_OF.js";import"./apiService.BiZKHdlD.js";import"./api.BZ43VDWK.js";const z=({animalData:t,explotaciones:l=[],isEditMode:x=!1,onSuccess:v,onCancel:N})=>{const[o,m]=c.useState({explotacio:"",nom:"",genere:"M",estado:"OK",alletar:"0"}),[w,g]=c.useState([]),[C,p]=c.useState([]),[E,b]=c.useState(!1),[h,k]=c.useState(!1),[j,u]=c.useState(null);c.useEffect(()=>{(async()=>{try{if(b(!0),x&&t){console.log(`Cargando datos para animal ID: ${t.id}`),m({explotacio:t.explotacio,nom:t.nom,genere:t.genere,estado:t.estado,alletar:t.alletar,pare:t.pare,mare:t.mare,quadra:t.quadra,cod:t.cod,num_serie:t.num_serie,dob:t.dob});try{const r=await n.getPotentialFathers(t?.explotacio),d=await n.getPotentialMothers(t?.explotacio);g(r),p(d)}catch(r){console.error("Error cargando padres/madres potenciales:",r),u("No se pudieron cargar los padres/madres potenciales. Se mostrarán datos simulados.")}}else if(l.length>0&&(m(r=>({...r,explotacio_id:l[0].id})),l[0].id))try{const[r,d]=await Promise.all([n.getPotentialFathers(l[0].id),n.getPotentialMothers(l[0].id)]);g(r),p(d)}catch(r){console.error("Error cargando padres/madres potenciales:",r),u("No se pudieron cargar los padres/madres potenciales. Se mostrarán datos simulados.")}}catch(r){u(r.message||"Error al cargar los datos"),console.error("Error cargando datos iniciales:",r)}finally{b(!1)}})()},[x,t,l]);const S=async a=>{try{b(!0),m(y=>({...y,explotacio_id:a,pare_id:void 0,mare_id:void 0}));const[r,d]=await Promise.all([n.getPotentialFathers(a),n.getPotentialMothers(a)]);g(r),p(d)}catch(r){u(r.message||"Error al cargar padres y madres"),console.error("Error cargando padres y madres:",r)}finally{b(!1)}},s=a=>{const{name:r,value:d,type:y}=a.target;if(y==="checkbox"){const i=a.target.checked;m(f=>({...f,[r]:i}));return}if(r==="explotacio_id"||r==="pare_id"||r==="mare_id"){const i=d===""?void 0:parseInt(d,10);r==="explotacio_id"&&i?S(i):m(f=>({...f,[r]:i}));return}m(i=>({...i,[r]:d}))},F=async a=>{a.preventDefault();try{k(!0),u(null),console.log("Enviando datos del formulario:",o),x&&t?(console.log(`Actualizando animal con ID: ${t.id}`),await n.updateAnimal(t.id,o),console.log("Animal actualizado correctamente")):(console.log("Creando nuevo animal"),await n.createAnimal(o),console.log("Animal creado correctamente")),v()}catch(r){u(r.message||"Error al guardar el animal"),console.error("Error guardando animal:",r)}finally{k(!1)}};return E?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-dark-text-secondary",children:"Cargando..."})]}):e.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-6 border border-gray-100 dark:border-dark-border",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-dark-text mb-4",children:x?"Editar Animal":"Nuevo Animal"}),j&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:j}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Explotación *"}),e.jsxs("select",{id:"explotacio",name:"explotacio",className:"form-select",value:o.explotacio,onChange:s,required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar explotación"}),l.map(a=>e.jsx("option",{value:a.explotacio,children:a.explotacio},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Nombre *"}),e.jsx("input",{type:"text",name:"nom",value:o.nom,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Género *"}),e.jsxs("select",{name:"genere",value:o.genere,onChange:s,required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text",children:[e.jsx("option",{value:"M",children:"Macho"}),e.jsx("option",{value:"F",children:"Hembra"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Estado *"}),e.jsxs("select",{id:"estado",name:"estado",className:"form-select",value:o.estado,onChange:s,required:!0,children:[e.jsx("option",{value:"OK",children:"Activo"}),e.jsx("option",{value:"DEF",children:"Baja"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Código"}),e.jsx("input",{type:"text",name:"cod",value:o.cod||"",onChange:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Número de serie"}),e.jsx("input",{type:"text",name:"num_serie",value:o.num_serie||"",onChange:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Fecha de nacimiento"}),e.jsx("input",{type:"date",name:"dob",value:o.dob||"",onChange:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Cuadra"}),e.jsx("input",{type:"text",name:"quadra",value:o.quadra||"",onChange:s,className:"w-full px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary dark:bg-gray-800 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Padre"}),e.jsxs("select",{id:"pare",name:"pare",className:"form-select",value:o.pare||"",onChange:s,children:[e.jsx("option",{value:"",children:"Sin padre"}),w.map(a=>e.jsx("option",{value:a.nom,children:a.nom},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Madre"}),e.jsxs("select",{id:"mare",name:"mare",className:"form-select",value:o.mare||"",onChange:s,children:[e.jsx("option",{value:"",children:"Sin madre"}),C.map(a=>e.jsx("option",{value:a.nom,children:a.nom},a.id))]})]})]}),o.genere==="F"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text-secondary mb-1",children:"Amamantando"}),e.jsxs("select",{id:"alletar",name:"alletar",className:"form-select",value:o.alletar,onChange:s,disabled:o.genere!=="F",children:[e.jsx("option",{value:"0",children:"No"}),e.jsx("option",{value:"1",children:"1 ternero"}),e.jsx("option",{value:"2",children:"2 terneros"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:N,disabled:h,className:"px-4 py-2 border border-gray-300 dark:border-dark-border rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-dark-text-secondary bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:h?"Guardando...":x?"Actualizar":"Crear"})]})]})]})};export{z as default};
