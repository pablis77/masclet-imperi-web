import{r as i,j as e}from"./vendor-react.DLP523nT.js";import{a as z}from"./api.BZ43VDWK.js";import{g as H,i as W}from"./authService.CvC7CJU-.js";import{getCurrentLanguage as T,t as g}from"./config.DUTcyYPh.js";import"./vendor-charts.C44Mn7ly.js";import"./vendor.CIJYp_OF.js";const q={async getUsers(t=1,n=10,h){try{const m=new URLSearchParams;m.append("page",t.toString()),m.append("limit",n.toString()),h&&m.append("search",h),console.log("Obteniendo usuarios, página:",t,"límite:",n);const s=localStorage.getItem("token");if(!s)return console.error("No hay token de autenticación disponible"),[];const x={headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}};console.log("Enviando solicitud con token:",s.substring(0,15)+"..."),console.log("URL de solicitud:",`/users?${m.toString()}`);try{console.log("Intentando obtener usuarios con fetch...");const c=await fetch(`${z.defaults.baseURL}/users?${m.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json",Accept:"application/json"}});if(c.ok){const r=await c.json();if(console.log("Datos obtenidos con fetch:",r),r&&r.items&&Array.isArray(r.items))return console.log("Devolviendo usuarios desde fetch:",r.items.length),r.items;if(Array.isArray(r))return console.log("Devolviendo array de usuarios desde fetch:",r.length),r}else console.warn("Error en la respuesta fetch:",c.status)}catch(c){console.error("Error al usar fetch:",c)}console.log("Usando axios como método alternativo...");const f=await z.get(`/users?${m.toString()}`,x);console.log("Respuesta completa de axios:",f);let a;if(f.data)a=f.data,console.log("Datos encontrados en response.data");else if(f.request&&f.request.response)try{a=JSON.parse(f.request.response),console.log("Datos encontrados en response.request.response")}catch{console.warn("Error al parsear response.request.response")}if(!a){console.warn("No se encontraron datos en la respuesta, intentando solicitud alternativa...");const c=await z.get("/users",x);if(c.data)a=c.data,console.log("Datos encontrados en solicitud alternativa");else if(c.request&&c.request.response)try{a=JSON.parse(c.request.response),console.log("Datos encontrados en alternativeResponse.request.response")}catch{console.warn("Error al parsear alternativeResponse.request.response")}}return a?a?(console.log("Datos a procesar:",a),a.items&&Array.isArray(a.items)?(console.log("Estructura detectada: { items: [...usuarios] }"),a.items):Array.isArray(a)?(console.log("La respuesta es un array directo de usuarios con",a.length,"elementos"),{items:a,total:a.length,page:t,limit:n,pages:Math.ceil(a.length/n)}):a):(console.warn("No se pudieron obtener datos de usuarios después de múltiples intentos"),[]):(console.warn("Intentando solicitud XMLHttpRequest como último recurso..."),new Promise(c=>{const r=new XMLHttpRequest;r.open("GET",`${z.defaults.baseURL}/users`),r.setRequestHeader("Authorization",`Bearer ${s}`),r.setRequestHeader("Content-Type","application/json"),r.responseType="json",r.onload=function(){r.status===200?(console.log("Respuesta XMLHttpRequest:",r.response),r.response&&r.response.items?c(r.response.items):Array.isArray(r.response)?c(r.response):c([])):(console.error("Error en XMLHttpRequest:",r.status),c([]))},r.onerror=function(){console.error("Error de red en XMLHttpRequest"),c([])},r.send()}))}catch(m){return console.error("Error al obtener usuarios:",m),[]}},async getUserById(t){try{return console.log("Obteniendo usuario con ID:",t),(await z.get(`/users/${t}`)).data}catch(n){throw console.error(`Error al obtener usuario con ID ${t}:`,n),n}},async createUser(t){try{console.log("Creando nuevo usuario:",t.username);const n={...t,role:t.role.toLowerCase()};console.log("Datos del usuario a crear:",JSON.stringify(n,null,2));const h=localStorage.getItem("token");if(!h)throw console.error("No hay token de autenticación disponible para crear usuario"),new Error("No hay token de autenticación disponible");const m={headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}},s=await z.post("/auth/signup",n,m);return console.log("Respuesta al crear usuario:",s.data),s.data}catch(n){throw console.error("Error al crear usuario:",n),n}},async updateUser(t,n){try{return console.log("Actualizando usuario con ID:",t),(await z.put(`/users/${t}`,n)).data}catch(h){throw console.error(`Error al actualizar usuario con ID ${t}:`,h),h}},async deleteUser(t){try{console.log("Eliminando usuario con ID:",t),await z.delete(`/users/${t}`)}catch(n){throw console.error(`Error al eliminar usuario con ID ${t}:`,n),n}}},V=({user:t,onSuccess:n,onCancel:h,availableRoles:m})=>{const[s,x]=i.useState({username:"",email:"",password:"",confirmPassword:"",role:"usuario"}),[f,a]=i.useState(!1),[c,r]=i.useState(null),[w,N]=i.useState(!1),[R,I]=i.useState(!1),[C,L]=i.useState(!1),y=H(),[A,D]=i.useState(y),[j,M]=i.useState(y?.role==="administrador");console.log("UserForm - Estado de usuario actual:",{currentUser:A,isAdmin:j,role:y?.role}),i.useEffect(()=>{t?(N(!0),x({username:t.username,email:t.email,password:"",confirmPassword:"",role:t.role}),console.log("UserForm - Usuario cargado para edición:",t),console.log("UserForm - Datos de formulario inicializados:",{username:t.username,email:t.email,role:t.role})):(N(!1),x({username:"",email:"",password:"",confirmPassword:"",role:"usuario"}))},[t]);const v=d=>{const{name:u,value:k}=d.target;let U=u;u.includes("_")&&(U=u.split("_")[0]);let F=U;U.includes("username")&&(F="username"),U.includes("email")&&(F="email"),U.includes("password")&&!U.includes("confirm")&&(F="password"),U.includes("confirmPassword")&&(F="confirmPassword"),x(_=>({..._,[F]:k}))},S=()=>s.username.trim()?s.email.trim()?!w&&!s.password?(r("La contraseña es obligatoria"),!1):!w&&s.password!==s.confirmPassword?(r("Las contraseñas no coinciden"),!1):!0:(r("El email es obligatorio"),!1):(r("El nombre de usuario es obligatorio"),!1),p=async d=>{if(d.preventDefault(),!!S()){a(!0),r(null);try{if(w&&t){const u={username:s.username,email:s.email,role:s.role};s.password&&j&&Object.assign(u,{password:s.password}),console.log("UserForm - Enviando datos para actualizar usuario:",u);const k=await q.updateUser(t.id,u);console.log("UserForm - Usuario actualizado correctamente:",k)}else{const u={username:s.username,email:s.email,password:s.password,role:s.role};console.log("UserForm - Enviando datos para crear usuario:",u);const k=await q.createUser(u);console.log("UserForm - Usuario creado correctamente:",k)}n()}catch(u){console.error("Error al guardar usuario:",u),u.response?r(u.response.data?.detail||"Error al guardar el usuario"):u.request?r("No se pudo conectar con el servidor"):r("Error al procesar la solicitud")}finally{a(!1)}}},l=Math.random().toString(36).substring(2,10);return e.jsxs("form",{className:"space-y-6",onSubmit:p,autoComplete:"off",spellCheck:"false",children:[e.jsxs("div",{style:{display:"none"},children:[e.jsx("input",{type:"text",name:"username_fake",autoComplete:"username"}),e.jsx("input",{type:"password",name:"password_fake",autoComplete:"current-password"})]}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:w?"Editar Usuario":"Crear Nuevo Usuario"}),c&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:c})})]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Nombre de usuario"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:`username_${l}`,id:"username",value:s.username,onChange:v,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"email",name:`email_${l}`,id:"email",value:s.email,onChange:v,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})})]}),(!w||j)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Contraseña"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:R?"text":"password",name:`password_${l}`,id:"password",value:s.password,onChange:v,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!w&&!j,autoComplete:"new-password",autoCorrect:"off",autoCapitalize:"off"}),j&&e.jsx("button",{type:"button",onClick:()=>I(!R),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5",children:R?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z",clipRule:"evenodd"}),e.jsx("path",{d:"M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),e.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]})})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirmar contraseña"}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:C?"text":"password",name:`confirmPassword_${l}`,id:"confirmPassword",value:s.confirmPassword,onChange:v,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",required:!w&&!j,autoComplete:"new-password",autoCorrect:"off",autoCapitalize:"off"}),j&&e.jsx("button",{type:"button",onClick:()=>L(!C),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5",children:C?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z",clipRule:"evenodd"}),e.jsx("path",{d:"M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),e.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]})})]})]}),e.jsxs("div",{className:"sm:col-span-3",children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Rol"}),e.jsx("div",{className:"mt-1",children:e.jsx("select",{id:"role",name:"role",value:s.role,onChange:v,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:m?m.map(d=>{let u=d;return d==="Ramon"?u="Gerente (Ramon)":d==="administrador"?u="Administrador":d==="editor"?u="Editor":d==="usuario"&&(u="Usuario"),e.jsx("option",{value:d,children:u},d)}):y?.role==="administrador"?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"administrador",children:"Administrador"}),e.jsx("option",{value:"Ramon",children:"Gerente (Ramon)"}),e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"usuario",children:"Usuario"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"editor",children:"Editor"}),e.jsx("option",{value:"usuario",children:"Usuario"})]})})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-5",children:[e.jsx("button",{type:"button",onClick:h,className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:f,className:"inline-flex justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:f?"Guardando...":w?"Actualizar":"Crear"})]})]})},K=({isOpen:t,title:n,message:h,confirmText:m,cancelText:s,onConfirm:x,onCancel:f,type:a="danger"})=>{if(!t)return null;const r=(()=>{switch(a){case"danger":return{icon:e.jsx("svg",{className:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmButton:"bg-red-600 hover:bg-red-700 focus:ring-red-500",iconBackground:"bg-red-100"};case"warning":return{icon:e.jsx("svg",{className:"h-6 w-6 text-yellow-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),confirmButton:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500",iconBackground:"bg-yellow-100"};case"info":default:return{icon:e.jsx("svg",{className:"h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),confirmButton:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500",iconBackground:"bg-blue-100"}}})();return e.jsx("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:`mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${r.iconBackground} sm:mx-0 sm:h-10 sm:w-10`,children:r.icon}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:n}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:h})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",className:`inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm ${r.confirmButton}`,onClick:x,children:m}),e.jsx("button",{type:"button",className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:f,children:s})]})]})]})})},Q=({currentPage:t,totalPages:n,onPageChange:h})=>{if(n<=1)return null;const s=(()=>{const x=[];if(n<=5)for(let a=1;a<=n;a++)x.push(a);else if(t<=3)for(let a=1;a<=5;a++)x.push(a);else if(t>=n-2)for(let a=n-4;a<=n;a++)x.push(a);else for(let a=t-2;a<=t+2;a++)x.push(a);return x})();return e.jsx("nav",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6",children:e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando página ",e.jsx("span",{className:"font-medium",children:t})," de"," ",e.jsx("span",{className:"font-medium",children:n})]})}),e.jsx("div",{children:e.jsxs("ul",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>h(t-1),disabled:t===1,className:`relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${t===1?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("span",{className:"sr-only",children:"Anterior"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]})}),s.map(x=>e.jsx("li",{children:e.jsx("button",{onClick:()=>h(x),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${x===t?"z-10 bg-blue-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:x})},x)),e.jsx("li",{children:e.jsxs("button",{onClick:()=>h(t+1),disabled:t===n,className:`relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 ${t===n?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("span",{className:"sr-only",children:"Siguiente"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})})]})})]})})};let P=typeof window>"u";const Y=({onEdit:t,onRefresh:n,forceLang:h})=>{const m=P?"es":h||T(),[s,x]=i.useState(m),[f,a]=i.useState([]),[c,r]=i.useState(!0),[w,N]=i.useState(null),[R,I]=i.useState(null),[C,L]=i.useState(null),[y,A]=i.useState(!1),[D,j]=i.useState(1),[M,v]=i.useState(1),[S,p]=i.useState(10),[l,d]=i.useState(0);i.useEffect(()=>{u();const o=H();o&&I(o),P&&(P=!1,setTimeout(()=>{x(T())},50))},[D,S,n]);const u=async()=>{r(!0);try{console.log("Solicitando usuarios: página",D,"tamaño",S);const o=await q.getUsers(D,S);console.log("Respuesta del servidor (tipo):",typeof o),console.log("Respuesta del servidor (valor):",o);let b=[],$=1,B=0;if(Array.isArray(o))console.log("Formato detectado: Array directo de usuarios"),b=[...o],$=1,B=o.length;else if(o&&typeof o=="object")if(o.items&&Array.isArray(o.items))console.log("Formato detectado: Objeto con items[]"),b=[...o.items],$=o.pages||1,B=o.total||o.items.length;else{const E=o,O=E.users||E.data||E.results;Array.isArray(O)&&O.length>0&&(console.log("Formato alternativo detectado con usuarios"),b=[...O]),$=E.pages||E.totalPages||1,B=E.total||E.totalItems||E.count||b.length}console.log("Usuarios encontrados:",b.length),a(b),v($),d(B),N(null)}catch(o){console.error("Error al cargar usuarios:",o),N(g("users.table.error",s))}finally{r(!1)}},k=o=>{j(o)},U=o=>{const b=parseInt(o.target.value);p(b),j(1)},F=o=>{L(o),A(!0)},_=async()=>{if(C)try{await q.deleteUser(C.id),A(!1),L(null),u(),n()}catch(o){console.error("Error al eliminar usuario:",o),N(g("users.table.delete_error",s)),A(!1)}},J=()=>{A(!1),L(null)},X=o=>{let b="";switch(o){case"administrador":b="bg-red-100 text-red-800";break;case"gerente":b="bg-blue-100 text-blue-800";break;case"editor":b="bg-green-100 text-green-800";break;default:b="bg-gray-100 text-gray-800"}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b}`,children:o})};return c&&f.length===0?e.jsx("div",{className:"text-center py-4",children:g("users.table.loading",s)}):w&&f.length===0?e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 my-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:w})})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:[g("users.table.showing",s)," ",f.length," ",g("users.table.of",s)," ",l," ",g("users.table.users",s)]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"pageSize",className:"mr-2 text-sm text-gray-700",children:g("users.table.show",s)}),e.jsxs("select",{id:"pageSize",value:S,onChange:U,className:"rounded border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"25",children:"25"}),e.jsx("option",{value:"50",children:"50"})]})]})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g("users.table.user",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g("users.table.email",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g("users.table.role",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g("users.table.status",s)}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:g("users.table.actions",s)})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500",children:g("users.table.no_users",s)})}):f.map(o=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.username}),e.jsx("div",{className:"text-sm text-gray-500",children:o.full_name})]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:o.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:X(o.role)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:o.is_active?g("users.table.active",s):g("users.table.inactive",s)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>t(o),className:"text-indigo-600 hover:text-indigo-900 focus:outline-none",children:g("users.table.edit",s)}),R?.id!==o.id&&o.role!=="Ramon"&&(o.role!=="administrador"||R?.role==="administrador")&&e.jsx("button",{onClick:()=>F(o),className:"text-red-600 hover:text-red-900 focus:outline-none",children:g("users.table.delete",s)})]})]},o.id))})]})]}),M>1&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(Q,{currentPage:D,totalPages:M,onPageChange:k})}),e.jsx(K,{isOpen:y,title:g("users.table.confirm_delete_title",s),message:g("users.table.confirm_delete_message",s).replace("{username}",C?.username||""),confirmText:g("users.table.confirm",s),cancelText:g("users.table.cancel",s),onConfirm:_,onCancel:J})]})};let G=typeof window>"u";const ae=()=>{const[t,n]=i.useState(!1),[h,m]=i.useState(void 0),[s,x]=i.useState(null),[f,a]=i.useState(!1),[c,r]=i.useState(0),w=G?"es":T(),[N,R]=i.useState(w),[I,C]=i.useState("Cargando..."),[L,y]=i.useState({});i.useEffect(()=>{G&&typeof window<"u"&&(G=!1,setTimeout(()=>{const p=T();R(p)},100))},[]),i.useEffect(()=>{const p=W();if(C(p?"Autenticado":"No autenticado"),!p){y(d=>({...d,isAuthenticated:!1}));return}let l=H();if(p&&!l&&(console.log("Autenticado pero sin datos de usuario, recreando usuario administrador"),localStorage.getItem("token")&&(l={id:1,username:"admin",email:"admin@mascletimperi.com",full_name:"Administrador",role:"administrador",is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},localStorage.setItem("user",JSON.stringify(l)))),y(d=>({...d,user:l?JSON.stringify(l):"null"})),l){x(l);let d=!1;l.username==="admin"?(d=!0,l.role!=="administrador"&&(console.log("Corrigiendo el rol del usuario admin de:",l.role,"a: administrador"),l.role="administrador",localStorage.setItem("user",JSON.stringify(l)))):d=l.role==="administrador"||l.role==="Ramon"||l.role==="gerente",a(d);const u={role:l.role,hasAdminRole:d,username:l.username,isAdmin:d,tokenExists:!!localStorage.getItem("token"),tokenFirstChars:localStorage.getItem("token")?.substring(0,15)+"..."||"no-token"};console.log("Información de depuración del usuario:",u),y(k=>({...k,...u}))}else y(d=>({...d,userFound:!1}))},[]);const A=()=>{m(void 0),n(!0)},D=p=>{m(p),n(!0)},j=()=>{n(!1),m(void 0),r(p=>p+1)},M=()=>{n(!1),m(void 0)},v=(p,l)=>N==="ca"&&{"Gestión de Usuarios":"Gestió d'Usuaris","Añadir Usuario":"Afegir Usuari","Nuevo Usuario":"Nou Usuari",Cargando:"Carregant"}[p]||l,S=()=>e.jsxs("div",{className:"bg-white border border-gray-300 p-4 mb-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Panel de Diagnóstico"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Estado de Autenticación:"})," ",I]}),e.jsxs("div",{children:[e.jsx("strong",{children:"¿Es administrador?:"})," ",f?"Sí":"No"]}),Object.entries(L).map(([p,l])=>e.jsxs("div",{children:[e.jsxs("strong",{children:[p,":"]})," ",typeof l=="object"?JSON.stringify(l):String(l)]},p))]})]});return!f&&s?e.jsxs(e.Fragment,{children:[S(),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 my-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-yellow-700",children:"No tienes permisos para gestionar usuarios. Solo los administradores y usuarios con rol Ramon pueden acceder a esta sección."})})]})})]}):e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[S(),t?e.jsx(V,{user:h,onSuccess:j,onCancel:M,availableRoles:f?["administrador","Ramon","editor","usuario"]:["editor","usuario"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:v("Gestión de Usuarios","Gestión de Usuarios")}),f&&e.jsx("button",{onClick:A,className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded shadow focus:outline-none focus:shadow-outline transition duration-150 ease-in-out",children:v("Añadir Usuario","Añadir Usuario")})]}),e.jsx(Y,{onEdit:D,onRefresh:()=>r(p=>p+1),forceLang:N},c)]})]})};export{ae as UsersManagement};
