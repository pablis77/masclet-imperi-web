import{g as q,a as N}from"./listados-service.COETWV30.js";import"./config.DUTcyYPh.js";import"./hoisted.BvqcoGvE.js";import"./LanguageSwitcher.astro_astro_type_script_index_0_lang.BEmjKfY9.js";import"./apiService.CS3_UAep.js";import"./vendor.CwhrWGr6.js";function w(){try{localStorage.setItem("userLanguage","ca"),console.log("Listado Edit: Forzando idioma catalán en toda la página")}catch(c){console.error("Error al forzar idioma:",c)}}function y(){try{let c=function(a){if(a.nodeType===3){let t=a.nodeValue.trim();if(t)for(const[r,d]of Object.entries(n))t.includes(r)&&(a.nodeValue=a.nodeValue.replace(r,d),console.log(`Traducido: '${r}' -> '${d}'`))}else for(let t=0;t<a.childNodes.length;t++)c(a.childNodes[t])};console.log("Aplicando traducción directa a todos los textos estáticos en la página de edición");const n={"Guardar Cambios":"Guardar Canvis",Cancelar:"Cancel·lar","Deseleccionar todos":"Deseleccionar tots","Seleccionar todos":"Seleccionar tots","Nombre del listado":"Nom del llistat",Categoría:"Categoria",Descripción:"Descripció","Seleccionar categoría":"Seleccionar categoria",Vacunación:"Vacunació",Tratamiento:"Tractament",Transporte:"Transport",Venta:"Venda",Otro:"Altre","Selección de Animales":"Selecció d'Animals","Buscar animales...":"Cercar animals...","Seleccionados:":"Seleccionats:","No hay animales disponibles":"No hi ha animals disponibles","Este campo es obligatorio":"Aquest camp és obligatori","Guardando...":"Guardant...","Listado Actualizado":"Llistat Actualitzat","El listado ha sido actualizado correctamente":"El llistat ha estat actualitzat correctament","Error al actualizar el listado":"Error al actualitzar el llistat","Por favor, intenta nuevamente":"Si us plau, torna-ho a intentar","Cargando datos del listado...":"Carregant dades del llistat..."};[{selector:"#animal-filter",atributo:"placeholder",es:"Buscar animales...",ca:"Cercar animals..."},{selector:"#listado-name",atributo:"placeholder",es:"Ej: Vacunación octubre 2025",ca:"Ex: Vacunació octubre 2025"},{selector:"#listado-description",atributo:"placeholder",es:"Ej: Animales para vacunación del 15 de octubre",ca:"Ex: Animals per a vacunació del 15 d'octubre"}].forEach(a=>{const t=document.querySelector(a.selector);t&&t.getAttribute(a.atributo)===a.es&&(t.setAttribute(a.atributo,a.ca),console.log(`Traducido atributo ${a.atributo} de '${a.es}' a '${a.ca}'`))}),c(document.body),document.title=document.title.replace("Editar Listado","Editar Llistat"),console.log("Traducción directa completada")}catch(c){console.error("Error en traducción directa:",c)}}function V(){try{w();const c="ca";console.log("Listado Edit: Actualizando traducciones al idioma:",c);const n=document.getElementById("page-title");n&&(n.textContent=c==="ca"?"Editar Llistat":"Editar Listado");const l={ca:{titulo:"Editar Llistat",descripcion:"Modifica els detalls del llistat i els animals inclosos.",nombreLabel:"Nom del llistat",nombrePlaceholder:"Ex: Vacunació octubre 2025",descripcionLabel:"Descripció",descripcionPlaceholder:"Ex: Animals per a vacunació del 15 d'octubre",categoriaLabel:"Categoria",categoriaPlaceholder:"Seleccionar categoria",categoriaVacunacion:"Vacunació",categoriaTratamiento:"Tractament",categoriaTransporte:"Transport",categoriaVenta:"Venda",categoriaOtro:"Altre",animalesLabel:"Selecció d'Animals",buscarAnimales:"Cercar animals...",noAnimales:"No hi ha animals disponibles.",seleccionados:"Seleccionats:",seleccionarTodos:"Seleccionar tots",deseleccionarTodos:"Deseleccionar tots",guardar:"Guardar Canvis",guardando:"Guardant...",cancelar:"Cancel·lar",exito:"Llistat Actualitzat",mensajeExito:"El llistat ha estat actualitzat correctament.",error:"Error al actualitzar el llistat.",requerido:"Aquest camp és obligatori.",volver:"Tornar a Llistats",cargando:"Carregant dades del llistat..."},es:{titulo:"Editar Listado",descripcion:"Modifica los detalles del listado y los animales incluidos.",nombreLabel:"Nombre del listado",nombrePlaceholder:"Ej: Vacunación octubre 2025",descripcionLabel:"Descripción",descripcionPlaceholder:"Ej: Animales para vacunación del 15 de octubre",categoriaLabel:"Categoría",categoriaPlaceholder:"Seleccionar categoría",categoriaVacunacion:"Vacunación",categoriaTratamiento:"Tratamiento",categoriaTransporte:"Transporte",categoriaVenta:"Venta",categoriaOtro:"Otro",animalesLabel:"Selección de Animales",buscarAnimales:"Buscar animales...",noAnimales:"No hay animales disponibles.",seleccionados:"Seleccionados:",seleccionarTodos:"Seleccionar todos",deseleccionarTodos:"Deseleccionar todos",guardar:"Guardar Cambios",guardando:"Guardando...",cancelar:"Cancelar",exito:"Listado Actualizado",mensajeExito:"El listado ha sido actualizado correctamente.",error:"Error al actualizar el listado.",requerido:"Este campo es obligatorio.",volver:"Volver a Listados",cargando:"Cargando datos del listado..."}},a=[{selector:"h1",key:"titulo"},{selector:"h1 + p",key:"descripcion"},{selector:'label[for="nombre"]',key:"nombreLabel"},{selector:"input#nombre",key:"nombrePlaceholder",attr:"placeholder"},{selector:'label[for="descripcion"]',key:"descripcionLabel"},{selector:"textarea#descripcion",key:"descripcionPlaceholder",attr:"placeholder"},{selector:'label[for="categoria"]',key:"categoriaLabel"},{selector:'select#categoria option[value=""]',key:"categoriaPlaceholder"},{selector:'select#categoria option[value="vacunacion"]',key:"categoriaVacunacion"},{selector:'select#categoria option[value="tratamiento"]',key:"categoriaTratamiento"},{selector:'select#categoria option[value="transporte"]',key:"categoriaTransporte"},{selector:'select#categoria option[value="venta"]',key:"categoriaVenta"},{selector:'select#categoria option[value="otro"]',key:"categoriaOtro"},{selector:"h3",key:"animalesLabel"},{selector:"input#search-animals",key:"buscarAnimales",attr:"placeholder"},{selector:"#no-animals",key:"noAnimales"},{selector:"#selected-count",key:"seleccionados",prefix:!0},{selector:"#select-all",key:"seleccionarTodos"},{selector:"#deselect-all",key:"deseleccionarTodos"},{selector:'button[type="submit"] span',key:"guardar"},{selector:"#cancel-btn",key:"cancelar"},{selector:"#success-message .font-medium",key:"exito"},{selector:"#success-message p",key:"mensajeExito"},{selector:"#error-message p",key:"error"},{selector:".validation-error",key:"requerido"},{selector:"#back-btn",key:"volver"},{selector:"#loading-message p",key:"cargando"}],t=c==="ca"?l.ca:l.es;a.forEach(r=>{document.querySelectorAll(r.selector).forEach(s=>{if(r.attr)s.setAttribute(r.attr,t[r.key]);else if(r.prefix){const u=s.textContent.replace(/[^0-9]/g,"");s.textContent=t[r.key]+" "+u}else s.textContent=t[r.key]})}),console.log("Traducciones actualizadas correctamente")}catch(c){console.error("Error al actualizar traducciones:",c)}}document.addEventListener("DOMContentLoaded",()=>{w(),V(),setTimeout(()=>{y()},500),setTimeout(()=>{y()},1e3),document.body.addEventListener("click",()=>{setTimeout(y,100)}),window.addEventListener("storage",function(c){c.key==="userLanguage"&&(V(),setTimeout(y,200))})});document.addEventListener("DOMContentLoaded",async()=>{const c=window.location.pathname.split("/"),n=c[c.length-1],l=document.getElementById("listado-form"),a=document.getElementById("listado-name"),t=document.getElementById("listado-category"),r=document.getElementById("listado-description"),d=document.getElementById("loading-message"),s=document.getElementById("loading-animals"),u=document.getElementById("no-animals"),p=document.getElementById("animals-list"),x=document.getElementById("animals-container"),E=document.getElementById("animal-filter"),z=document.getElementById("selected-count"),A=document.getElementById("select-all"),T=document.getElementById("unselect-all"),C=document.getElementById("save-button"),S=document.getElementById("saving-button"),f=document.getElementById("success-message"),L=document.getElementById("error-message"),B=document.getElementById("name-error");document.getElementById("category-error");const I=document.getElementById("animals-error");let v=[],m=null,g=[];const h=()=>{const e=document.querySelectorAll(".animal-checkbox:checked");z.textContent=e.length,g=Array.from(e).map(o=>parseInt(o.value))},P=()=>{const e=E.value.toLowerCase();document.querySelectorAll(".animal-item").forEach(i=>{const k=i.dataset.name?.toLowerCase()||"",b=i.dataset.explotacion?.toLowerCase()||"";k.includes(e)||b.includes(e)?i.classList.remove("hidden"):i.classList.add("hidden")})};try{if(m=await q(n),m)a&&(a.value=m.nombre||""),t&&(t.value=m.categoria||""),r&&(r.value=m.descripcion||""),g=m.animales?.map(e=>e.id)||[],await $(),d&&d.classList.add("hidden"),l&&l.classList.remove("hidden");else throw new Error("No se pudo cargar el listado")}catch(e){console.error("Error al cargar el listado:",e),d&&(d.innerHTML='<p class="text-red-500">Error al cargar el listado. Por favor, intenta nuevamente.</p>')}async function $(){if(!(!x||!s||!u||!p))try{s.classList.remove("hidden"),u.classList.add("hidden"),p.classList.add("hidden"),v=await N(),v.length===0?(s.classList.add("hidden"),u.classList.remove("hidden")):(s.classList.add("hidden"),p.classList.remove("hidden"),x.classList.remove("hidden"),v.forEach(e=>{const o=document.createElement("div");if(o.className="animal-item flex items-center px-4 py-2 hover:bg-gray-50",o.dataset.name=e.nom||"",o.dataset.explotacion=e.explotacio||"",e.estado==="OK"){const i=g.includes(e.id);o.innerHTML=`
                <input 
                  type="checkbox" 
                  id="animal-${e.id}" 
                  name="animals" 
                  value="${e.id}" 
                  class="animal-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
                  ${i?"checked":""}
                >
                <label for="animal-${e.id}" class="ml-3 flex-1 cursor-pointer">
                  <div class="font-medium text-gray-800">${e.nom||""}</div>
                  <div class="text-sm text-gray-500">
                    ${e.explotacio||""} · 
                    ${e.genere==="M"?"Toro":"Vaca"}
                    ${e.genere==="F"&&e.alletar?` · Alletar: ${e.alletar}`:""}
                  </div>
                </label>
              `,p.appendChild(o),o.querySelector(".animal-checkbox").addEventListener("change",h)}}),h())}catch(e){console.error("Error al cargar animales:",e),s.classList.add("hidden"),u.classList.remove("hidden"),u.innerHTML='<p class="text-red-500">Error al cargar los animales. Por favor, intenta nuevamente.</p>'}}A&&A.addEventListener("click",()=>{document.querySelectorAll(".animal-checkbox:not(:checked)").forEach(o=>{o.closest(".animal-item").classList.contains("hidden")||(o.checked=!0)}),h()}),T&&T.addEventListener("click",()=>{document.querySelectorAll(".animal-checkbox:checked").forEach(o=>{o.checked=!1}),h()}),E&&E.addEventListener("input",P),l&&l.addEventListener("submit",async e=>{e.preventDefault();let o=!0;if(a.value.trim()?B.classList.add("hidden"):(B.classList.remove("hidden"),o=!1),g.length===0?(I.classList.remove("hidden"),o=!1):I.classList.add("hidden"),!!o){C.classList.add("hidden"),S.classList.remove("hidden"),f.classList.add("hidden"),L.classList.add("hidden");try{const i={id:parseInt(n),nombre:a.value.trim(),categoria:t.value,descripcion:r.value.trim(),animales:g},k=await(void 0)(n,i);f.classList.remove("hidden"),l.querySelectorAll("input, select, textarea, button").forEach(b=>{b.type!=="submit"&&(b.disabled=!0)}),f.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{window.location.href="/listados"},1500)}catch(i){console.error("Error al actualizar listado:",i),L.classList.remove("hidden"),C.classList.remove("hidden"),S.classList.add("hidden"),L.scrollIntoView({behavior:"smooth",block:"center"})}}})});
