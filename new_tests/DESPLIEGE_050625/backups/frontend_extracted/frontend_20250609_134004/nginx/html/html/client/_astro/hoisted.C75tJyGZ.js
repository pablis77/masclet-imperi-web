import{a as C,c as S}from"./listados-service.COETWV30.js";import"./hoisted.BvqcoGvE.js";import"./LanguageSwitcher.astro_astro_type_script_index_0_lang.BEmjKfY9.js";import"./apiService.CS3_UAep.js";import"./vendor.CwhrWGr6.js";document.addEventListener("DOMContentLoaded",async()=>{const i=document.getElementById("listado-form"),m=document.getElementById("listado-name"),u=document.getElementById("listado-category"),b=document.getElementById("listado-description"),n=document.getElementById("loading-animals"),o=document.getElementById("no-animals"),h=document.getElementById("animals-list"),I=document.getElementById("animals-container"),g=document.getElementById("animal-filter"),k=document.getElementById("selected-count"),B=document.getElementById("select-all"),A=document.getElementById("unselect-all"),y=document.getElementById("save-button"),v=document.getElementById("saving-button"),d=document.getElementById("success-message"),l=document.getElementById("error-message"),L=document.getElementById("name-error"),E=document.getElementById("category-error"),f=document.getElementById("animals-error");let r=[];const c=()=>{const e=document.querySelectorAll(".animal-checkbox:checked");k.textContent=e.length},w=()=>{const e=g.value.toLowerCase();document.querySelectorAll(".animal-item").forEach(s=>{const a=s.dataset.name.toLowerCase(),p=s.dataset.explotacion.toLowerCase();a.includes(e)||p.includes(e)?s.classList.remove("hidden"):s.classList.add("hidden")})};try{n.classList.remove("hidden"),o.classList.add("hidden"),h.classList.add("hidden"),r=await C(),r.length===0?(n.classList.add("hidden"),o.classList.remove("hidden")):(n.classList.add("hidden"),h.classList.remove("hidden"),r.forEach(e=>{const t=document.createElement("div");t.className="animal-item flex items-center px-4 py-2 hover:bg-gray-50",t.dataset.name=e.nom||"",t.dataset.explotacion=e.explotacio||"",e.estado==="OK"&&(t.innerHTML=`
              <input 
                type="checkbox" 
                id="animal-${e.id}" 
                name="animals" 
                value="${e.id}" 
                class="animal-checkbox h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
              >
              <label for="animal-${e.id}" class="ml-3 flex-1 cursor-pointer">
                <div class="font-medium text-gray-800">${e.nom||""}</div>
                <div class="text-sm text-gray-500">
                  ${e.explotacio||""} · 
                  ${e.genere==="M"?"Toro":"Vaca"}
                  ${e.genere==="F"&&e.alletar?` · Alletar: ${e.alletar}`:""}
                </div>
              </label>
            `,I.appendChild(t),t.querySelector(".animal-checkbox").addEventListener("change",c))}),c())}catch(e){console.error("Error al cargar animales:",e),n.classList.add("hidden"),o.classList.remove("hidden"),o.querySelector("p").textContent="Error al cargar los animales. Por favor, recarga la página."}g.addEventListener("input",w),B.addEventListener("click",()=>{document.querySelectorAll(".animal-checkbox:not(:checked)").forEach(t=>{t.closest(".animal-item").classList.contains("hidden")||(t.checked=!0)}),c()}),A.addEventListener("click",()=>{document.querySelectorAll(".animal-checkbox:checked").forEach(t=>t.checked=!1),c()}),i.addEventListener("submit",async e=>{e.preventDefault(),L.classList.add("hidden"),E.classList.add("hidden"),f.classList.add("hidden");let t=!0;m.value.trim()||(L.classList.remove("hidden"),t=!1),u.value||(E.classList.remove("hidden"),t=!1);const s=Array.from(document.querySelectorAll(".animal-checkbox:checked")).map(a=>parseInt(a.value));if(s.length===0&&(f.classList.remove("hidden"),t=!1),!!t){y.classList.add("hidden"),v.classList.remove("hidden"),d.classList.add("hidden"),l.classList.add("hidden");try{const a={name:m.value.trim(),category:u.value,description:b.value.trim(),animals:s},p=await S(a);d.classList.remove("hidden"),i.querySelectorAll("input, select, textarea, button").forEach(x=>{x.type!=="submit"&&(x.disabled=!0)}),d.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{window.location.href="/listados"},1500)}catch(a){console.error("Error al crear listado:",a),l.classList.remove("hidden"),y.classList.remove("hidden"),v.classList.add("hidden"),l.scrollIntoView({behavior:"smooth",block:"center"})}}})});
