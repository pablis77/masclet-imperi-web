# ğŸ—ºï¸ MAPA DE DEPENDENCIAS INTERNO - MASCLET IMPERI WEB

## 1. MÃ³dulos Clave del Frontend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ARQUITECTURA FRONTEND                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚     â”‚                   â”‚    â”‚                    â”‚
â”‚    PÃGINAS      â”‚â”€â”€â”€â”€â–¶â”‚  COMPONENTES UI   â”‚â”€â”€â”€â–¶â”‚  STORE DE ESTADO   â”‚
â”‚   (ASTRO/REACT) â”‚     â”‚   (REACT/TREMOR)  â”‚    â”‚    (NANOSTORES)    â”‚
â”‚                 â”‚     â”‚                   â”‚    â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                         â”‚
         â”‚                        â”‚                         â”‚
         â”‚                        â–¼                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                 â”‚     â”‚                     â”‚            â”‚
â”‚   SERVICIOS     â”‚â”€â”€â”€â”€â–¶â”‚      UTILIDADES     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚     (AXIOS)     â”‚     â”‚  (FORMATEO, CÃLCULO)â”‚
â”‚                 â”‚     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.1 MÃ³dulos y Responsabilidades

| MÃ³dulo | UbicaciÃ³n | Responsabilidades | Dependencias |
|--------|-----------|-------------------|--------------|
| **PÃ¡ginas** | `/frontend/src/pages` | DefiniciÃ³n de rutas, layouts y contenedores de componentes | Astro, React, Componentes UI |
| **Componentes UI** | `/frontend/src/components` | Interfaces de usuario reutilizables | React, Tremor, TailwindCSS |
| **Store de Estado** | `/frontend/src/stores` | GestiÃ³n del estado global de la aplicaciÃ³n | Nanostores |
| **Servicios** | `/frontend/src/services` | ComunicaciÃ³n con el backend y APIs externas | Axios |
| **Utilidades** | `/frontend/src/utils` | Funciones auxiliares para formateo, cÃ¡lculos y transformaciones | - |
| **Assets** | `/frontend/public` | Recursos estÃ¡ticos (imÃ¡genes, fuentes, etc.) | - |
| **GeneraciÃ³n PDF** | `/frontend/src/pdf` | GeneraciÃ³n de informes y documentos PDF | jspdf, jspdf-autotable |

### 1.2 Principales Componentes y su FunciÃ³n

#### Core UI
- **Layout.astro**: Estructura base de todas las pÃ¡ginas
- **Navbar.jsx**: Barra de navegaciÃ³n superior
- **Sidebar.jsx**: MenÃº lateral de navegaciÃ³n
- **Modal.jsx**: Componente modal reutilizable
- **Table.jsx**: Tabla de datos interactiva

#### PÃ¡ginas Principales
- **Dashboard.astro**: Panel principal de control
- **Animals.astro**: GestiÃ³n de animales
- **Explotacions.astro**: GestiÃ³n de explotaciones
- **Parts.astro**: Registro de partos
- **Users.astro**: AdministraciÃ³n de usuarios
- **Reports.astro**: GeneraciÃ³n de informes

#### Servicios API
- **api.js**: Cliente Axios configurado
- **authService.js**: GestiÃ³n de autenticaciÃ³n
- **animalService.js**: CRUD para animales
- **explotacioService.js**: CRUD para explotaciones
- **partService.js**: CRUD para partos
- **userService.js**: CRUD para usuarios

## 2. Servicios del Backend y sus Interacciones

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ARQUITECTURA BACKEND                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚    â”‚                â”‚    â”‚                    â”‚
â”‚    ENDPOINTS    â”‚â”€â”€â”€â–¶â”‚   SERVICIOS    â”‚â”€â”€â”€â–¶â”‚      MODELOS       â”‚
â”‚    (FASTAPI)    â”‚    â”‚  (LÃ“GICA BIZ)  â”‚    â”‚    (SQLALCHEMY)    â”‚
â”‚                 â”‚    â”‚                â”‚    â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                       â”‚
         â”‚                      â”‚                       â”‚
         â”‚                      â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                 â”‚    â”‚                â”‚               â”‚
â”‚  AUTENTICACIÃ“N  â”‚    â”‚   UTILIDADES   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚     (JWT)       â”‚    â”‚ (VALIDACIÃ“N)   â”‚
â”‚                 â”‚    â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1 Servicios y Responsabilidades

| Servicio | UbicaciÃ³n | Responsabilidades | Dependencias |
|----------|-----------|-------------------|--------------|
| **FastAPI App** | `/backend/app/main.py` | Punto de entrada, configuraciÃ³n de middleware | FastAPI, Middleware |
| **Endpoints** | `/backend/app/api/endpoints` | DefiniciÃ³n de rutas HTTP y validaciones | FastAPI, Pydantic, Servicios |
| **Servicios** | `/backend/app/services` | LÃ³gica de negocio | SQLAlchemy, Modelos |
| **Modelos** | `/backend/app/models` | DefiniciÃ³n de entidades y relaciones | SQLAlchemy, Pydantic |
| **Auth** | `/backend/app/auth` | AutenticaciÃ³n y autorizaciÃ³n | JWT, FastAPI Security |
| **Schemas** | `/backend/app/schemas` | ValidaciÃ³n de datos y serializaciÃ³n | Pydantic |
| **Core** | `/backend/app/core` | ConfiguraciÃ³n central | - |
| **Backups** | `/backend/app/backup_routes` | GestiÃ³n de copias de seguridad | - |

### 2.2 Principales Endpoints y sus Dependencias

#### AutenticaciÃ³n
- `/api/v1/auth/login`: Servicio de autenticaciÃ³n, UserModel
- `/api/v1/auth/me`: Servicio de autenticaciÃ³n, UserModel

#### GestiÃ³n de Animales
- `/api/v1/animals`: AnimalService, AnimalModel, ExplotacioModel
- `/api/v1/animals/{id}`: AnimalService, AnimalModel, PartModel
- `/api/v1/animals/import`: AnimalService, ImportService

#### GestiÃ³n de Explotaciones
- `/api/v1/explotacions`: ExplotacioService, ExplotacioModel
- `/api/v1/explotacions/{id}`: ExplotacioService, ExplotacioModel, AnimalModel

#### GestiÃ³n de Partos
- `/api/v1/parts`: PartService, PartModel, AnimalModel
- `/api/v1/parts/{id}`: PartService, PartModel

#### Usuarios y Permisos
- `/api/v1/users`: UserService, UserModel, RoleModel
- `/api/v1/users/{id}/role`: UserService, RoleService

#### Sistema de Backups
- `/api/v1/scheduled-backup/history`: BackupService
- `/api/v1/scheduled-backup/trigger`: BackupService

## 3. Puntos de IntegraciÃ³n entre Sistemas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   INTEGRACIÃ“N ENTRE SISTEMAS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                      â”‚                     â”‚
â”‚    FRONTEND SSR     â”‚â—„â”€â”€â”€â”€â”€â”€ HTTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  NAVEGADOR CLIENTE  â”‚
â”‚    (NODE ALPINE)    â”‚                      â”‚                     â”‚
â”‚                     â”‚                      â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP/REST API
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚     â”‚                         â”‚
â”‚   BACKEND FASTAPI   â”‚â—„â”€â”€â”€â”€â”¤  SERVICIOS EXTERNOS     â”‚
â”‚                     â”‚     â”‚  (AWS, EMAIL, ETC)      â”‚
â”‚                     â”‚     â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ SQL/ORM
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚     POSTGRESQL      â”‚
â”‚                     â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.1 Interfaces de ComunicaciÃ³n

| Interfaz | Tipo | Origen | Destino | Protocolo | AutenticaciÃ³n |
|----------|------|--------|---------|-----------|---------------|
| **Frontend â†” Backend** | REST API | Frontend (Axios) | Backend (FastAPI) | HTTP/HTTPS | JWT |
| **SSR Renders** | Server-Side | Node.js Alpine | Cliente | HTTP | Cookies de sesiÃ³n |
| **Backend â†” DB** | ORM | SQLAlchemy | PostgreSQL | SQL | Credenciales DB |
| **Backend â†” Servicios** | API | Backend | AWS S3, SMTP, etc. | HTTP/HTTPS | API Keys/IAM |
| **Nginx â†” Node.js** | Proxy | Nginx | Node.js | HTTP | - |
| **Backups DB** | Interno | Backend | Sistema de archivos | SQL Dump | - |

### 3.2 Flujos de Datos CrÃ­ticos

#### 1. Flujo de AutenticaciÃ³n
```
Cliente â†’ [POST /api/v1/auth/login] â†’ Backend â†’ Verifica credenciales con BD â†’ 
Genera JWT â†’ Devuelve token â†’ Frontend almacena token â†’ 
Incluye token en cabecera Authorization para futuras peticiones
```

#### 2. Flujo de ImportaciÃ³n de Animales
```
Cliente â†’ Carga CSV â†’ [POST /api/v1/animals/import] con archivo â†’ 
Backend procesa CSV â†’ Valida formato â†’ Crea registros en BD â†’ 
Devuelve resultado con Ã©xitos/errores â†’ Frontend muestra resultado
```

#### 3. Flujo de GeneraciÃ³n de Reportes
```
Cliente â†’ Solicita informe â†’ Frontend llama a API para datos â†’ 
Backend consulta y agrega datos â†’ Frontend recibe datos â†’ 
Frontend genera PDF con jspdf â†’ Cliente descarga PDF
```

#### 4. Flujo de Backup AutomÃ¡tico
```
Cron job â†’ Trigger backup endpoint â†’ Backend ejecuta dump PostgreSQL â†’ 
Guarda en filesystem â†’ Actualiza registro de backups â†’ 
Limpia backups antiguos segÃºn polÃ­tica retenciÃ³n
```

## 4. Dependencias Externas y Servicios de Terceros

### 4.1 Servicios AWS
- **EC2**: Alojamiento de contenedores Docker 
- **S3** (Potencial): Almacenamiento de backups

### 4.2 Bibliotecas CrÃ­ticas
- **Astro**: Framework principal del frontend
- **FastAPI**: Framework principal del backend
- **SQLAlchemy**: ORM para la base de datos
- **Nginx**: Proxy inverso y servidor web
- **Docker + Compose**: ContenerizaciÃ³n y orquestaciÃ³n

### 4.3 Datos Externos
- **Importaciones CSV**: Para la carga masiva de datos de animales

## 5. Puntos de ExtensiÃ³n y MÃ³dulos Futuros

### 5.1 Extensiones Planificadas
- **Sistema de notificaciones**: Email/SMS para eventos importantes
- **API pÃºblica**: Para integraciones con sistemas externos
- **AplicaciÃ³n mÃ³vil**: Cliente mÃ³vil conectado a la misma API

### 5.2 Ãreas de Mejora
- **Microservicios**: DivisiÃ³n potencial en servicios mÃ¡s pequeÃ±os
- **Cache**: ImplementaciÃ³n de capa de cachÃ© para mejorar rendimiento
- **Mejoras de seguridad**: ImplementaciÃ³n de autenticaciÃ³n 2FA
