Listado REAL - Requisitos para Despliegue Mixto Node Alpine + Nginx en AWS
📂 Estructura de Archivos Necesaria
1. Configuración Docker
docker-compose.yml - Orquestación de servicios
node.Dockerfile - Configuración del contenedor Node.js
nginx.Dockerfile - Configuración del contenedor Nginx
nginx.conf - Configuración detallada de Nginx
2. Scripts de Configuración API
docker-api-master.js - Coordinador principal de configuración
docker-api-detector.js - Detección del backend
docker-api-config.js - Generación de configuración
docker-api-injector.js - Inyección de configuraciones
docker-diagnose.js - Diagnóstico de conectividad
3. Archivos de Aplicación
/client/ - Directorio con archivos compilados del frontend (SSG)
/server/ - Directorio con archivos del servidor Node.js (SSR)
entry.mjs - Punto de entrada principal del servidor (crucial)
package.json - Dependencias mínimas de la aplicación
4. Scripts de Despliegue
desplegar_frontend_mixto_aws.ps1 - Script de despliegue
🔧 Requisitos Técnicos
En la instancia AWS
Docker y Docker Compose instalados
Al menos 2GB de espacio libre (mínimo 15% del disco disponible)
Puertos 80 (y opcionalmente 443) abiertos en el firewall
Clave SSH configurada para acceso remoto
En la red Docker
Red masclet-network creada previamente
Contenedores backend y base de datos funcionando
DNS interno de Docker funcionando correctamente
En la máquina de desarrollo
PowerShell 5.0 o superior
Credenciales SSH para la instancia AWS
Cliente SCP configurado (parte de OpenSSH)
📋 Pasos de Despliegue
Preparación
Limpiar imágenes y contenedores antiguos
Verificar espacio en disco (mínimo 15% libre)
Comprobar que los contenedores de backend están activos
Transferencia de Archivos
Transferir TODOS los archivos mencionados arriba
Verificar que la estructura de directorios sea correcta
Permisos ejecutables para scripts (chmod +x)
Construcción
Construir imágenes de Docker con cache desactivado
Verificar que la construcción completa sin errores
Almacenar logs de construcción para diagnóstico
Ejecución
Iniciar contenedores con docker-compose up -d
Verificar estado con docker-compose ps
Revisar logs inmediatamente (docker logs)
Verificación
Comprobar conectividad entre contenedores
Probar endpoints de salud (health checks)
Verificar funcionamiento del frontend y API
🚨 Problemas Comunes y Soluciones
Si el contenedor Node.js se reinicia
Revisar logs específicos: docker logs masclet-frontend-node
Verificar existencia de entry.mjs
Comprobar permisos de archivos
Si Nginx muestra error 502
Revisar si Node.js está corriendo (no solo creado)
Verificar que Node.js está escuchando en puerto 3000
Comprobar red Docker y resolución DNS
Si hay errores de espacio en disco
Ejecutar: docker system prune -af --volumes
Excepto: --filter "label!=masclet-db" --filter "label!=masclet-backend"
Considerar aumentar tamaño del volumen en AWS
Si hay errores de conexión a la API
Revisar logs del detector de API
Comprobar si el backend responde (curl masclet-backend:8000/api/v1/health)
Verificar configuración DNS en /etc/hosts dentro del contenedor
📊 Verificación Post-Despliegue
Endpoints a Verificar
Frontend principal: http:///
Health check Node.js: http:///health
Health check Nginx: http:///nginx-health
API a través del proxy: http:///api/v1/health
Logs a Revisar
Node.js: docker logs masclet-frontend-node
Nginx: docker logs masclet-frontend
Diagnóstico: docker exec masclet-frontend-node cat /app/diagnostico.log