import{b5 as u}from"./vendor.CwhrWGr6.js";let f="production",i="";const h={development:{protocol:"http",host:"127.0.0.1",port:"8000",path:"/api/v1"},production:{protocol:"http",host:"masclet-api",port:"8000",path:"/api/v1"}};const m=()=>{const r=h.production;return`${r.protocol}://${r.host}:${r.port}${r.path}`};i=m();console.log(`[ApiService] URL de backend: ${i}`);const s=u.create({baseURL:i,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{typeof localStorage<"u"&&localStorage.getItem("token")&&(e.headers.Authorization=`Bearer ${localStorage.getItem("token")}`);e.withCredentials=!1;console.log(`[API] Petición a: ${e.baseURL}${e.url||""}`);return e},e=>Promise.reject(e));s.interceptors.request.use(e=>{if(typeof window<"u"&&window.localStorage)try{const t=localStorage.getItem("token");t&&(e.headers.Authorization=`Bearer ${t}`)}catch(t){console.warn("No se pudo acceder a localStorage:",t)}return e},e=>Promise.reject(e));function y(e,t=!1){i=e,s.defaults.baseURL=e}async function w(e){try{const t=e.startsWith("/")?e:`/${e}`,a=!t.includes("?")&&t.endsWith("/")?t.slice(0,-1):t,r=await s.get(a);return r.data===void 0||r.data===null?Array.isArray(r.data)?[]:{}:r.data}catch(t){if(u.isAxiosError(t)?console.error(`❌ Error en petición GET a ${e}: ${t.message} (${t.response?.status||"sin status"})`):console.error(`❌ Error no relacionado con Axios en ${e}: ${t}`),u.isAxiosError(t)&&t.response?.status===404){const a=t.config?.url||"",r=t.config?.baseURL?`${t.config.baseURL}${a}`:a;if(p){if(r.includes("://"))try{const o=new URL(r),n=o.pathname+o.search;try{return(await u.get(n,{baseURL:"",headers:t.config?.headers})).data}catch{}}catch{}if(a.includes("//")||a.includes("api/api")||a.includes("/api/v1")&&e.includes("/api/v1")){let o=e.replace(/api\/api/g,"api");if(o=o.replace(/\/api\/v1\/api\/v1/g,"/api/v1"),o=o.replace(/\/\/api\/v1/g,"/api/v1"),o!==e)try{return(await s.get(o)).data}catch{}}if(t.config?.baseURL)try{let o=a;return o.startsWith("/api")||(o=`/api/v1/${o.startsWith("/")?o.substring(1):o}`),(await u.get(o,{baseURL:""})).data}catch{}}if(e.includes("list")||e.includes("all")||e.includes("explotacions")||e.includes("animales"))return[]}return{}}}async function b(e,t){try{const a=e.startsWith("/")?e:`/${e}`;return(await s.post(a,t)).data}catch(a){throw console.error(`Error en petición POST a ${e}:`,a),a}}async function v(e,t){try{const a=e.startsWith("/")?e:`/${e}`;return(await s.put(a,t)).data}catch(a){throw console.error(`Error en petición PUT a ${e}:`,a),a}}async function $(e,t){try{const a=e.startsWith("/")?e:`/${e}`;return console.log(`Realizando petición PATCH a ${i}${a}`),console.log("Datos enviados:",t),(await s.patch(a,t)).data}catch(a){throw console.error(`Error en petición PATCH a ${e}:`,a),a}}async function U(e){try{const t=e.startsWith("/")?e:`/${e}`;return(await s.delete(t)).data}catch(t){throw console.error(`Error en petición DELETE a ${e}:`,t),t}}async function g(){try{return typeof window<"u"&&window.localStorage?!!localStorage.getItem("token"):!1}catch(e){return console.error("Error al verificar autenticación:",e),!1}}async function R(){try{return await g()?await w("/users/me"):null}catch(e){return console.error("Error al obtener información del usuario:",e),null}}async function E(e,t){try{const a=new URLSearchParams;a.append("username",e),a.append("password",t),a.append("grant_type","password");const r="/auth/login";console.log(`Realizando login a: ${i}${r}`);const c=await s.post(r,a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});typeof window<"u"&&window.localStorage&&c.data.access_token&&localStorage.setItem("token",c.data.access_token);return c}catch(a){throw console.error("Error al iniciar sesión:",a),a}}const L=()=>i,S={get:w,post:b,put:v,patch:$,del:U,isAuthenticated:g,getUserInfo:R,login:E,configureApi:y,getBaseUrl:L};export{S as a,E as l};
